<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureVault - Gestionnaire de Credentials</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40">
                    <circle cx="20" cy="20" r="18" fill="none" stroke="currentColor" stroke-width="2"/>
                    <path d="M20 10 L20 20 L28 20" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
                <h1>SecureVault</h1>
            </div>
            <button class="theme-toggle" id="themeToggle">
                <span class="icon">üåô</span>
            </button>
        </header>

        <div class="tabs">
            <button class="tab active" data-tab="gmail">
                <span class="icon">üìß</span>
                Gmail
            </button>
            <button class="tab" data-tab="openai">
                <span class="icon">ü§ñ</span>
                OpenAI
            </button>
            <button class="tab" data-tab="recipients">
                <span class="icon">üìã</span>
                Destinataires
            </button>
            <button class="tab" data-tab="voice">
                <span class="icon">üé§</span>
                Voix IA
            </button>
            <button class="tab" data-tab="requests">
                <span class="icon">üìù</span>
                Mes Demandes
            </button>
            <button class="tab" data-tab="workflow">
                <span class="icon">üîÑ</span>
                Suivi
            </button>
            <button class="tab" data-tab="settings">
                <span class="icon">‚öôÔ∏è</span>
                Param√®tres
            </button>
            <button class="tab" data-tab="accessibility">
                <span class="icon">ü¶æ</span>
                Accessibilit√©
            </button>
        </div>

        <div class="content">
            <!-- Bandeau d'aide premi√®re utilisation -->
            <div id="firstTimeHelp" class="alert-info" style="display: none; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                <div style="display: flex; align-items: start; gap: 15px;">
                    <div style="font-size: 2rem;">üëã</div>
                    <div style="flex: 1;">
                        <h3 style="margin: 0 0 10px 0; font-size: 1.3rem;">Bienvenue dans SecureVault !</h3>
                        <p style="margin: 0 0 15px 0; opacity: 0.95; line-height: 1.6;">
                            C'est votre premi√®re utilisation. Suivez ces 3 √©tapes simples pour commencer √† envoyer des emails :
                        </p>
                        <ol style="margin: 0; padding-left: 20px; line-height: 1.8;">
                            <li><strong>Configurez Gmail</strong> : Ajoutez votre email et App Password Gmail</li>
                            <li><strong>Choisissez un mot de passe ma√Ætre</strong> : Pour s√©curiser vos credentials</li>
                            <li><strong>Validez</strong> : Et commencez √† envoyer des emails !</li>
                        </ol>
                        <button onclick="document.getElementById('firstTimeHelp').style.display='none'" style="margin-top: 15px; padding: 8px 16px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            J'ai compris ‚úì
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Gmail Tab -->
            <div class="tab-content active" id="gmail">
                <div class="card">
                    <div class="header-with-help">
                        <h2>Configuration Gmail</h2>
                        <button class="btn-help" id="helpGmail">‚ùì Comment obtenir l'App Password ?</button>
                    </div>
                    <form id="gmailForm">
                        <div class="input-group">
                            <label for="gmailEmail">Email Gmail</label>
                            <input type="email" id="gmailEmail" placeholder="votre@email.com">
                        </div>
                        <div class="input-group">
                            <label for="gmailPassword">App Password Gmail</label>
                            <div class="password-wrapper">
                                <input type="password" id="gmailPassword" placeholder="xxxx xxxx xxxx xxxx" required>
                                <button type="button" class="toggle-password" data-target="gmailPassword">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="gmailMaster">Mot de passe ma√Ætre</label>
                            <div class="password-wrapper">
                                <input type="password" id="gmailMaster" placeholder="Min 8 car., maj, min, chiffre" required>
                                <button type="button" class="toggle-password" data-target="gmailMaster">üëÅÔ∏è</button>
                            </div>
                            <div class="password-strength" id="gmailStrength"></div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span class="icon">üîí</span>
                            Pr√©visualiser
                        </button>
                    </form>
                    <div id="gmailPreview" class="preview-box" style="display: none;">
                        <h4>üìß V√©rifiez votre configuration Gmail</h4>
                        <div id="gmailPreviewContent"></div>
                        <div class="validation-buttons">
                            <button id="validateGmailBtn" class="btn btn-success">
                                <span class="icon">‚úÖ</span>
                                Valider
                            </button>
                            <button id="retryGmailBtn" class="btn btn-danger">
                                <span class="icon">üîÑ</span>
                                Recommencer
                            </button>
                        </div>
                    </div>
                    <div class="status" id="gmailStatus"></div>
                </div>
            </div>

            <!-- OpenAI Tab -->
            <div class="tab-content" id="openai">
                <div class="card">
                    <h2>Configuration OpenAI</h2>
                    <form id="openaiForm">
                        <div class="input-group">
                            <label for="apiKey">Cl√© API OpenAI</label>
                            <div class="password-wrapper">
                                <input type="password" id="apiKey" placeholder="sk-..." required>
                                <button type="button" class="toggle-password" data-target="apiKey">üëÅÔ∏è</button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="orgId">Organization ID (optionnel)</label>
                            <input type="text" id="orgId" placeholder="org-...">
                        </div>
                        <div class="input-group">
                            <label for="openaiMaster">Mot de passe ma√Ætre</label>
                            <div class="password-wrapper">
                                <input type="password" id="openaiMaster" placeholder="Min 8 car., maj, min, chiffre" required>
                                <button type="button" class="toggle-password" data-target="openaiMaster">üëÅÔ∏è</button>
                            </div>
                            <div class="password-strength" id="openaiStrength"></div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span class="icon">üîí</span>
                            Pr√©visualiser
                        </button>
                    </form>
                    <div id="openaiPreview" class="preview-box" style="display: none;">
                        <h4>ü§ñ V√©rifiez votre configuration OpenAI</h4>
                        <div id="openaiPreviewContent"></div>
                        <div class="validation-buttons">
                            <button id="validateOpenaiBtn" class="btn btn-success">
                                <span class="icon">‚úÖ</span>
                                Valider
                            </button>
                            <button id="retryOpenaiBtn" class="btn btn-danger">
                                <span class="icon">üîÑ</span>
                                Recommencer
                            </button>
                        </div>
                    </div>
                    <div class="status" id="openaiStatus"></div>
                </div>
            </div>

            <!-- Recipients Tab -->
            <div class="tab-content" id="recipients">
                <div class="card">
                    <h2>üìã Gestion des Destinataires</h2>
                    
                    <div class="recipients-form">
                        <h3>Ajouter un destinataire</h3>
                        <form id="recipientForm">
                            <div class="form-row">
                                <div class="input-group">
                                    <label for="recipientName">Nom</label>
                                    <input type="text" id="recipientName" placeholder="Jean Dupont" required>
                                </div>
                                <div class="input-group">
                                    <label for="recipientEmail">Email</label>
                                    <input type="email" id="recipientEmail" placeholder="jean@example.com" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="input-group">
                                    <label for="recipientType">Type</label>
                                    <select id="recipientType">
                                        <option value="to">√Ä (TO)</option>
                                        <option value="cc">CC</option>
                                        <option value="bcc">CCI (BCC)</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="recipientDate">Date d'envoi pr√©vue</label>
                                    <input type="datetime-local" id="recipientDate">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <span class="icon">‚ûï</span>
                                Pr√©visualiser
                            </button>
                        </form>
                        <div id="recipientPreview" class="preview-box" style="display: none;">
                            <h4>üìã V√©rifiez le destinataire</h4>
                            <div id="recipientPreviewContent"></div>
                            <div class="validation-buttons">
                                <button id="validateRecipientBtn" class="btn btn-success">
                                    <span class="icon">‚úÖ</span>
                                    Valider
                                </button>
                                <button id="retryRecipientBtn" class="btn btn-danger">
                                    <span class="icon">üîÑ</span>
                                    Recommencer
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="recipients-table">
                        <h3>Liste des destinataires</h3>
                        <div class="table-container">
                            <table id="recipientsTable">
                                <thead>
                                    <tr>
                                        <th>Nom</th>
                                        <th>Email</th>
                                        <th>Type</th>
                                        <th>Date d'envoi</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="recipientsBody">
                                    <tr class="empty-state">
                                        <td colspan="5">Aucun destinataire. Ajoutez-en un ci-dessus.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="calendar-view">
                        <h3>üìÖ Calendrier des envois</h3>
                        <div id="calendarContainer"></div>
                    </div>
                </div>
            </div>

            <!-- Voice Tab -->
            <div class="tab-content" id="voice">
                <div class="card">
                    <h2>üé§ Assistant Vocal IA</h2>
                    
                    <div class="voice-section">
                        <h3>üîä Synth√®se vocale (Texte ‚Üí Parole)</h3>
                        <form id="ttsForm">
                            <div class="input-group">
                                <label for="ttsText">Texte √† prononcer</label>
                                <textarea id="ttsText" rows="4" placeholder="Entrez le texte que l'IA doit prononcer..." required></textarea>
                            </div>
                            <div class="form-row">
                                <div class="input-group">
                                    <label for="ttsVoice">Voix</label>
                                    <select id="ttsVoice">
                                        <option value="alloy">Alloy (Neutre)</option>
                                        <option value="echo">Echo (Masculin)</option>
                                        <option value="fable">Fable (F√©minin)</option>
                                        <option value="onyx">Onyx (Grave)</option>
                                        <option value="nova">Nova (Doux)</option>
                                        <option value="shimmer">Shimmer (Clair)</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="ttsMaster">Mot de passe ma√Ætre</label>
                                    <input type="password" id="ttsMaster" required>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <span class="icon">üîä</span>
                                G√©n√©rer la voix
                            </button>
                        </form>
                        <audio id="audioPlayer" controls style="width: 100%; margin-top: 1rem; display: none;"></audio>
                        <div id="audioValidation" class="validation-buttons" style="display: none;">
                            <button id="validateAudioBtn" class="btn btn-success">
                                <span class="icon">‚úÖ</span>
                                Valider
                            </button>
                            <button id="retryAudioBtn" class="btn btn-danger">
                                <span class="icon">üîÑ</span>
                                Recommencer
                            </button>
                        </div>
                    </div>

                    <div class="voice-section">
                        <h3>üé§ Reconnaissance vocale (Parole ‚Üí Texte)</h3>
                        <div class="recorder-container">
                            <button id="recordBtn" class="btn btn-danger">
                                <span class="icon">‚è∫</span>
                                Commencer l'enregistrement
                            </button>
                            <div id="recordingStatus" class="recording-status"></div>
                        </div>
                        <div class="input-group" style="margin-top: 1rem;">
                            <label for="sttMaster">Mot de passe ma√Ætre</label>
                            <input type="password" id="sttMaster" required>
                        </div>
                        <div id="liveTranscript" class="live-transcript" style="display: none;">
                            <h4>üé¨ En direct :</h4>
                            <p id="liveTranscriptText"></p>
                        </div>
                        <div id="transcriptionResult" class="transcription-result"></div>
                        <div id="transcriptionValidation" class="validation-buttons" style="display: none;">
                            <button id="validateTranscriptionBtn" class="btn btn-success">
                                <span class="icon">‚úÖ</span>
                                Valider
                            </button>
                            <button id="retryTranscriptionBtn" class="btn btn-danger">
                                <span class="icon">üîÑ</span>
                                Recommencer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Accessibility Tab -->
            <div class="tab-content" id="accessibility">
                <div class="card">
                    <h2>ü¶æ Accessibilit√©</h2>
                    <div class="settings-section">
                        <h3>Mode d'accessibilit√©</h3>
                        <select id="accessibilityMode" class="form-control">
                            <option value="standard">Standard</option>
                            <option value="sourd_muet">Sourd/Muet (Transcription vocale)</option>
                            <option value="aveugle">Aveugle (Synth√®se vocale)</option>
                            <option value="complet">Complet (TTS + Transcription)</option>
                        </select>
                    </div>
                    <div class="settings-section">
                        <h3>üîä Test Synth√®se Vocale</h3>
                        <textarea id="testTTS" rows="3" placeholder="Entrez du texte √† lire..."></textarea>
                        <button class="btn btn-primary" id="testTTSBtn">
                            <span class="icon">üîä</span>
                            Lire le texte
                        </button>
                    </div>
                    <div class="settings-section">
                        <h3>üé§ Test Transcription</h3>
                        <button class="btn btn-primary" id="testTranscribeBtn">
                            <span class="icon">üé§</span>
                            Dicter maintenant
                        </button>
                        <div id="testTranscribeResult" style="margin-top: 1rem;"></div>
                    </div>
                    <div class="settings-section">
                        <h3>‚å®Ô∏è Raccourcis clavier</h3>
                        <ul>
                            <li><kbd>Ctrl+Enter</kbd> - Envoyer email</li>
                            <li><kbd>Ctrl+Shift+V</kbd> - Dicter</li>
                            <li><kbd>Ctrl+Shift+L</kbd> - Lire contenu</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Requests Tab -->
            <div class="tab-content" id="requests">
                <div class="card">
                    <h2>üìù Mes Demandes</h2>
                    
                    <div class="request-form">
                        <h3>Nouvelle demande</h3>
                        <form id="requestForm">
                            <div class="input-group">
                                <label for="requestText">Texte brut ou vocal</label>
                                <textarea id="requestText" rows="6" placeholder="Collez votre message brut ici ou enregistrez vocalement..."></textarea>
                            </div>
                            <div class="form-row">
                                <button type="button" id="recordRequestBtn" class="btn btn-secondary">
                                    <span class="icon">üé§</span>
                                    Dicter
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <span class="icon">‚ú®</span>
                                    G√©n√©rer l'email
                                </button>
                            </div>
                        </form>
                    </div>

                    <div id="generatedEmail" class="generated-email" style="display: none;">
                        <h3>üìß Email g√©n√©r√©</h3>
                        <div class="input-group">
                            <label for="generatedSubject">Objet</label>
                            <input type="text" id="generatedSubject" readonly>
                        </div>
                        <div class="input-group">
                            <label for="generatedBody">Corps du message</label>
                            <textarea id="generatedBody" rows="10" readonly></textarea>
                        </div>
                        <div class="input-group">
                            <label for="sendTo">Destinataire</label>
                            <select id="sendTo">
                                <option value="">S√©lectionnez un destinataire</option>
                            </select>
                        </div>
                        <div class="validation-buttons">
                            <button id="validateEmailBtn" class="btn btn-success">
                                <span class="icon">‚úÖ</span>
                                Valider et envoyer
                            </button>
                            <button id="retryEmailBtn" class="btn btn-danger">
                                <span class="icon">üîÑ</span>
                                Recommencer
                            </button>
                        </div>
                    </div>

                    <div class="requests-history">
                        <h3>üìä Historique des demandes</h3>
                        <div id="requestsHistory"></div>
                    </div>
                </div>
            </div>

            <!-- Workflow Tab -->
            <div class="tab-content" id="workflow">
                <div class="card">
                    <h2>üîÑ Suivi des Workflows</h2>
                    
                    <div class="workflow-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="totalWorkflows">0</div>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="envoyesWorkflows">0</div>
                            <div class="stat-label">Envoy√©s</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="enCoursWorkflows">0</div>
                            <div class="stat-label">En cours</div>
                        </div>
                    </div>

                    <div class="workflow-list">
                        <h3>Historique</h3>
                        <div id="workflowHistory"></div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" id="settings">
                <div class="card">
                    <h2>Param√®tres</h2>
                    <div class="settings-section">
                        <h3>S√©curit√©</h3>
                        <button class="btn btn-danger" id="deleteBtn">
                            <span class="icon">üóëÔ∏è</span>
                            Supprimer toutes les credentials
                        </button>
                    </div>
                    <div class="settings-section">
                        <h3>Informations</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="label">Gmail configur√©:</span>
                                <span class="value" id="gmailConfigured">‚ùå</span>
                            </div>
                            <div class="info-item">
                                <span class="label">OpenAI configur√©:</span>
                                <span class="value" id="openaiConfigured">‚ùå</span>
                            </div>
                            <div class="info-item" id="gmailDate" style="display:none;">
                                <span class="label">Gmail cr√©√© le:</span>
                                <span class="value" id="gmailDateValue"></span>
                            </div>
                            <div class="info-item" id="openaiDate" style="display:none;">
                                <span class="label">OpenAI cr√©√© le:</span>
                                <span class="value" id="openaiDateValue"></span>
                            </div>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h3>Backup</h3>
                        <button class="btn btn-primary" id="exportBtn">
                            <span class="icon">üíæ</span>
                            Exporter les m√©tadonn√©es
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="notification" id="notification"></div>
        <div class="voice-indicator" id="voiceIndicator">üîä L'IA parle...</div>
        
        <!-- Modal d'√©dition destinataire -->
        <div class="modal" id="editRecipientModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚úèÔ∏è Modifier le destinataire</h2>
                    <button class="modal-close" id="closeEditModal">√ó</button>
                </div>
                <div class="modal-body">
                    <form id="editRecipientForm">
                        <input type="hidden" id="editRecipientId">
                        <div class="input-group">
                            <label for="editRecipientName">Nom</label>
                            <input type="text" id="editRecipientName" required>
                        </div>
                        <div class="input-group">
                            <label for="editRecipientEmail">Email</label>
                            <input type="email" id="editRecipientEmail" required>
                        </div>
                        <div class="input-group">
                            <label for="editRecipientType">Type</label>
                            <select id="editRecipientType">
                                <option value="to">√Ä (TO)</option>
                                <option value="cc">CC</option>
                                <option value="bcc">CCI (BCC)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="editRecipientDate">Date d'envoi</label>
                            <input type="datetime-local" id="editRecipientDate">
                        </div>
                        <button type="submit" class="btn btn-primary">Enregistrer</button>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Modal d'aide -->
        <div class="modal" id="helpModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üîë Comment obtenir votre App Password Gmail ?</h2>
                    <button class="modal-close" id="closeModal">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>Activer la validation en 2 √©tapes</h3>
                            <p>Allez sur <a href="https://myaccount.google.com/signinoptions/two-step-verification" target="_blank">myaccount.google.com</a> ‚Üí S√©curit√© ‚Üí Validation en 2 √©tapes</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>G√©n√©rer un App Password</h3>
                            <p>Allez sur <a href="https://myaccount.google.com/apppasswords" target="_blank">myaccount.google.com/apppasswords</a></p>
                            <p>Choisissez "Autre (nom personnalis√©)" et tapez "SecureVault"</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>Copier le mot de passe</h3>
                            <p>Google affichera un code de 16 caract√®res : <code>xxxx xxxx xxxx xxxx</code></p>
                            <p>‚ö†Ô∏è Copiez-le imm√©diatement, vous ne pourrez plus le voir apr√®s !</p>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3>Coller dans SecureVault</h3>
                            <p>Collez le mot de passe dans le champ "App Password Gmail" ci-dessus</p>
                        </div>
                    </div>
                    <div class="quick-links">
                        <h3>üîó Liens rapides</h3>
                        <a href="https://myaccount.google.com/apppasswords" target="_blank" class="btn btn-primary">
                            <span class="icon">üîë</span>
                            G√©n√©rer App Password
                        </a>
                        <a href="https://myaccount.google.com" target="_blank" class="btn btn-secondary">
                            <span class="icon">‚öôÔ∏è</span>
                            Compte Google
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
    <script src="/static/js/accessibility.js"></script>
    <script>
        // V√©rifier si c'est la premi√®re utilisation
        async function checkFirstTime() {
            try {
                const response = await fetch('/api/check-credentials');
                const data = await response.json();
                
                // Si aucun credential n'existe, afficher le bandeau d'aide
                if (!data.gmail_exists && !data.openai_exists) {
                    document.getElementById('firstTimeHelp').style.display = 'block';
                    
                    // Animation d'entr√©e
                    setTimeout(() => {
                        document.getElementById('firstTimeHelp').style.animation = 'slideInDown 0.5s ease-out';
                    }, 100);
                }
            } catch (error) {
                console.error('Error checking credentials:', error);
            }
        }
        
        // Ex√©cuter au chargement de la page
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', checkFirstTime);
        } else {
            checkFirstTime();
        }
    </script>
    <style>
        @keyframes slideInDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</body>
</html>
