<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion - IAPosteManager v3.0</title>
    <link rel="stylesheet" href="/static/css/unified.css">
</head>
<body class="login-body">
    <div class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">
                    <div class="logo-icon">üìß</div>
                    <h1>IAPosteManager</h1>
                    <span class="version">v3.0 Unified</span>
                </div>
                <p>Interface unifi√©e pour tous vos emails</p>
            </div>
            
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="password">Mot de passe ma√Ætre</label>
                    <div class="password-wrapper">
                        <input type="password" id="password" placeholder="Votre mot de passe s√©curis√©" required>
                        <button type="button" class="toggle-password" id="togglePassword">üëÅÔ∏è</button>
                    </div>
                    <div class="password-hint">
                        Minimum 8 caract√®res pour la s√©curit√©
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary login-btn">
                    <span class="icon">üîì</span>
                    Se connecter
                </button>
            </form>
            
            <div class="login-features">
                <h3>‚ú® Fonctionnalit√©s unifi√©es</h3>
                <div class="features-grid">
                    <div class="feature">
                        <span class="feature-icon">ü§ñ</span>
                        <span>IA Avanc√©e</span>
                    </div>
                    <div class="feature">
                        <span class="feature-icon">üé§</span>
                        <span>Vocal Temps R√©el</span>
                    </div>
                    <div class="feature">
                        <span class="feature-icon">üîí</span>
                        <span>Chiffrement AES</span>
                    </div>
                    <div class="feature">
                        <span class="feature-icon">üì±</span>
                        <span>Interface Moderne</span>
                    </div>
                </div>
            </div>
            
            <div class="login-footer">
                <p>üîê Vos donn√©es sont chiffr√©es localement</p>
                <p>üöÄ Combinaison de tous vos projets en un</p>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('togglePassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('password');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
        });

        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const password = document.getElementById('password').value;
            const loginBtn = document.querySelector('.login-btn');
            
            if (password.length < 8) {
                showNotification('Mot de passe trop court (minimum 8 caract√®res)', 'error');
                return;
            }
            
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<span class="icon">‚è≥</span> Connexion...';
            
            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Connexion r√©ussie ! üéâ', 'success');
                    setTimeout(() => {
                        window.location.href = data.redirect || '/';
                    }, 1000);
                } else {
                    showNotification(data.error || 'Erreur de connexion', 'error');
                }
            } catch (error) {
                showNotification('Erreur de connexion', 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<span class="icon">üîì</span> Se connecter';
            }
        });

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span class="notification-icon">${type === 'success' ? '‚úÖ' : '‚ùå'}</span>
                    <span class="notification-message">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>