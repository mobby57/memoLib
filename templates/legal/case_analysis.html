<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse Dossier - memoLib</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8fafc; font-family: 'Inter', sans-serif; }
        .navbar { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
        .prediction-card { background: white; border-radius: 16px; padding: 2rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); margin-bottom: 2rem; }
        .success-rate { font-size: 3rem; font-weight: 700; }
        .success-high { color: #059669; }
        .success-medium { color: #d97706; }
        .success-low { color: #dc2626; }
        .factor-item { padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb; }
        .factor-positive { color: #059669; }
        .factor-negative { color: #dc2626; }
        .strategy-card { background: linear-gradient(135deg, #3b82f6 0%, #1e3a8a 100%); color: white; border-radius: 16px; padding: 2rem; }
        .btn-action { border-radius: 8px; padding: 0.75rem 1.5rem; margin: 0.25rem; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="fas fa-brain me-2"></i>IA POSTE MANAGER
            </a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-8">
                <div class="prediction-card">
                    <h3><i class="fas fa-brain me-2"></i>Analyse IA CESEDA - {{ case_data.client_name }}</h3>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="text-center">
                                <div class="success-rate {% if prediction.success_probability >= 0.8 %}success-high{% elif prediction.success_probability >= 0.6 %}success-medium{% else %}success-low{% endif %}">
                                    {{ (prediction.success_probability * 100)|round|int }}%
                                </div>
                                <h5>Probabilité de Succès</h5>
                                <p class="text-muted">Confiance: {{ prediction.confidence_level|title }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Facteurs Analysés:</h6>
                            {% for key, value in prediction.key_factors.items() %}
                            <div class="factor-item">
                                <strong>{{ key|replace('_', ' ')|title }}:</strong> {{ value }}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="strategy-card">
                    <h4><i class="fas fa-lightbulb me-2"></i>Stratégie Recommandée</h4>
                    <p class="mb-3">{{ prediction.recommendation }}</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-clock me-2"></i>Timeline</h6>
                            <p>{{ prediction.timeline_prediction }}</p>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-euro-sign me-2"></i>Coût Estimé</h6>
                            <p>{{ prediction.cost_estimate.estimated_cost }}€</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="prediction-card">
                    <h5><i class="fas fa-info-circle me-2"></i>Détails Dossier</h5>
                    
                    <div class="factor-item">
                        <strong>Type:</strong> {{ analysis.case_type }}
                    </div>
                    <div class="factor-item">
                        <strong>Urgence:</strong> 
                        <span class="badge bg-{% if analysis.urgency_level == 'critique' %}danger{% elif analysis.urgency_level == 'important' %}warning{% else %}success{% endif %}">
                            {{ analysis.urgency_level|title }}
                        </span>
                    </div>
                    <div class="factor-item">
                        <strong>Stratégie:</strong> {{ analysis.legal_strategy }}
                    </div>
                    
                    <h6 class="mt-3">Documents Requis:</h6>
                    <ul class="list-unstyled">
                        {% for doc in analysis.required_documents %}
                        <li><i class="fas fa-file-alt me-2"></i>{{ doc }}</li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="prediction-card">
                    <h5><i class="fas fa-cogs me-2"></i>Actions</h5>
                    
                    <a href="{{ url_for('document_generator') }}" class="btn btn-success btn-action w-100">
                        <i class="fas fa-file-alt me-2"></i>Générer Documents
                    </a>
                    
                    <a href="#" class="btn btn-primary btn-action w-100">
                        <i class="fas fa-phone me-2"></i>Contacter Client
                    </a>
                    
                    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary btn-action w-100">
                        <i class="fas fa-arrow-left me-2"></i>Retour Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>