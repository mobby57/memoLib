<!DOCTYPE html>
<html>
<head>
  <title>Test Webhook</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    textarea { width: 100%; height: 200px; }
    button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
    .response { margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px; white-space: pre-wrap; }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>
  <h1>Test Webhook - Pattern Adapter Multi-Canal</h1>
  
  <h2>Payload JSON:</h2>
  <textarea id="payload">{
  "channel": "email",
  "from": "user@example.com",
  "subject": "Test Webhook",
  "body": "Testing the adapter pattern",
  "messageId": "msg-adapter-001"
}</textarea>

  <br><br>
  <button onclick="sendWebhook()">Envoyer POST</button>
  <button onclick="sendWebhook2()">Test Email 2</button>
  <button onclick="sendWebhook3()">Test WhatsApp</button>

  <h2>RÃ©ponse:</h2>
  <div id="response" class="response" style="display:none;"></div>

  <script>
    async function sendWebhook() {
      const payload = document.getElementById('payload').value;
      try {
        const response = await fetch('http://localhost:3000/api/webhooks/test-multichannel', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: payload
        });
        const data = await response.json();
        const el = document.getElementById('response');
        el.style.display = 'block';
        if (response.ok) {
          el.className = 'response success';
          el.innerHTML = 'Status: ' + response.status + '\n\n' + JSON.stringify(data, null, 2);
        } else {
          el.className = 'response error';
          el.innerHTML = 'Status: ' + response.status + '\n\n' + JSON.stringify(data, null, 2);
        }
      } catch (e) {
        const el = document.getElementById('response');
        el.style.display = 'block';
        el.className = 'response error';
        el.innerHTML = 'Error: ' + e.message;
      }
    }

    async function sendWebhook2() {
      const payload = {
        channel: "email",
        from: "marie@avocate.fr",
        subject: "Question urgente",
        body: "Bonjour, j'ai une question juridique importante",
        messageId: "msg-email-002"
      };
      const el = document.getElementById('payload');
      el.value = JSON.stringify(payload, null, 2);
      await sendWebhook();
    }

    async function sendWebhook3() {
      const payload = {
        channel: "whatsapp",
        from: "+33612345678",
        body: "Urgence juridique - besoin d'aide",
        messageId: "msg-whatsapp-001"
      };
      const el = document.getElementById('payload');
      el.value = JSON.stringify(payload, null, 2);
      await sendWebhook();
    }
  </script>
</body>
</html>
