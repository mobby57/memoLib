{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Configuration Multi-Canal pour IA Poste Manager",
  "type": "object",
  "description": "Configuration des canaux de communication (email, chat, SMS, webhooks, réseaux sociaux)",
  
  "channels": {
    "email": {
      "enabled": true,
      "provider": "resend",
      "config": {
        "api_key_env": "RESEND_API_KEY",
        "from_email": "noreply@iapostemanager.fr",
        "from_name": "IA Poste Manager",
        "reply_to": "support@iapostemanager.fr",
        "max_attachments_mb": 25,
        "allowed_attachment_types": [".pdf", ".jpg", ".png", ".doc", ".docx"],
        "templates": {
          "workspace_created": "template_workspace_created",
          "response_ready": "template_response_ready",
          "validation_required": "template_validation_required",
          "mdph_form_ready": "template_mdph_ready"
        }
      },
      "webhooks": {
        "inbound_email_url": "/api/v1/workspaces/webhooks/email-received",
        "bounce_url": "/api/v1/webhooks/email-bounced",
        "complaint_url": "/api/v1/webhooks/email-complaint"
      },
      "rate_limits": {
        "per_hour": 100,
        "per_day": 1000,
        "burst": 20
      }
    },
    
    "chat": {
      "enabled": true,
      "provider": "custom_websocket",
      "config": {
        "websocket_url": "ws://localhost:8000/ws",
        "reconnect_interval_ms": 3000,
        "max_message_length": 5000,
        "typing_indicator_timeout_ms": 5000,
        "enable_file_upload": true,
        "max_file_size_mb": 10
      },
      "ai_assistant": {
        "enabled": true,
        "model": "ollama",
        "response_delay_ms": 500,
        "show_typing_indicator": true,
        "max_conversation_history": 50
      },
      "rate_limits": {
        "messages_per_minute": 30,
        "messages_per_hour": 500
      }
    },
    
    "sms": {
      "enabled": false,
      "provider": "twilio",
      "config": {
        "account_sid_env": "TWILIO_ACCOUNT_SID",
        "auth_token_env": "TWILIO_AUTH_TOKEN",
        "from_number": "+33123456789",
        "max_message_length": 160,
        "enable_unicode": true,
        "enable_mms": false
      },
      "use_cases": {
        "urgent_notifications": true,
        "2fa_codes": true,
        "appointment_reminders": true,
        "general_messaging": false
      },
      "cost_per_sms": 0.08,
      "rate_limits": {
        "per_user_per_day": 5,
        "total_per_day": 1000
      }
    },
    
    "push_notifications": {
      "enabled": true,
      "provider": "firebase_fcm",
      "config": {
        "project_id_env": "FIREBASE_PROJECT_ID",
        "credentials_path_env": "FIREBASE_CREDENTIALS_PATH",
        "enable_ios": true,
        "enable_android": true,
        "enable_web": true
      },
      "notification_types": {
        "workspace_created": {
          "title": "Nouveau workspace créé",
          "body": "Votre demande a été enregistrée",
          "icon": "workspace.png",
          "priority": "high"
        },
        "response_ready": {
          "title": "Réponse prête",
          "body": "Une réponse a été générée pour votre demande",
          "icon": "message.png",
          "priority": "high"
        },
        "validation_required": {
          "title": "Validation requise",
          "body": "Votre validation est nécessaire",
          "icon": "alert.png",
          "priority": "urgent"
        }
      },
      "rate_limits": {
        "per_user_per_hour": 20,
        "burst": 5
      }
    },
    
    "webhooks": {
      "enabled": true,
      "config": {
        "timeout_seconds": 30,
        "max_retries": 3,
        "retry_delay_seconds": [60, 300, 900],
        "verify_ssl": true,
        "include_signature": true,
        "signature_algorithm": "sha256"
      },
      "events": {
        "workspace.created": {
          "enabled": true,
          "description": "Déclenché quand un workspace est créé"
        },
        "workspace.updated": {
          "enabled": true,
          "description": "Déclenché quand un workspace est mis à jour"
        },
        "response.generated": {
          "enabled": true,
          "description": "Déclenché quand une réponse IA est générée"
        },
        "form.submitted": {
          "enabled": true,
          "description": "Déclenché quand un formulaire est soumis"
        },
        "mdph.form_ready": {
          "enabled": true,
          "description": "Déclenché quand un formulaire MDPH est prêt"
        },
        "payment.succeeded": {
          "enabled": true,
          "description": "Déclenché quand un paiement réussit"
        },
        "subscription.updated": {
          "enabled": true,
          "description": "Déclenché quand un abonnement change"
        }
      },
      "rate_limits": {
        "per_endpoint_per_minute": 60,
        "total_per_minute": 500
      }
    },
    
    "social_media": {
      "enabled": false,
      "platforms": {
        "facebook": {
          "enabled": false,
          "config": {
            "page_id_env": "FACEBOOK_PAGE_ID",
            "access_token_env": "FACEBOOK_ACCESS_TOKEN",
            "respond_to_messages": true,
            "respond_to_comments": false
          }
        },
        "twitter": {
          "enabled": false,
          "config": {
            "api_key_env": "TWITTER_API_KEY",
            "api_secret_env": "TWITTER_API_SECRET",
            "respond_to_mentions": true,
            "respond_to_dm": true
          }
        },
        "whatsapp_business": {
          "enabled": false,
          "config": {
            "api_key_env": "WHATSAPP_API_KEY",
            "phone_number_id_env": "WHATSAPP_PHONE_ID",
            "enable_templates": true
          }
        }
      }
    },
    
    "web_forms": {
      "enabled": true,
      "config": {
        "enable_recaptcha": true,
        "recaptcha_site_key_env": "RECAPTCHA_SITE_KEY",
        "recaptcha_secret_key_env": "RECAPTCHA_SECRET_KEY",
        "enable_csrf_protection": true,
        "max_form_size_mb": 50,
        "enable_file_upload": true
      },
      "accessibility": {
        "enable_aria_labels": true,
        "enable_keyboard_navigation": true,
        "enable_screen_reader_mode": true,
        "font_scaling_enabled": true
      }
    }
  },
  
  "routing": {
    "prioritization": {
      "enabled": true,
      "rules": [
        {
          "name": "MDPH urgent en premier",
          "condition": {
            "type": "mdph",
            "priority": "urgent"
          },
          "priority_boost": 10
        },
        {
          "name": "Plans PRO prioritaires",
          "condition": {
            "user_plan": "PRO"
          },
          "priority_boost": 5
        },
        {
          "name": "Première demande prioritaire",
          "condition": {
            "is_first_workspace": true
          },
          "priority_boost": 3
        }
      ]
    },
    
    "load_balancing": {
      "enabled": false,
      "strategy": "round_robin",
      "health_check_interval_seconds": 60
    }
  },
  
  "monitoring": {
    "enabled": true,
    "metrics": {
      "track_response_time": true,
      "track_success_rate": true,
      "track_error_rate": true,
      "track_channel_usage": true
    },
    "alerts": {
      "email_failure_rate_threshold": 10,
      "sms_failure_rate_threshold": 15,
      "webhook_failure_rate_threshold": 20,
      "alert_email": "alerts@iapostemanager.fr"
    }
  },
  
  "compliance": {
    "gdpr": {
      "log_all_communications": true,
      "anonymize_after_days": 365,
      "delete_on_user_request": true,
      "data_export_enabled": true
    },
    "rgaa": {
      "accessibility_level": "AAA",
      "alternative_text_required": true,
      "keyboard_navigation_required": true
    }
  }
}
