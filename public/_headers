# ============================================
# CLOUDFLARE PAGES HEADERS - CONFIGURATION AVANCÉE
# Sécurité OWASP 2026 + Performance Optimale
# ============================================

# ============================================
# GLOBAL SECURITY HEADERS
# ============================================
/*
  # HSTS - Force HTTPS (2 ans + preload)
  Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
  
  # Clickjacking Protection
  X-Frame-Options: DENY
  
  # MIME Sniffing Protection
  X-Content-Type-Options: nosniff
  
  # XSS Protection (legacy mais utile)
  X-XSS-Protection: 1; mode=block
  
  # Referrer Policy
  Referrer-Policy: strict-origin-when-cross-origin
  
  # Permissions Policy - Bloquer APIs dangereuses
  Permissions-Policy: camera=(), microphone=(), geolocation=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=(), interest-cohort=(), browsing-topics=()
  
  # Content Security Policy (CSP) - Renforcé pour Cloudflare
  Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-eval' 'unsafe-inline' https://challenges.cloudflare.com https://static.cloudflareinsights.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https: blob:; font-src 'self' data:; connect-src 'self' https://*.cloudflare.com https://*.pages.dev wss://*.cloudflare.com; worker-src 'self' blob:; frame-ancestors 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests; block-all-mixed-content;
  
  # Cross-Origin Policies
  Cross-Origin-Embedder-Policy: credentialless
  Cross-Origin-Opener-Policy: same-origin
  Cross-Origin-Resource-Policy: same-origin
  
  # Additional Security
  X-Permitted-Cross-Domain-Policies: none
  X-Download-Options: noopen
  X-DNS-Prefetch-Control: on
  
  # Branding
  X-Powered-By: Cloudflare Pages
  X-Application: IA Poste Manager v2.0
  
  # Default Cache (no-cache pour pages dynamiques)
  Cache-Control: no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0

# ============================================
# STATIC ASSETS - CACHE AGRESSIF (1 AN)
# ============================================
/static/*
  Cache-Control: public, max-age=31536000, immutable, s-maxage=31536000
  CDN-Cache-Control: public, max-age=31536000, immutable
  Cloudflare-CDN-Cache-Control: public, max-age=31536000
  
/_next/static/*
  Cache-Control: public, max-age=31536000, immutable, s-maxage=31536000
  CDN-Cache-Control: public, max-age=31536000, immutable
  Cloudflare-CDN-Cache-Control: public, max-age=31536000

/images/*
  Cache-Control: public, max-age=31536000, immutable, s-maxage=31536000
  CDN-Cache-Control: public, max-age=31536000, immutable

# ============================================
# FONTS - CACHE LONG (1 AN)
# ============================================
/fonts/*
  Cache-Control: public, max-age=31536000, immutable, s-maxage=31536000
  CDN-Cache-Control: public, max-age=31536000, immutable
  Access-Control-Allow-Origin: *

# ============================================
# MANIFEST & SERVICE WORKER - CACHE COURT
# ============================================
/manifest.json
  Cache-Control: public, max-age=3600, must-revalidate
  Content-Type: application/manifest+json

/sw.js
  Cache-Control: public, max-age=0, must-revalidate
  Content-Type: application/javascript
  Service-Worker-Allowed: /

# ============================================
# API ROUTES - NO CACHE + CORS
# ============================================
/api/*
  Cache-Control: no-store, no-cache, must-revalidate, max-age=0
  Access-Control-Allow-Origin: https://memolib.fly.dev
  Access-Control-Allow-Methods: GET, POST, PUT, DELETE, PATCH, OPTIONS
  Access-Control-Allow-Headers: Content-Type, Authorization
  Access-Control-Max-Age: 86400
  X-Content-Type-Options: nosniff
  X-API-Version: 2.0.0

# ============================================
# AUTH ROUTES - SÉCURITÉ RENFORCÉE
# ============================================
/api/auth/*
  Cache-Control: no-store, no-cache, must-revalidate, max-age=0
  X-Frame-Options: DENY
  X-Content-Type-Options: nosniff
  Content-Security-Policy: default-src 'none'; script-src 'self'; style-src 'self'; img-src 'self'; frame-ancestors 'none';

# ============================================
# DOCUMENTS/UPLOADS - SÉCURITÉ + CACHE
# ============================================
/uploads/*
  Cache-Control: private, max-age=86400, must-revalidate
  X-Content-Type-Options: nosniff
  Content-Disposition: attachment
  X-Download-Options: noopen

# ============================================
# PAGES HTML - CACHE MODÉRÉ
# ============================================
/*.html
  Cache-Control: public, max-age=3600, must-revalidate, s-maxage=3600

# ============================================
# ROBOTS & SITEMAP
# ============================================
/robots.txt
  Cache-Control: public, max-age=86400, s-maxage=86400
  Content-Type: text/plain

/sitemap.xml
  Cache-Control: public, max-age=3600, s-maxage=3600
  Content-Type: application/xml
