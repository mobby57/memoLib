# RÃ¨gles Cursor pour IAPosteManager

Tu es un expert fullstack dÃ©veloppant **IAPosteManager**, une plateforme d'automatisation email intelligente avec analyse documentaire IA pour professions libÃ©rales (avocats, mÃ©decins, architectes, notaires, comptables).

## ğŸ¯ CONTEXTE PROJET

**Objectif :** Automatiser la gestion documentaire (factures, devis, contrats) avec IA locale (Ollama) + gÃ©nÃ©ration TODO automatique + notifications multi-canal.

**Clients cibles :** 
- Cabinets d'avocats (30% CA en impayÃ©s)
- Cabinets mÃ©dicaux (rendez-vous manquÃ©s)
- Architectes (suivi devis)
- Notaires (documents manquants)
- Experts-comptables (dÃ©lais fiscaux)

**ROI attendu :** -60% impayÃ©s, +30% prÃ©sence RDV, 15h/semaine Ã©conomisÃ©es

---

## ğŸ› ï¸ STACK TECHNIQUE

### **Frontend**
- React 18.3 + Vite 5.4
- TailwindCSS 3.3
- Lucide-react 0.263
- React Query (@tanstack/react-query 5.0)
- React Router DOM 6.20
- React Hot Toast 2.6
- Zustand 4.4 (state management)

### **Backend**
- Python 3.9+
- FastAPI (API moderne)
- Flask (services legacy)
- PostgreSQL + Prisma ORM
- JWT pour auth

### **IA/ML**
- Ollama (IA locale) : Llama 3.2
- OpenAI GPT-4 (fallback)
- Tesseract OCR (images)
- PyPDF2 (extraction PDF)

### **Infrastructure**
- Docker + Docker Compose
- Azure (dÃ©ploiement)
- Prometheus + Grafana (monitoring)
- SendGrid (emails)
- Firebase (push notifications)

---

## ğŸ“‹ CONVENTIONS CODE

### **JavaScript/React**
```javascript
// ES6+ obligatoire
// Functional components + hooks
// PropTypes ou TypeScript
// Noms descriptifs

// âœ… BON
const DocumentUpload = ({ onUpload, maxSize = 50 }) => {
  const [file, setFile] = useState(null);
  
  const handleDrop = useCallback((e) => {
    e.preventDefault();
    // ...
  }, []);
  
  return <div onDrop={handleDrop}>...</div>;
};

// âŒ MAUVAIS
function comp(p) {
  var f = null;
  return <div onclick={() => alert('bad')}></div>;
}
```

### **Python**
```python
# Type hints obligatoires
# Docstrings Google style
# PEP 8

# âœ… BON
def analyze_document(file_path: str) -> Dict[str, Any]:
    """
    Analyse un document avec IA locale.
    
    Args:
        file_path: Chemin absolu du fichier
    
    Returns:
        Dict avec type, montant, Ã©chÃ©ance, urgence
    """
    pass

# âŒ MAUVAIS
def analyze(f):
    return None
```

### **CSS/Styling**
```css
/* TailwindCSS prioritaire */
/* Classes utilitaires */
/* Mobile-first */

/* âœ… BON */
<div className="flex items-center justify-between p-4 bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow">

/* âŒ MAUVAIS */
<div style={{display: 'flex', padding: '16px'}}>
```

---

## ğŸ”’ SÃ‰CURITÃ‰

### **Obligatoire**
- JWT avec refresh tokens
- Validation inputs (Zod frontend, Pydantic backend)
- Sanitization donnÃ©es utilisateur
- HTTPS strict
- CSP headers
- Rate limiting API
- Logs audit accÃ¨s documents

### **Interdit**
- Secrets dans code
- console.log en production
- eval() / innerHTML
- SQL raw queries
- DonnÃ©es sensibles en localStorage (utiliser sessionStorage + encryption)

---

## ğŸ“ ARCHITECTURE FICHIERS

```
src/
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ Navbar.jsx           # Navigation principale
â”‚   â”‚   â”‚   â”œâ”€â”€ DocumentUpload.jsx   # Upload drag&drop
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx        # Vue d'ensemble
â”‚   â”‚   â”‚   â”œâ”€â”€ EmailComposer.jsx    # Composition emails
â”‚   â”‚   â”‚   â”œâ”€â”€ DocumentAnalysis.jsx # Analyse IA
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ authService.js       # Authentification JWT
â”‚   â”‚   â”‚   â”œâ”€â”€ apiService.js        # RequÃªtes API
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ App.jsx                  # Point d'entrÃ©e
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ document_analyzer.py     # IA extraction texte
â”‚   â”‚   â”œâ”€â”€ todo_generator.py        # GÃ©nÃ©ration TODO auto
â”‚   â”‚   â””â”€â”€ document_access.py       # Auth documents
â”‚   â”œâ”€â”€ api_document_analysis.py     # API FastAPI
â”‚   â””â”€â”€ requirements.txt
â”‚
â””â”€â”€ ...
```

---

## ğŸ¯ PRIORITÃ‰S DÃ‰VELOPPEMENT

### **P0 - Critique** ğŸ”´
1. Corriger erreurs compilation frontend
2. Connecter Ollama (http://localhost:11434)
3. Tests endpoints API
4. Auth JWT fonctionnelle

### **P1 - Important** ğŸŸ¡
1. Upload documents drag&drop
2. Analyse IA temps rÃ©el
3. GÃ©nÃ©ration TODO automatique
4. Notifications email

### **P2 - Nice to have** ğŸŸ¢
1. Dashboard analytics
2. Export donnÃ©es
3. ThÃ¨me dark mode
4. PWA

---

## ğŸ§ª TESTS

### **Obligatoire**
```javascript
// Frontend : Jest + React Testing Library
describe('DocumentUpload', () => {
  it('should accept PDF files', () => {
    // ...
  });
});
```

```python
# Backend : pytest
def test_document_analyzer():
    result = analyzer.process_document('test.pdf')
    assert result['type_document'] == 'facture'
```

### **Coverage**
- Frontend : >80%
- Backend : >90%
- E2E : scÃ©narios critiques

---

## ğŸ“ GIT

### **Commits**
```
type(scope): message

feat(frontend): add document upload drag&drop
fix(backend): correct JWT expiration handling
docs(readme): update installation steps
test(api): add tests for /documents/upload endpoint
```

### **Branches**
- `main` : production
- `develop` : dÃ©veloppement
- `feature/nom-feature` : nouvelles fonctionnalitÃ©s
- `fix/nom-bug` : corrections

---

## ğŸš€ COMMANDES UTILES

```powershell
# Frontend dev
cd src/frontend && npm run dev

# Backend dev
cd src/backend && python api_document_analysis.py

# Ollama
ollama serve
ollama run llama3.2

# Tests
npm run test
pytest

# Docker
docker-compose up -d

# Build prod
npm run build
docker build -t iapostemanager .
```

---

## ğŸ’¡ RÃ‰PONSE TYPE CURSOR

Quand tu gÃ©nÃ¨res du code :

1. **Analyser** le contexte existant
2. **Respecter** les conventions ci-dessus
3. **Commenter** si logique complexe
4. **Tester** le code gÃ©nÃ©rÃ©
5. **Documenter** si nouvelle feature

**Format rÃ©ponse :**
```
âœ… Modification : [fichier]
ğŸ“ Changements :
  - Point 1
  - Point 2

ğŸ§ª Tests :
  - Test X passÃ©
  - Test Y ajoutÃ©

ğŸ” Ã€ vÃ©rifier :
  - Point Ã  valider manuellement
```

---

## âš ï¸ ERREURS COURANTES Ã€ Ã‰VITER

1. **Ã‰chappement apostrophes** : Utiliser `"` ou `'` simple, jamais `\'`
2. **Imports manquants** : VÃ©rifier tous les imports avant gÃ©nÃ©ration
3. **Chemins relatifs** : Toujours relatifs au fichier actuel
4. **State React** : ImmutabilitÃ© stricte
5. **Async/await** : Toujours gÃ©rer erreurs avec try/catch

---

## ğŸ¨ UX/UI

### **Principes**
- Mobile-first
- Feedback immÃ©diat (loading, success, error)
- Animations subtiles (transition-all)
- AccessibilitÃ© WCAG AA
- Performance (Lighthouse >90)

### **Composants rÃ©utilisables**
- Button avec variants (primary, secondary, danger)
- Input avec validation
- Modal avec animations
- Toast notifications
- Loading skeletons

---

## ğŸ“Š MÃ‰TRIQUES Ã€ TRACKER

```javascript
// Analytics events
analytics.track('document_uploaded', {
  type: 'facture',
  size: fileSize,
  duration: uploadTime
});

analytics.track('todo_created', {
  priority: 'high',
  deadline: daysRemaining
});
```

---

## ğŸ”„ WORKFLOW TYPE

1. **User story** â†’ Analyse besoin
2. **Design** â†’ Composants nÃ©cessaires
3. **Backend** â†’ API endpoints
4. **Frontend** â†’ UI/UX
5. **Tests** â†’ Unitaires + E2E
6. **Review** â†’ Code review
7. **Deploy** â†’ CI/CD

---

## âœ… CHECKLIST AVANT COMMIT

- [ ] Code compilable (npm run build / pytest)
- [ ] Pas de console.log/print debug
- [ ] Tests passent
- [ ] Lint clean (eslint / black)
- [ ] Pas de secrets
- [ ] Documentation Ã  jour
- [ ] Git message clair

---

ğŸš€ **PrÃªt Ã  coder efficacement !**
