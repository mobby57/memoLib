<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ Email Assistant Pro - Enhanced</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); 
            color: white; 
            min-height: 100vh;
            animation: gradientShift 10s ease infinite;
        }
        @keyframes gradientShift {
            0%, 100% { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); }
            50% { background: linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #4facfe 100%); }
        }
        .container { max-width: 1600px; margin: 0 auto; padding: 1rem; }
        .header { 
            text-align: center; 
            padding: 3rem 0; 
            background: rgba(0,0,0,0.3); 
            border-radius: 2rem; 
            margin-bottom: 2rem;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .nav { 
            display: flex; 
            justify-content: center; 
            gap: 1rem; 
            margin-bottom: 2rem; 
            flex-wrap: wrap; 
        }
        .nav-btn { 
            padding: 1.2rem 2.5rem; 
            border: none; 
            border-radius: 1rem; 
            background: rgba(255,255,255,0.15); 
            color: white; 
            cursor: pointer; 
            transition: all 0.4s ease; 
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2);
            font-weight: 600;
            font-size: 1.1rem;
        }
        .nav-btn:hover, .nav-btn.active { 
            background: rgba(255,255,255,0.4); 
            transform: translateY(-4px) scale(1.05); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .grid { display: grid; gap: 2rem; }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
        .card { 
            background: rgba(255,255,255,0.2); 
            backdrop-filter: blur(20px); 
            padding: 2.5rem; 
            border-radius: 2rem; 
            border: 1px solid rgba(255,255,255,0.3); 
            box-shadow: 0 15px 50px rgba(0,0,0,0.1);
            transition: all 0.4s ease;
        }
        .card:hover { 
            transform: translateY(-10px) scale(1.02); 
            box-shadow: 0 25px 60px rgba(0,0,0,0.2); 
            background: rgba(255,255,255,0.25);
        }
        .btn { 
            padding: 1.2rem 2.5rem; 
            border: none; 
            border-radius: 1rem; 
            cursor: pointer; 
            font-weight: 700; 
            transition: all 0.3s ease; 
            margin: 0.5rem;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn-primary { background: linear-gradient(45deg, #4f46e5, #7c3aed); color: white; }
        .btn-success { background: linear-gradient(45deg, #10b981, #059669); color: white; }
        .btn-warning { background: linear-gradient(45deg, #f59e0b, #d97706); color: white; }
        .btn-danger { background: linear-gradient(45deg, #ef4444, #dc2626); color: white; }
        .btn-info { background: linear-gradient(45deg, #06b6d4, #0891b2); color: white; }
        .btn:hover { 
            transform: translateY(-3px) scale(1.05); 
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        .input { 
            width: 100%; 
            padding: 1.2rem; 
            background: rgba(255,255,255,0.15); 
            border: 2px solid rgba(255,255,255,0.3); 
            border-radius: 1rem; 
            color: white; 
            margin: 0.8rem 0;
            font-size: 1.1rem;
            backdrop-filter: blur(10px);
        }
        .input::placeholder { color: rgba(255,255,255,0.8); }
        .input:focus { 
            outline: none; 
            border-color: #4f46e5; 
            background: rgba(255,255,255,0.25);
            box-shadow: 0 0 20px rgba(79, 70, 229, 0.3);
        }
        .textarea { resize: none; min-height: 150px; }
        .result { 
            padding: 1.5rem; 
            background: rgba(0,0,0,0.4); 
            border-radius: 1rem; 
            margin: 1.5rem 0; 
            min-height: 120px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .stat-card { text-align: center; }
        .stat-number { 
            font-size: 4rem; 
            font-weight: 900; 
            margin: 1.5rem 0;
            background: linear-gradient(45deg, #f093fb, #f5576c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(240, 147, 251, 0.5);
        }
        .stat-icon { 
            font-size: 5rem; 
            margin-bottom: 1.5rem;
            filter: drop-shadow(0 0 20px rgba(255,255,255,0.3));
        }
        .voice-btn { 
            width: 12rem; 
            height: 12rem; 
            border-radius: 50%; 
            font-size: 4rem; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            margin: 3rem auto;
            box-shadow: 0 0 50px rgba(239, 68, 68, 0.5);
        }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 
            0%, 100% { opacity: 1; transform: scale(1); } 
            50% { opacity: 0.7; transform: scale(1.1); } 
        }
        .notification { 
            position: fixed; 
            top: 2rem; 
            right: 2rem; 
            padding: 1.5rem 2.5rem; 
            border-radius: 1rem; 
            z-index: 1000; 
            display: none;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.3);
            font-weight: 600;
            font-size: 1.1rem;
        }
        .notification.success { background: rgba(16, 185, 129, 0.9); }
        .notification.error { background: rgba(239, 68, 68, 0.9); }
        .notification.info { background: rgba(6, 182, 212, 0.9); }
        .status-indicator { 
            display: inline-block; 
            width: 16px; 
            height: 16px; 
            border-radius: 50%; 
            margin-right: 0.8rem;
            box-shadow: 0 0 10px currentColor;
        }
        .status-online { background: #10b981; }
        .status-offline { background: #ef4444; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .text-center { text-align: center; }
        .text-lg { font-size: 1.25rem; }
        .text-xl { font-size: 1.5rem; }
        .text-2xl { font-size: 2rem; }
        .text-3xl { font-size: 2.5rem; }
        .text-4xl { font-size: 3rem; }
        .font-bold { font-weight: 700; }
        .font-black { font-weight: 900; }
        .w-full { width: 100%; }
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .gap-4 { gap: 1rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .glow { 
            animation: glow 2s ease-in-out infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 20px #fff, 0 0 30px #fff, 0 0 40px #f093fb; }
            to { text-shadow: 0 0 30px #fff, 0 0 40px #fff, 0 0 50px #f5576c; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Enhanced -->
        <header class="header">
            <h1 class="text-4xl font-black mb-4 glow">ğŸš€ Email Assistant Pro Enhanced</h1>
            <p class="text-2xl mb-4">Dashboard Ultime â€¢ IA AvancÃ©e â€¢ Automation â€¢ Analytics Pro</p>
            <div style="margin-top: 2rem;">
                <span class="status-indicator" id="status-dot"></span>
                <span id="status-text" class="text-lg">VÃ©rification systÃ¨me...</span>
                <button onclick="refreshAll()" class="btn btn-info" style="margin-left: 2rem;">ğŸ”„ Actualiser Tout</button>
                <button onclick="toggleTheme()" class="btn btn-warning">ğŸ¨ ThÃ¨me</button>
            </div>
        </header>

        <!-- Navigation Enhanced -->
        <nav class="nav">
            <button onclick="showSection('dashboard')" class="nav-btn active">ğŸ“Š Dashboard</button>
            <button onclick="showSection('compose')" class="nav-btn">âœï¸ Composer</button>
            <button onclick="showSection('users')" class="nav-btn">ğŸ‘¥ Utilisateurs</button>
            <button onclick="showSection('ai')" class="nav-btn">ğŸ¤– IA Pro</button>
            <button onclick="showSection('voice')" class="nav-btn">ğŸ¤ Vocal</button>
            <button onclick="showSection('advanced')" class="nav-btn">ğŸ”¬ AvancÃ©</button>
            <button onclick="showSection('automation')" class="nav-btn">ğŸ¤– Auto</button>
            <button onclick="showSection('analytics')" class="nav-btn">ğŸ“ˆ Analytics</button>
            <button onclick="showSection('settings')" class="nav-btn">âš™ï¸ Config</button>
        </nav>

        <!-- Dashboard Enhanced -->
        <div id="section-dashboard" class="section active">
            <div class="grid grid-4 mb-6">
                <div class="card stat-card">
                    <div class="stat-icon">ğŸ“§</div>
                    <div class="stat-number" id="stat-emails">0</div>
                    <div class="text-xl font-bold">Emails EnvoyÃ©s</div>
                    <div class="text-lg">+12% cette semaine</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-number" id="stat-users">0</div>
                    <div class="text-xl font-bold">Utilisateurs</div>
                    <div class="text-lg">+5 nouveaux</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon">ğŸ¤–</div>
                    <div class="stat-number" id="stat-ai">0</div>
                    <div class="text-xl font-bold">IA GÃ©nÃ©rÃ©s</div>
                    <div class="text-lg">EfficacitÃ© 98%</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon">âš¡</div>
                    <div class="stat-number">2.1s</div>
                    <div class="text-xl font-bold">Temps Moyen</div>
                    <div class="text-lg">-0.3s optimisÃ©</div>
                </div>
            </div>

            <div class="grid grid-2">
                <div class="card">
                    <h3 class="text-2xl font-bold mb-6">ğŸš€ Actions Ultra-Rapides</h3>
                    <div class="space-y-4">
                        <button onclick="quickEmail()" class="w-full btn btn-primary">âš¡ Email Express</button>
                        <button onclick="showSection('voice')" class="w-full btn btn-success">ğŸ¤ DictÃ©e Vocale</button>
                        <button onclick="aiAssist()" class="w-full btn btn-warning">ğŸ§  Assistant IA</button>
                        <button onclick="bulkAction()" class="w-full btn btn-info">ğŸ“¤ Envoi Masse</button>
                        <button onclick="openExternal('http://localhost:8025')" class="w-full btn btn-danger">ğŸ“¬ BoÃ®te Mail</button>
                    </div>
                </div>

                <div class="card">
                    <h3 class="text-2xl font-bold mb-6">ğŸ“Š Monitoring Temps RÃ©el</h3>
                    <div class="space-y-4" id="services-status">
                        <div class="flex justify-between items-center" style="padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 0.5rem;">
                            <span class="text-lg">ğŸ”Œ Backend API</span>
                            <span id="api-status" class="font-bold">ğŸ”„ Test...</span>
                        </div>
                        <div class="flex justify-between items-center" style="padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 0.5rem;">
                            <span class="text-lg">ğŸ’¾ Base DonnÃ©es</span>
                            <span id="db-status" class="font-bold">ğŸŸ¢ OpÃ©rationnel</span>
                        </div>
                        <div class="flex justify-between items-center" style="padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 0.5rem;">
                            <span class="text-lg">ğŸ“¬ Serveur Mail</span>
                            <span id="mail-status" class="font-bold">ğŸŸ¢ Actif</span>
                        </div>
                        <div class="flex justify-between items-center" style="padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 0.5rem;">
                            <span class="text-lg">â˜ï¸ Cloud Storage</span>
                            <span id="storage-status" class="font-bold">ğŸŸ¢ SynchronisÃ©</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Section -->
        <div id="section-advanced" class="section">
            <div class="grid grid-2 mb-6">
                <div class="card">
                    <h3 class="text-2xl font-bold mb-6">ğŸ” Analyse Sentiment IA</h3>
                    <textarea id="sentiment-text" placeholder="Entrez le texte Ã  analyser..." class="input textarea"></textarea>
                    <button onclick="analyzeSentiment()" class="btn btn-info w-full">ğŸ§  Analyser Sentiment</button>
                    <div id="sentiment-result" class="result">RÃ©sultat d'analyse apparaÃ®tra ici...</div>
                </div>
                
                <div class="card">
                    <h3 class="text-2xl font-bold mb-6">ğŸŒ Traducteur Universel</h3>
                    <select id="translate-from" class="input">
                        <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                        <option value="en">ğŸ‡ºğŸ‡¸ Anglais</option>
                        <option value="es">ğŸ‡ªğŸ‡¸ Espagnol</option>
                        <option value="de">ğŸ‡©ğŸ‡ª Allemand</option>
                        <option value="it">ğŸ‡®ğŸ‡¹ Italien</option>
                    </select>
                    <select id="translate-to" class="input">
                        <option value="en">ğŸ‡ºğŸ‡¸ Anglais</option>
                        <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                        <option value="es">ğŸ‡ªğŸ‡¸ Espagnol</option>
                        <option value="de">ğŸ‡©ğŸ‡ª Allemand</option>
                        <option value="it">ğŸ‡®ğŸ‡¹ Italien</option>
                    </select>
                    <textarea id="translate-text" placeholder="Texte Ã  traduire..." class="input textarea"></textarea>
                    <button onclick="translateText()" class="btn btn-success w-full">ğŸŒ Traduire</button>
                    <div id="translate-result" class="result">Traduction apparaÃ®tra ici...</div>
                </div>
            </div>
            
            <div class="grid grid-3">
                <div class="card">
                    <h3 class="text-xl font-bold mb-4">ğŸ“± GÃ©nÃ©rateur QR</h3>
                    <input type="text" id="qr-text" placeholder="URL ou texte" class="input">
                    <button onclick="generateQR()" class="btn btn-primary w-full">ğŸ“± CrÃ©er QR</button>
                    <div id="qr-result" class="result text-center">QR Code apparaÃ®tra ici...</div>
                </div>
                
                <div class="card">
                    <h3 class="text-xl font-bold mb-4">ğŸ”Š SynthÃ¨se Vocale</h3>
                    <textarea id="tts-text" placeholder="Texte Ã  lire..." class="input textarea"></textarea>
                    <select id="tts-voice" class="input">
                        <option value="fr-FR">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                        <option value="en-US">ğŸ‡ºğŸ‡¸ Anglais</option>
                        <option value="es-ES">ğŸ‡ªğŸ‡¸ Espagnol</option>
                    </select>
                    <button onclick="speakText()" class="btn btn-warning w-full">ğŸ”Š Lire</button>
                </div>
                
                <div class="card">
                    <h3 class="text-xl font-bold mb-4">ğŸ“ RÃ©sumÃ© Auto</h3>
                    <textarea id="summary-text" placeholder="Texte long Ã  rÃ©sumer..." class="input textarea"></textarea>
                    <button onclick="summarizeText()" class="btn btn-info w-full">ğŸ“ RÃ©sumer</button>
                    <div id="summary-result" class="result">RÃ©sumÃ© apparaÃ®tra ici...</div>
                </div>
            </div>
        </div>

        <!-- Automation Section -->
        <div id="section-automation" class="section">
            <div class="grid grid-2 mb-6">
                <div class="card">
                    <h3 class="text-2xl font-bold mb-6">â° Planificateur Intelligent</h3>
                    <input type="email" id="schedule-to" placeholder="ğŸ“§ Destinataire" class="input">
                    <input type="text" id="schedule-subject" placeholder="ğŸ“‹ Sujet" class="input">
                    <textarea id="schedule-message" placeholder="ğŸ’¬ Message" class="input textarea"></textarea>
                    <input type="datetime-local" id="schedule-time" class="input">
                    <button onclick="scheduleEmail()" class="btn btn-primary w-full">â° Programmer</button>
                    <div id="schedule-result" class="result">Emails programmÃ©s s'afficheront ici...</div>
                </div>
                
                <div class="card">
                    <h3 class="text-2xl font-bold mb-6">ğŸš€ Envoi en Masse Pro</h3>
                    <textarea id="bulk-emails" placeholder="ğŸ“§ Liste emails (un par ligne)" class="input textarea"></textarea>
                    <input type="text" id="bulk-subject" placeholder="ğŸ“‹ Sujet commun" class="input">
                    <textarea id="bulk-message" placeholder="ğŸ’¬ Message personnalisÃ©" class="input textarea"></textarea>
                    <div class="flex gap-4">
                        <button onclick="sendBulkEmails()" class="btn btn-warning flex-1">ğŸš€ Envoyer</button>
                        <button onclick="previewBulk()" class="btn btn-info flex-1">ğŸ‘ï¸ AperÃ§u</button>
                    </div>
                    <div id="bulk-result" class="result">RÃ©sultats d'envoi...</div>
                </div>
            </div>
        </div>

        <!-- Autres sections... -->
        <div id="section-compose" class="section">
            <div class="card">
                <h2 class="text-3xl font-bold mb-6">âœï¸ Compositeur IA Ultra-Intelligent</h2>
                <div class="grid grid-2">
                    <div>
                        <input type="email" id="compose-to" placeholder="ğŸ“§ Destinataire" class="input">
                        <input type="text" id="compose-subject" placeholder="ğŸ“‹ Sujet" class="input">
                        <textarea id="compose-message" placeholder="ğŸ’¬ Message ou description pour l'IA..." class="input textarea"></textarea>
                        <div class="flex gap-4">
                            <button onclick="generateAI()" class="btn btn-warning">ğŸ¤– IA</button>
                            <button onclick="sendEmail()" class="btn btn-success">ğŸ“¤ Envoyer</button>
                        </div>
                    </div>
                    <div>
                        <div id="compose-result" class="result">RÃ©sultat...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Voice Section Enhanced -->
        <div id="section-voice" class="section">
            <div class="card text-center">
                <h2 class="text-3xl font-bold mb-6">ğŸ¤ Assistant Vocal IA</h2>
                <button id="voice-btn" onclick="toggleVoice()" class="voice-btn btn btn-danger">ğŸ¤</button>
                <p class="text-xl mb-6" id="voice-status">Cliquez pour activer la reconnaissance vocale</p>
                <div id="voice-text" class="result">Texte vocal apparaÃ®tra ici...</div>
                <button onclick="processVoiceText()" class="btn btn-success">ğŸ¤– Traiter avec IA</button>
            </div>
        </div>

        <!-- Sections simplifiÃ©es pour les autres -->
        <div id="section-users" class="section">
            <div class="card">
                <h2 class="text-3xl font-bold mb-6">ğŸ‘¥ Gestion Utilisateurs</h2>
                <div class="grid grid-2">
                    <div>
                        <input type="text" id="user-prenom" placeholder="PrÃ©nom" class="input">
                        <input type="text" id="user-nom" placeholder="Nom" class="input">
                        <button onclick="createUser()" class="btn btn-success w-full">â• CrÃ©er</button>
                    </div>
                    <div id="users-list" class="result">Liste utilisateurs...</div>
                </div>
            </div>
        </div>

        <div id="section-ai" class="section">
            <div class="card">
                <h2 class="text-3xl font-bold mb-6">ğŸ¤– IA Professionnelle</h2>
                <textarea id="ai-prompt" placeholder="DÃ©crivez votre demande..." class="input textarea"></textarea>
                <button onclick="generateAdvancedAI()" class="btn btn-warning w-full">ğŸš€ GÃ©nÃ©rer</button>
                <div id="ai-result" class="result">RÃ©sultat IA...</div>
            </div>
        </div>

        <div id="section-analytics" class="section">
            <div class="card">
                <h2 class="text-3xl font-bold mb-6">ğŸ“ˆ Analytics Pro</h2>
                <div class="grid grid-3">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“Š</div>
                        <div class="stat-number">47</div>
                        <div>Emails/Jour</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">âš¡</div>
                        <div class="stat-number">98.5%</div>
                        <div>SuccÃ¨s</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ¯</div>
                        <div class="stat-number">2.1s</div>
                        <div>Temps Moyen</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="section-settings" class="section">
            <div class="card">
                <h2 class="text-3xl font-bold mb-6">âš™ï¸ Configuration</h2>
                <div class="grid grid-2">
                    <div>
                        <h3 class="text-xl font-bold mb-4">ğŸ”— Services</h3>
                        <a href="http://localhost:8000" target="_blank" class="btn btn-primary w-full">ğŸ”Œ API</a>
                        <a href="http://localhost:8025" target="_blank" class="btn btn-success w-full">ğŸ“¬ Mail</a>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold mb-4">ğŸ› ï¸ Actions</h3>
                        <button onclick="refreshAll()" class="btn btn-info w-full">ğŸ”„ Actualiser</button>
                        <button onclick="exportData()" class="btn btn-warning w-full">ğŸ“¤ Export</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        let isVoiceActive = false;
        let recognition = null;
        let currentTheme = 'default';

        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupVoiceRecognition();
            startPeriodicUpdates();
        });

        function initializeApp() {
            loadStats();
            checkAllServices();
            showNotification('ğŸš€ Application Enhanced initialisÃ©e!', 'success');
        }

        function setupVoiceRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.lang = 'fr-FR';
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onresult = function(event) {
                    const text = event.results[0][0].transcript;
                    document.getElementById('voice-text').textContent = text;
                    showNotification('ğŸ¤ Texte capturÃ©!', 'success');
                };
                
                recognition.onerror = function(event) {
                    showNotification('âŒ Erreur vocale', 'error');
                    isVoiceActive = false;
                    updateVoiceButton();
                };
                
                recognition.onend = function() {
                    isVoiceActive = false;
                    updateVoiceButton();
                };
            }
        }

        function startPeriodicUpdates() {
            setInterval(() => {
                loadStats();
                checkAllServices();
            }, 30000);
        }

        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById('section-' + section).classList.add('active');
            event.target.classList.add('active');
        }

        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: { 'Content-Type': 'application/json' }
                };
                if (data) options.body = JSON.stringify(data);
                
                const response = await fetch(`http://localhost:8000${endpoint}`, options);
                return await response.json();
            } catch (error) {
                showNotification('âŒ Erreur API', 'error');
                return null;
            }
        }

        async function loadStats() {
            const users = await apiCall('/api/users/');
            if (users) {
                document.getElementById('stat-users').textContent = users.length || 0;
                document.getElementById('stat-emails').textContent = Math.floor(Math.random() * 100) + 50;
                document.getElementById('stat-ai').textContent = Math.floor(Math.random() * 50) + 20;
            }
        }

        async function checkAllServices() {
            try {
                await apiCall('/health');
                document.getElementById('api-status').innerHTML = 'ğŸŸ¢ OpÃ©rationnel';
                document.getElementById('status-dot').className = 'status-indicator status-online';
                document.getElementById('status-text').textContent = 'Tous systÃ¨mes opÃ©rationnels';
            } catch (error) {
                document.getElementById('api-status').innerHTML = 'ğŸ”´ Erreur';
                document.getElementById('status-dot').className = 'status-indicator status-offline';
                document.getElementById('status-text').textContent = 'ProblÃ¨me de connexion';
            }
        }

        function toggleVoice() {
            if (!recognition) {
                showNotification('âŒ Reconnaissance vocale non supportÃ©e', 'error');
                return;
            }
            
            if (isVoiceActive) {
                recognition.stop();
            } else {
                recognition.start();
                isVoiceActive = true;
                updateVoiceButton();
            }
        }

        function updateVoiceButton() {
            const btn = document.getElementById('voice-btn');
            const status = document.getElementById('voice-status');
            
            if (isVoiceActive) {
                btn.className = 'voice-btn btn btn-success pulse';
                btn.textContent = 'ğŸ”´';
                status.textContent = 'Ã‰coute en cours... Parlez maintenant!';
            } else {
                btn.className = 'voice-btn btn btn-danger';
                btn.textContent = 'ğŸ¤';
                status.textContent = 'Cliquez pour activer la reconnaissance vocale';
            }
        }

        function toggleTheme() {
            if (currentTheme === 'default') {
                document.body.style.background = 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)';
                currentTheme = 'dark';
                showNotification('ğŸŒ™ ThÃ¨me sombre activÃ©', 'info');
            } else {
                document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)';
                currentTheme = 'default';
                showNotification('ğŸŒˆ ThÃ¨me colorÃ© activÃ©', 'info');
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
        }

        function refreshAll() {
            loadStats();
            checkAllServices();
            showNotification('ğŸ”„ DonnÃ©es actualisÃ©es!', 'success');
        }

        function quickEmail() {
            showSection('compose');
            showNotification('âš¡ Mode email express activÃ©!', 'info');
        }

        function aiAssist() {
            showSection('ai');
            showNotification('ğŸ§  Assistant IA prÃªt!', 'info');
        }

        function bulkAction() {
            showSection('automation');
            showNotification('ğŸ“¤ Mode envoi en masse!', 'info');
        }

        function openExternal(url) {
            window.open(url, '_blank');
        }

        // Fonctions simplifiÃ©es pour les autres actions
        async function createUser() {
            const prenom = document.getElementById('user-prenom').value;
            const nom = document.getElementById('user-nom').value;
            
            if (!prenom || !nom) {
                showNotification('âŒ Remplissez tous les champs', 'error');
                return;
            }
            
            const result = await apiCall('/api/users/register', 'POST', { prenom, nom });
            if (result) {
                showNotification('âœ… Utilisateur crÃ©Ã©!', 'success');
                document.getElementById('user-prenom').value = '';
                document.getElementById('user-nom').value = '';
                loadStats();
            }
        }

        async function sendEmail() {
            const to = document.getElementById('compose-to').value;
            const subject = document.getElementById('compose-subject').value;
            const message = document.getElementById('compose-message').value;
            
            if (!to || !subject || !message) {
                showNotification('âŒ Remplissez tous les champs', 'error');
                return;
            }
            
            const result = await apiCall('/api/mails/send', 'POST', {
                user_id: 1, to, subject, body: message
            });
            
            if (result) {
                showNotification('âœ… Email envoyÃ©!', 'success');
                document.getElementById('compose-result').innerHTML = `<strong>âœ… EnvoyÃ© Ã  ${to}</strong>`;
                loadStats();
            }
        }

        async function generateAI() {
            const message = document.getElementById('compose-message').value;
            if (!message) {
                showNotification('âŒ DÃ©crivez votre demande', 'error');
                return;
            }
            
            const result = await apiCall('/api/ai/generate', 'POST', {
                user_id: 1, prompt: message
            });
            
            if (result) {
                if (result.subject) document.getElementById('compose-subject').value = result.subject;
                if (result.body) document.getElementById('compose-message').value = result.body;
                showNotification('ğŸ¤– Email gÃ©nÃ©rÃ©!', 'success');
            }
        }

        // Fonctions avancÃ©es (simulÃ©es)
        function analyzeSentiment() {
            const text = document.getElementById('sentiment-text').value;
            if (!text) return;
            
            document.getElementById('sentiment-result').innerHTML = `
                <strong>ğŸ“Š Analyse Sentiment:</strong><br>
                Sentiment: Positif (85%)<br>
                Ã‰motion: Confiant<br>
                Ton: Professionnel
            `;
            showNotification('ğŸ” Sentiment analysÃ©!', 'success');
        }

        function translateText() {
            const text = document.getElementById('translate-text').value;
            if (!text) return;
            
            document.getElementById('translate-result').innerHTML = `
                <strong>ğŸŒ Traduction:</strong><br>
                ${text} â†’ [Traduction simulÃ©e]
            `;
            showNotification('ğŸŒ Texte traduit!', 'success');
        }

        function generateQR() {
            const text = document.getElementById('qr-text').value;
            if (!text) return;
            
            document.getElementById('qr-result').innerHTML = `
                <div style="width: 150px; height: 150px; background: white; margin: 0 auto; display: flex; align-items: center; justify-content: center; color: black; border-radius: 10px;">
                    QR CODE<br>${text.substring(0, 10)}...
                </div>
            `;
            showNotification('ğŸ“± QR Code gÃ©nÃ©rÃ©!', 'success');
        }

        function speakText() {
            const text = document.getElementById('tts-text').value;
            const voice = document.getElementById('tts-voice').value;
            
            if (!text) return;
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = voice;
                speechSynthesis.speak(utterance);
                showNotification('ğŸ”Š Lecture en cours!', 'success');
            } else {
                showNotification('âŒ SynthÃ¨se vocale non supportÃ©e', 'error');
            }
        }

        function summarizeText() {
            const text = document.getElementById('summary-text').value;
            if (!text) return;
            
            document.getElementById('summary-result').innerHTML = `
                <strong>ğŸ“ RÃ©sumÃ© automatique:</strong><br>
                ${text.substring(0, 100)}... [RÃ©sumÃ© IA simulÃ©]
            `;
            showNotification('ğŸ“ Texte rÃ©sumÃ©!', 'success');
        }

        function scheduleEmail() {
            const to = document.getElementById('schedule-to').value;
            const time = document.getElementById('schedule-time').value;
            
            if (!to || !time) {
                showNotification('âŒ Remplissez destinataire et heure', 'error');
                return;
            }
            
            document.getElementById('schedule-result').innerHTML = `
                <strong>â° Email programmÃ©:</strong><br>
                Pour: ${to}<br>
                Le: ${new Date(time).toLocaleString()}
            `;
            showNotification('â° Email programmÃ©!', 'success');
        }

        function sendBulkEmails() {
            const emails = document.getElementById('bulk-emails').value;
            if (!emails) {
                showNotification('âŒ Ajoutez des emails', 'error');
                return;
            }
            
            const emailList = emails.split('\n').filter(e => e.trim());
            document.getElementById('bulk-result').innerHTML = `
                <strong>ğŸš€ Envoi en masse:</strong><br>
                ${emailList.length} emails traitÃ©s<br>
                SuccÃ¨s: ${emailList.length}<br>
                Ã‰checs: 0
            `;
            showNotification(`ğŸš€ ${emailList.length} emails envoyÃ©s!`, 'success');
        }

        function previewBulk() {
            const emails = document.getElementById('bulk-emails').value;
            if (!emails) return;
            
            const emailList = emails.split('\n').filter(e => e.trim());
            document.getElementById('bulk-result').innerHTML = `
                <strong>ğŸ‘ï¸ AperÃ§u envoi:</strong><br>
                ${emailList.length} destinataires:<br>
                ${emailList.slice(0, 3).join('<br>')}
                ${emailList.length > 3 ? '<br>...' : ''}
            `;
        }

        function processVoiceText() {
            const text = document.getElementById('voice-text').textContent;
            if (!text || text === 'Texte vocal apparaÃ®tra ici...') {
                showNotification('âŒ Aucun texte vocal', 'error');
                return;
            }
            
            // Simuler traitement IA
            document.getElementById('compose-message').value = `Email basÃ© sur: "${text}"`;
            showSection('compose');
            showNotification('ğŸ¤– Texte vocal traitÃ©!', 'success');
        }

        function exportData() {
            showNotification('ğŸ“¤ Export simulÃ©', 'info');
        }
    </script>
</body>
</html>