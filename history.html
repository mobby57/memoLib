<!DOCTYPE html>
<html>
<head>
    <title>Historique - IAPosteManager</title>
    <style>
        body { font-family: Arial; margin: 0; background: #f8fafc; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .back-btn { background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        .filters { display: flex; gap: 10px; margin-bottom: 20px; }
        .filters input, .filters select { padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .email-list { background: white; border-radius: 8px; overflow: hidden; }
        .email-item { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .email-item:hover { background: #f8f9fa; }
        .email-info { flex: 1; }
        .email-to { font-weight: bold; color: #333; }
        .email-subject { color: #666; margin: 5px 0; }
        .email-date { color: #999; font-size: 14px; }
        .status { padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .status-sent { background: #d4edda; color: #155724; }
        .status-failed { background: #f8d7da; color: #721c24; }
        .status-pending { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã Historique des Emails</h1>
            <button class="back-btn" onclick="window.location.href='/navigation.html'">‚Üê Retour</button>
        </div>
        
        <div class="filters">
            <input type="text" id="search" placeholder="üîç Rechercher...">
            <select id="status">
                <option value="">Tous les statuts</option>
                <option value="sent">Envoy√©s</option>
                <option value="failed">√âchou√©s</option>
                <option value="pending">En attente</option>
            </select>
            <select id="period">
                <option value="">Toutes les p√©riodes</option>
                <option value="today">Aujourd'hui</option>
                <option value="week">Cette semaine</option>
                <option value="month">Ce mois</option>
            </select>
        </div>
        
        <div class="email-list" id="emailList">
            <div style="padding: 40px; text-align: center; color: #666;">
                üìß Chargement de l'historique...
            </div>
        </div>
    </div>

    <script>
        async function loadHistory() {
            try {
                const response = await fetch('/api/email-history?limit=50');
                const data = await response.json();
                const emails = data.emails || data || [];
                
                const emailList = document.getElementById('emailList');
                
                if (emails.length === 0) {
                    emailList.innerHTML = '<div style="padding: 40px; text-align: center; color: #666;">üì≠ Aucun email dans l\'historique</div>';
                    return;
                }
                
                emailList.innerHTML = emails.map(email => `
                    <div class="email-item">
                        <div class="email-info">
                            <div class="email-to">üìß ${email.recipient || 'Destinataire inconnu'}</div>
                            <div class="email-subject">${email.subject || 'Sans sujet'}</div>
                            <div class="email-date">${formatDate(email.created_at)}</div>
                        </div>
                        <span class="status status-${email.status || 'pending'}">
                            ${getStatusLabel(email.status || 'pending')}
                        </span>
                    </div>
                `).join('');
                
            } catch (error) {
                document.getElementById('emailList').innerHTML = '<div style="padding: 40px; text-align: center; color: #dc3545;">‚ùå Erreur de chargement</div>';
            }
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return 'Date inconnue';
            const date = new Date(dateStr);
            return date.toLocaleDateString('fr-FR') + ' √† ' + date.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'});
        }
        
        function getStatusLabel(status) {
            const labels = {
                'sent': '‚úÖ Envoy√©',
                'failed': '‚ùå √âchec',
                'pending': '‚è≥ En attente',
                'simulated': 'üîÑ Simul√©'
            };
            return labels[status] || '‚ùì Inconnu';
        }
        
        window.onload = loadHistory;
    </script>
</body>
</html>