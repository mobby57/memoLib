(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,279616,e=>{"use strict";var t=e.i(843476),s=e.i(271645);function r(){let[e,r]=(0,s.useState)([]),[l,a]=(0,s.useState)(!0),[i,n]=(0,s.useState)(null),[d,c]=(0,s.useState)(""),[o,x]=(0,s.useState)(""),[u,m]=(0,s.useState)(""),[h,p]=(0,s.useState)(!1),g=async()=>{try{a(!0);let e=new URLSearchParams;d&&e.append("level",d),o&&e.append("action",o),e.append("limit","100");let t=await fetch(`/api/admin/logs?${e.toString()}`);if(!t.ok)throw Error("Erreur lors du chargement des logs");let s=await t.json();r(s.logs),n(null)}catch(e){n(e instanceof Error?e.message:"Erreur inconnue")}finally{a(!1)}};(0,s.useEffect)(()=>{g()},[d,o]),(0,s.useEffect)(()=>{if(!h)return;let e=setInterval(g,5e3);return()=>clearInterval(e)},[h,d,o]);let j=e.filter(e=>{if(!u)return!0;let t=u.toLowerCase();return e.message.toLowerCase().includes(t)||e.level.toLowerCase().includes(t)||JSON.stringify(e.context||{}).toLowerCase().includes(t)}),v=e=>({debug:"bg-gray-100 text-gray-800",info:"bg-blue-100 text-blue-800",warn:"bg-yellow-100 text-yellow-800",error:"bg-red-100 text-red-800",critical:"bg-red-900 text-white"})[e]||"bg-gray-100",b=e=>({debug:"[Search]",info:"[Info]",warn:"[Warning]",error:"[Error]",critical:"[Alert]"})[e]||"";return(0,t.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"[Chart] Monitoring - Logs systeme"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>p(!h),className:`px-4 py-2 rounded ${h?"bg-green-500 text-white":"bg-gray-200 text-gray-700"}`,children:h?"[Pause] Pause":"[Play] Auto-refresh (5s)"}),(0,t.jsx)("button",{onClick:g,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"[Refresh] Actualiser"}),(0,t.jsx)("button",{onClick:()=>{let e=new Blob([["Timestamp,Level,Message,Action,UserId,TenantId,DossierId",...j.map(e=>[e.timestamp,e.level,e.message,e.actionJuridique||"",e.userId||"",e.tenantId||"",e.dossierId||""]).map(e=>e.map(e=>`"${e}"`).join(","))].join("\n")],{type:"text/csv"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=`logs_${new Date().toISOString()}.csv`,s.click(),URL.revokeObjectURL(t)},className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",disabled:0===j.length,children:"[Download] Export CSV"})]})]}),(0,t.jsx)("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Niveau"}),(0,t.jsxs)("select",{value:d,onChange:e=>c(e.target.value),className:"w-full p-2 border rounded",children:[(0,t.jsx)("option",{value:"",children:"Tous"}),(0,t.jsx)("option",{value:"debug",children:"[Search] Debug"}),(0,t.jsx)("option",{value:"info",children:"[Info] Info"}),(0,t.jsx)("option",{value:"warn",children:"[Warning] Warning"}),(0,t.jsx)("option",{value:"error",children:"[Error] Error"}),(0,t.jsx)("option",{value:"critical",children:"[Alert] Critical"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Action juridique"}),(0,t.jsxs)("select",{value:o,onChange:e=>x(e.target.value),className:"w-full p-2 border rounded",children:[(0,t.jsx)("option",{value:"",children:"Toutes"}),(0,t.jsx)("option",{value:"CREATE_DOSSIER",children:"Creer dossier"}),(0,t.jsx)("option",{value:"UPDATE_DOSSIER",children:"Modifier dossier"}),(0,t.jsx)("option",{value:"DELETE_DOSSIER",children:"Supprimer dossier"}),(0,t.jsx)("option",{value:"ADD_DOCUMENT",children:"Ajouter document"}),(0,t.jsx)("option",{value:"AI_ANALYSIS",children:"Analyse IA"}),(0,t.jsx)("option",{value:"AI_SUGGESTION",children:"Suggestion IA"}),(0,t.jsx)("option",{value:"GENERATE_RECOURS",children:"Generer recours"}),(0,t.jsx)("option",{value:"CREATE_DEADLINE",children:"Creer delai"}),(0,t.jsx)("option",{value:"USER_LOGIN",children:"Connexion"}),(0,t.jsx)("option",{value:"PERMISSION_DENIED",children:"Acces refuse"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Recherche"}),(0,t.jsx)("input",{type:"text",value:u,onChange:e=>m(e.target.value),placeholder:"Rechercher dans les logs...",className:"w-full p-2 border rounded"})]})]})}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:["debug","info","warn","error","critical"].map(e=>{let s=j.filter(t=>t.level===e).length;return(0,t.jsxs)("div",{className:`p-4 rounded-lg shadow ${v(e)}`,children:[(0,t.jsx)("div",{className:"text-2xl mb-1",children:b(e)}),(0,t.jsx)("div",{className:"text-2xl font-bold",children:s}),(0,t.jsx)("div",{className:"text-sm capitalize",children:e})]},e)})}),i&&(0,t.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:i}),l&&(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"}),(0,t.jsx)("p",{className:"mt-2",children:"Chargement des logs..."})]}),!l&&0===j.length&&(0,t.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Aucun log a afficher"}),!l&&j.length>0&&(0,t.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Timestamp"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Level"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Message"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Action"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Context"})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map((e,s)=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.timestamp).toLocaleString("fr-FR")}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsxs)("span",{className:`px-2 py-1 text-xs rounded ${v(e.level)}`,children:[b(e.level)," ",e.level.toUpperCase()]})}),(0,t.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.message}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.actionJuridique||"-"}),(0,t.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:e.context&&(0,t.jsxs)("details",{className:"cursor-pointer",children:[(0,t.jsx)("summary",{className:"text-blue-600 hover:text-blue-800",children:"Voir details"}),(0,t.jsx)("pre",{className:"mt-2 text-xs bg-gray-100 p-2 rounded overflow-x-auto",children:JSON.stringify(e.context,null,2)})]})})]},s))})]})})}),(0,t.jsxs)("div",{className:"mt-4 text-sm text-gray-500 text-center",children:["Affichage de ",j.length," log(s)"]})]})}e.s(["default",()=>r,"dynamic",0,"force-dynamic"])}]);