(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,600893,e=>{"use strict";var s=e.i(843476),t=e.i(217255),a=e.i(618566),l=e.i(271645),r=e.i(522016);function i(){let e,{data:i,status:n}=(0,t.useSession)(),d=(0,a.useRouter)(),[c,o]=(0,l.useState)([]),[x,m]=(0,l.useState)(!0),[h,u]=(0,l.useState)(!1),[g,p]=(0,l.useState)("");(0,l.useEffect)(()=>{"unauthenticated"===n?d.push("/auth/login"):i?.user&&"CLIENT"!==i.user.role?d.push("/dashboard"):i?.user?.role==="CLIENT"&&b()},[i,n,d]);let b=async()=>{try{let e=await fetch("/api/client/messages");if(e.ok){let s=await e.json();o(s.messages||[]);let t=s.messages.filter(e=>!e.read&&"CLIENT"!==e.senderRole).map(e=>e.id);t.length>0&&await fetch("/api/client/messages/mark-read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageIds:t})})}m(!1)}catch(e){console.error("Error fetching messages:",e),m(!1)}},f=async e=>{if(e.preventDefault(),g.trim()){u(!0);try{(await fetch("/api/client/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:g})})).ok?(p(""),await b()):alert("Erreur lors de l'envoi du message")}catch(e){alert("Erreur de connexion")}finally{u(!1)}}},j=(e={},c.forEach(s=>{let t=new Date(s.createdAt).toLocaleDateString("fr-FR");e[t]||(e[t]=[]),e[t].push(s)}),e);return x?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Chargement des messages..."})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 flex flex-col",children:[(0,s.jsx)("header",{className:"bg-white shadow-md border-b border-gray-200",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-8 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(r.default,{href:"/client",className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,s.jsx)("span",{className:"text-2xl",children:"[Back]"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"Messagerie"}),(0,s.jsx)("p",{className:"text-gray-600 mt-1",children:"Communication avec votre avocat"})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:(0,s.jsx)("div",{className:"bg-blue-100 px-4 py-2 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800 font-semibold",children:[c.filter(e=>!e.read&&"CLIENT"!==e.senderRole).length," non lu(s)"]})})})]})})}),(0,s.jsxs)("main",{className:"flex-1 max-w-5xl mx-auto px-8 py-8 w-full flex flex-col",children:[(0,s.jsx)("div",{className:"flex-1 bg-white rounded-xl shadow-lg mb-4 overflow-hidden flex flex-col",children:(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:0===c.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("span",{className:"text-6xl mb-4 block",children:"[emoji]"}),(0,s.jsx)("p",{className:"text-gray-500 text-lg",children:"Aucun message pour le moment"}),(0,s.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:"Commencez une conversation avec votre avocat"})]}):Object.entries(j).map(([e,t])=>(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"flex items-center justify-center my-6",children:(0,s.jsx)("div",{className:"bg-gray-200 px-4 py-2 rounded-full",children:(0,s.jsx)("p",{className:"text-xs font-semibold text-gray-600",children:e})})}),t.map(e=>{let t="CLIENT"===e.senderRole;return(0,s.jsx)("div",{className:`flex ${t?"justify-end":"justify-start"} mb-4`,children:(0,s.jsxs)("div",{className:`max-w-md ${t?"bg-blue-500 text-white rounded-l-2xl rounded-tr-2xl":"bg-gray-100 text-gray-900 rounded-r-2xl rounded-tl-2xl"} px-5 py-3 shadow-md`,children:[!t&&(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-white text-sm font-bold",children:e.senderName.charAt(0)}),(0,s.jsx)("p",{className:"font-semibold text-sm text-gray-700",children:e.senderName}),(0,s.jsx)("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full",children:"Avocat"})]}),(0,s.jsx)("p",{className:`${t?"text-white":"text-gray-800"} leading-relaxed`,children:e.content}),e.attachments&&e.attachments.length>0&&(0,s.jsx)("div",{className:"mt-3 space-y-2",children:e.attachments.map((e,a)=>(0,s.jsxs)("div",{className:`flex items-center gap-2 p-2 rounded ${t?"bg-blue-600":"bg-gray-200"}`,children:[(0,s.jsx)("span",{className:"text-lg",children:"[emoji]"}),(0,s.jsx)("span",{className:"text-sm",children:e})]},a))}),(0,s.jsx)("p",{className:`text-xs mt-2 ${t?"text-blue-100":"text-gray-500"}`,children:new Date(e.createdAt).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})})]})},e.id)})]},e))})}),(0,s.jsxs)("form",{onSubmit:f,className:"bg-white rounded-xl shadow-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-end gap-4",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("textarea",{value:g,onChange:e=>p(e.target.value),placeholder:"ecrivez votre message...",rows:3,disabled:h,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-blue-500 focus:outline-none resize-none"})}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("button",{type:"button",className:"p-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",title:"Joindre un fichier",children:(0,s.jsx)("span",{className:"text-2xl",children:"[emoji]"})}),(0,s.jsx)("button",{type:"submit",disabled:h||!g.trim(),className:"px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:h?"":"[emoji]"})]})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"[emoji] Votre avocat sera notifie par email de votre message"})]})]}),(0,s.jsx)("div",{className:"max-w-5xl mx-auto px-8 pb-8 w-full",children:(0,s.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("span",{className:"text-2xl",children:"ï¸"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold text-yellow-800 mb-1",children:"Informations importantes"}),(0,s.jsxs)("ul",{className:"text-sm text-yellow-700 space-y-1",children:[(0,s.jsx)("li",{children:"- Les messages sont consultables par votre avocat et son equipe"}),(0,s.jsx)("li",{children:"- evitez de partager des informations sensibles (mots de passe, codes PIN)"}),(0,s.jsx)("li",{children:"- Pour les urgences, contactez directement votre cabinet par telephone"}),(0,s.jsx)("li",{children:"- Les messages sont archives et peuvent servir de preuve"})]})]})]})})})]})}e.s(["default",()=>i,"dynamic",0,"force-dynamic"])}]);