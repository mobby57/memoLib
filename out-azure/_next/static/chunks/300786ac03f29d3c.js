(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,772919,e=>{"use strict";var s,t,r=((s={}).FAIBLE="faible",s.MOYEN="moyen",s.ELEVE="eleve",s.CRITIQUE="critique",s),a=((t={}).VERIFICATIONS="verifications",t.PIECES="pieces",t.ACTIONS="actions",t);e.s(["ChecklistCategory",()=>a,"PROCEDURE_COLORS",0,{OQTF:"#B91C1C",REFUS_TITRE:"#CA8A04",RETRAIT_TITRE:"#EA580C",ASILE:"#1E40AF",REGROUPEMENT_FAMILIAL:"#7C3AED",NATURALISATION:"#059669"},"PROCEDURE_LABELS",0,{OQTF:"OQTF (Obligation de Quitter le Territoire Francais)",REFUS_TITRE:"Refus de Titre de Sejour",RETRAIT_TITRE:"Retrait de Titre de Sejour",ASILE:"Demande d'Asile",REGROUPEMENT_FAMILIAL:"Regroupement Familial",NATURALISATION:"Naturalisation Francaise"},"URGENCY_COLORS",0,{faible:"#10B981",moyen:"#F59E0B",eleve:"#EA580C",critique:"#DC2626"},"UrgencyLevel",()=>r])},502166,e=>{"use strict";var s=e.i(843476),t=e.i(772919);function r({level:e,label:r,size:a="md"}){return(0,s.jsxs)("span",{className:`inline-flex items-center gap-1 font-semibold rounded-full ${{sm:"px-2 py-0.5 text-xs",md:"px-3 py-1 text-sm",lg:"px-4 py-2 text-base"}[a]}`,style:{backgroundColor:`${t.URGENCY_COLORS[e]}20`,color:t.URGENCY_COLORS[e],border:`1px solid ${t.URGENCY_COLORS[e]}`},children:[(0,s.jsx)("span",{children:(()=>{switch(e){case t.UrgencyLevel.CRITIQUE:case t.UrgencyLevel.ELEVE:case t.UrgencyLevel.MOYEN:case t.UrgencyLevel.FAIBLE:return"[emoji]"}})()}),(0,s.jsx)("span",{children:r||(()=>{switch(e){case t.UrgencyLevel.CRITIQUE:return"Critique";case t.UrgencyLevel.ELEVE:return"eleve";case t.UrgencyLevel.MOYEN:return"Moyen";case t.UrgencyLevel.FAIBLE:return"Faible"}})()})]})}e.s(["default",()=>r])},412704,e=>{"use strict";var s=e.i(843476),t=e.i(271645),r=e.i(618566),a=e.i(772919),l=e.i(502166);function i({deadlineDate:e,notificationDate:r,urgencyLevel:i,showProgress:n=!0}){let[c,d]=(0,t.useState)({days:0,hours:0,minutes:0,seconds:0,isExpired:!1});(0,t.useEffect)(()=>{let s=()=>{let s=new Date,t=new Date(e).getTime()-s.getTime();if(t<=0)return void d({days:0,hours:0,minutes:0,seconds:0,isExpired:!0});let r=Math.floor(t/864e5),a=Math.floor(t%864e5/36e5);d({days:r,hours:a,minutes:Math.floor(t%36e5/6e4),seconds:Math.floor(t%6e4/1e3),isExpired:!1})};s();let t=setInterval(s,1e3);return()=>clearInterval(t)},[e]);let o=n&&r?(()=>{if(!r)return 0;let s=new Date(e).getTime()-new Date(r).getTime();return Math.min((new Date().getTime()-new Date(r).getTime())/s*100,100)})():0;if(c.isExpired)return(0,s.jsx)("div",{className:"bg-red-50 border-2 border-red-600 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-3xl","aria-label":"warning"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-bold text-red-900 text-lg",children:"Delai expire"}),(0,s.jsx)("p",{className:"text-red-700 text-sm",children:"Action immediate requise"})]})]})});let m=i===a.UrgencyLevel.CRITIQUE;return(0,s.jsxs)("div",{className:`border-2 rounded-lg p-4 ${m?"bg-red-50 border-red-600 animate-pulse":"bg-white border-gray-200"}`,children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-2xl","aria-label":"timer"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold text-gray-700 text-sm",children:"Temps restant"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["echeance: ",new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),(0,s.jsx)(l.default,{level:i,size:"sm"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-2 mb-3",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:`text-2xl font-bold font-mono ${m?"text-red-700":"text-gray-900"}`,children:c.days}),(0,s.jsx)("div",{className:"text-xs text-gray-600",children:"jours"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:`text-2xl font-bold font-mono ${m?"text-red-700":"text-gray-900"}`,children:c.hours}),(0,s.jsx)("div",{className:"text-xs text-gray-600",children:"heures"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:`text-2xl font-bold font-mono ${m?"text-red-700":"text-gray-900"}`,children:c.minutes}),(0,s.jsx)("div",{className:"text-xs text-gray-600",children:"min"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:`text-2xl font-bold font-mono ${m?"text-red-700":"text-gray-900"}`,children:c.seconds}),(0,s.jsx)("div",{className:"text-xs text-gray-600",children:"sec"})]})]}),n&&r&&(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between text-xs text-gray-600",children:[(0,s.jsx)("span",{children:"Progression du delai"}),(0,s.jsxs)("span",{children:[Math.round(o),"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:(0,s.jsx)("div",{className:`h-full transition-all duration-500 ${o>75?"bg-red-600":o>50?"bg-orange-500":"bg-green-500"}`,style:{width:`${o.toString()}%`}})})]}),m&&(0,s.jsxs)("div",{className:"mt-3 p-2 bg-red-100 border border-red-300 rounded text-xs text-red-800",children:[(0,s.jsx)("span",{"aria-label":"warning"})," ",(0,s.jsx)("strong",{children:"Attention :"})," Ce delai est critique. Une action immediate est requise."]})]})}function n({workspaceId:e,items:r,onToggle:l,readonly:i=!1}){let[n,c]=(0,t.useState)(null),d=async(e,s)=>{if(!i&&l){c(e);try{await l(e,!s)}catch(e){console.error("Failed to toggle checklist item:",e)}finally{c(null)}}},o=r.reduce((e,s)=>{e[s.category]||(e[s.category]=[]);let t=e[s.category];return t&&t.push(s),e},{}),m=0===r.length?0:Math.round(r.filter(e=>e.completed).length/r.length*100);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:"Progression"}),(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:[m,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:(0,s.jsx)("div",{className:`h-full transition-all duration-500 ${100===m?"bg-green-600":m>66?"bg-blue-500":m>33?"bg-yellow-500":"bg-gray-400"}`,style:{width:`${m}%`}})}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-gray-600",children:[r.filter(e=>e.completed).length," sur ",r.length," elements completes"]})]}),Object.entries(o).sort(([e],[s])=>{let t=[a.ChecklistCategory.VERIFICATIONS,a.ChecklistCategory.PIECES,a.ChecklistCategory.ACTIONS];return t.indexOf(e)-t.indexOf(s)}).map(([e,t])=>(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[(0,s.jsxs)("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-lg",children:(e=>{switch(e){case a.ChecklistCategory.VERIFICATIONS:return"[Check]";case a.ChecklistCategory.PIECES:return"[emoji]";case a.ChecklistCategory.ACTIONS:return"";default:return"-"}})(e)}),(e=>{switch(e){case a.ChecklistCategory.VERIFICATIONS:return"Verifications juridiques";case a.ChecklistCategory.PIECES:return"Pieces a obtenir";case a.ChecklistCategory.ACTIONS:return"Actions a effectuer";default:return e}})(e),(0,s.jsxs)("span",{className:"ml-auto text-sm font-normal text-gray-500",children:[t.filter(e=>e.completed).length,"/",t.length]})]}),(0,s.jsx)("div",{className:"space-y-2",children:t.sort((e,s)=>e.order-s.order).map(e=>(0,s.jsx)("div",{className:`p-3 border rounded-lg transition-all ${e.completed?"bg-green-50 border-green-200":e.required?"bg-orange-50 border-orange-200":"bg-gray-50 border-gray-200"}`,children:(0,s.jsxs)("label",{className:"flex items-start gap-3 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:e.completed,onChange:()=>d(e.id,e.completed),disabled:i||n===e.id,className:"mt-1 h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:`font-medium ${e.completed?"text-green-900 line-through":"text-gray-900"}`,children:e.label}),e.required&&!e.completed&&(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800",children:"Requis"})]}),e.description&&(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),e.completed&&e.completedAt&&(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["[Check] Complete le"," ",new Date(e.completedAt).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})},e.id))})]},e)),0===r.length&&(0,s.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-8 text-center",children:(0,s.jsx)("p",{className:"text-gray-600",children:"Aucun element de checklist pour ce workspace."})})]})}function c(){let e=(0,r.useParams)(),c=(0,r.useRouter)(),[d,o]=(0,t.useState)(null),[m,x]=(0,t.useState)(!0),[h,g]=(0,t.useState)("overview");(0,t.useEffect)(()=>{e.id&&u()},[e.id]);let u=async()=>{x(!0);try{let s=await fetch(`/api/workspaces/${e.id}`);if(!s.ok)throw Error("Erreur lors du chargement");let t=await s.json();o(t)}catch(e){console.error("Error fetching workspace:",e),alert("Erreur lors du chargement du dossier")}finally{x(!1)}},j=async(s,t)=>{try{if(!(await fetch(`/api/workspaces/${e.id}/checklist/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({completed:t})})).ok)throw Error("Erreur lors de la mise à jour");await u()}catch(e){console.error("Error toggling checklist:",e),alert("Erreur lors de la mise à jour")}};return m?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"inline-block h-12 w-12 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent"}),(0,s.jsx)("p",{className:"text-gray-600 mt-4",children:"Chargement du dossier..."})]})}):d?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("div",{className:"bg-white border-b",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-8 py-6",children:[(0,s.jsx)("button",{onClick:()=>c.push("/workspaces"),className:"text-gray-600 hover:text-gray-900 mb-4 flex items-center gap-2",children:"← Retour aux dossiers"}),(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:`${a.PROCEDURE_COLORS[d.procedureType]}20`,color:a.PROCEDURE_COLORS[d.procedureType]},children:d.procedureType}),(0,s.jsx)(l.default,{level:d.urgencyLevel}),(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:["#",d.reference]})]}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:d.title}),d.description&&(0,s.jsx)("p",{className:"text-gray-600 mt-2",children:d.description}),d.client&&(0,s.jsxs)("div",{className:"mt-4 flex items-center gap-2 text-sm text-gray-600",children:[(0,s.jsx)("span",{className:"font-medium",children:"Client:"}),(0,s.jsxs)("span",{children:[d.client.firstName," ",d.client.lastName]}),d.client.email&&(0,s.jsxs)("span",{children:["• ",d.client.email]})]})]}),(0,s.jsx)("div",{className:"ml-8",children:(0,s.jsx)(i,{deadlineDate:new Date(d.deadlineDate),notificationDate:d.notificationDate?new Date(d.notificationDate):void 0,urgencyLevel:d.urgencyLevel})})]})]})}),(0,s.jsx)("div",{className:"bg-white border-b",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-8",children:(0,s.jsxs)("div",{className:"flex gap-8",children:[(0,s.jsx)("button",{onClick:()=>g("overview"),className:`py-4 border-b-2 font-medium transition-colors ${"overview"===h?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Vue d'ensemble"}),(0,s.jsxs)("button",{onClick:()=>g("documents"),className:`py-4 border-b-2 font-medium transition-colors ${"documents"===h?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:["Documents (",d.documents?.length||0,")"]}),(0,s.jsx)("button",{onClick:()=>g("timeline"),className:`py-4 border-b-2 font-medium transition-colors ${"timeline"===h?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Chronologie"})]})})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-8 py-8",children:["overview"===h&&(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Liste de contrôle"}),(0,s.jsx)(n,{items:d.checklist||[],onToggle:j})]}),d.alerts&&d.alerts.length>0&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Alertes"}),(0,s.jsx)("div",{className:"space-y-3",children:d.alerts.map(e=>(0,s.jsxs)("div",{className:`p-4 rounded-lg border-l-4 ${"deadline_critical"===e.type?"border-red-600 bg-red-50":"deadline_warning"===e.type?"border-orange-600 bg-orange-50":"border-blue-600 bg-blue-50"}`,children:[(0,s.jsx)("div",{className:"font-medium",children:e.title}),(0,s.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:e.message})]},e.id))})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,s.jsx)("h3",{className:"font-bold text-gray-900 mb-4",children:"Informations"}),(0,s.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-gray-600",children:"Créé le"}),(0,s.jsx)("div",{className:"font-medium",children:new Date(d.createdAt).toLocaleDateString("fr-FR")})]}),d.notificationDate&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-gray-600",children:"Date de notification"}),(0,s.jsx)("div",{className:"font-medium",children:new Date(d.notificationDate).toLocaleDateString("fr-FR")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-gray-600",children:"Échéance"}),(0,s.jsx)("div",{className:"font-medium",children:new Date(d.deadlineDate).toLocaleDateString("fr-FR")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-gray-600",children:"Statut"}),(0,s.jsx)("div",{className:"font-medium capitalize",children:d.status})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,s.jsx)("h3",{className:"font-bold text-gray-900 mb-4",children:"Statistiques"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Documents"}),(0,s.jsx)("span",{className:"font-bold text-lg",children:d.documents?.length||0})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Brouillons"}),(0,s.jsx)("span",{className:"font-bold text-lg",children:d.documentDrafts?.length||0})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Événements"}),(0,s.jsx)("span",{className:"font-bold text-lg",children:d.timeline?.length||0})]})]})]})]})]}),"documents"===h&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Documents"}),(0,s.jsx)("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium",children:"+ Ajouter un document"})]}),d.documents&&d.documents.length>0?(0,s.jsx)("div",{className:"space-y-3",children:d.documents.map(e=>(0,s.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium",children:e.name}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:[e.type," • ",(e.size/1024).toFixed(0)," KB •"," ",new Date(e.uploadedAt).toLocaleDateString("fr-FR")]})]}),(0,s.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-700",children:"Télécharger"})]})},e.id))}):(0,s.jsx)("p",{className:"text-gray-600 text-center py-8",children:"Aucun document"})]}),"timeline"===h&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Chronologie"}),d.timeline&&d.timeline.length>0?(0,s.jsx)("div",{className:"space-y-4",children:d.timeline.map((e,t)=>(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"w-3 h-3 bg-blue-600 rounded-full"}),t<d.timeline.length-1&&(0,s.jsx)("div",{className:"w-0.5 h-full bg-gray-300 mt-1"})]}),(0,s.jsxs)("div",{className:"flex-1 pb-8",children:[(0,s.jsx)("div",{className:"font-medium",children:e.title}),(0,s.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,s.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:new Date(e.createdAt).toLocaleString("fr-FR")})]})]},e.id))}):(0,s.jsx)("p",{className:"text-gray-600 text-center py-8",children:"Aucun événement"})]})]})]}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-gray-600 text-lg",children:"Dossier non trouvé"}),(0,s.jsx)("button",{onClick:()=>c.push("/workspaces"),className:"mt-4 text-blue-600 hover:text-blue-700 font-medium",children:"← Retour aux dossiers"})]})})}e.s(["default",()=>c,"dynamic",0,"force-dynamic"],412704)}]);