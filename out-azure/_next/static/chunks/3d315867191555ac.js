(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,429928,e=>{"use strict";var s,t=e.i(843476),r=e.i(271645),a=e.i(311132),l=e.i(888840);function i(e){let s={category:"UNKNOWN",message:"Unknown error",userMessage:"Une erreur inattendue est survenue. Veuillez reessayer.",canRetry:!0,originalError:e instanceof Error?e:Error(String(e))};if(!(e instanceof Error))return s;let t=e.message.toLowerCase();return t.includes("fetch")||t.includes("network")||t.includes("timeout")||t.includes("econnrefused")||t.includes("enotfound")?{category:"NETWORK",message:e.message,userMessage:"Erreur de connexion. Verifiez votre connexion Internet.",canRetry:!0,retryDelay:3e3,originalError:e,suggestions:["Verifiez votre connexion Internet","Reessayez dans quelques secondes","Contactez le support si le probleme persiste"]}:t.includes("unauthorized")||t.includes("401")?{category:"AUTHENTICATION",message:e.message,userMessage:"Session expiree. Veuillez vous reconnecter.",canRetry:!1,statusCode:401,originalError:e,suggestions:["Reconnectez-vous","Verifiez vos identifiants"]}:t.includes("forbidden")||t.includes("403")?{category:"AUTHORIZATION",message:e.message,userMessage:"Vous n'avez pas les droits necessaires pour cette action.",canRetry:!1,statusCode:403,originalError:e,suggestions:["Contactez votre administrateur","Verifiez vos permissions"]}:t.includes("not found")||t.includes("404")?{category:"NOT_FOUND",message:e.message,userMessage:"Ressource introuvable.",canRetry:!1,statusCode:404,originalError:e,suggestions:["Verifiez que la ressource existe","Actualisez la page"]}:t.includes("validation")||t.includes("invalid")||t.includes("400")?{category:"VALIDATION",message:e.message,userMessage:"Donnees invalides. Verifiez votre saisie.",canRetry:!1,statusCode:400,originalError:e,suggestions:["Verifiez les champs du formulaire","Assurez-vous que les donnees sont au bon format"]}:t.includes("rate limit")||t.includes("429")?{category:"RATE_LIMIT",message:e.message,userMessage:"Trop de requetes. Veuillez patienter.",canRetry:!0,retryDelay:6e4,statusCode:429,originalError:e,suggestions:["Attendez quelques instants avant de reessayer","Reduisez la frequence de vos actions"]}:t.includes("conflict")||t.includes("409")?{category:"CONFLICT",message:e.message,userMessage:"Conflit detecte. La ressource a peut-etre ete modifiee.",canRetry:!0,retryDelay:2e3,statusCode:409,originalError:e,suggestions:["Actualisez la page","Verifiez les modifications recentes"]}:t.includes("server")||t.includes("500")||t.includes("502")||t.includes("503")||t.includes("504")?{category:"SERVER",message:e.message,userMessage:"Erreur serveur. Reessayez dans quelques instants.",canRetry:!0,retryDelay:5e3,statusCode:500,originalError:e,suggestions:["Reessayez dans quelques minutes","Contactez le support si le probleme persiste"]}:s}async function n(e){let s=`HTTP ${e.status}: ${e.statusText}`;try{let t=await e.json();t.error?s=t.error:t.message&&(s=t.message)}catch{}let t=Error(s);return t.status=e.status,t}e.i(247167),(s={}).NETWORK="NETWORK",s.AUTHENTICATION="AUTHENTICATION",s.AUTHORIZATION="AUTHORIZATION",s.VALIDATION="VALIDATION",s.NOT_FOUND="NOT_FOUND",s.SERVER="SERVER",s.RATE_LIMIT="RATE_LIMIT",s.CONFLICT="CONFLICT",s.UNKNOWN="UNKNOWN";var o=e.i(531278);function d({progress:e=0,total:s=100,label:a,indeterminate:l=!1,variant:i="bar",showPercentage:n=!0,estimatedSeconds:o,size:d="md",className:m=""}){let u=l?0:Math.round(e/s*100),[g,h]=(0,r.useState)(o||0);return((0,r.useEffect)(()=>{if(!o||l)return;let e=setInterval(()=>{h(e=>Math.max(0,e-1))},1e3);return()=>clearInterval(e)},[o,l]),"spinner"===i)?(0,t.jsx)(c,{label:a,size:d,className:m}):"circle"===i?(0,t.jsx)(x,{percentage:u,indeterminate:l,label:a,size:d,className:m}):(0,t.jsxs)("div",{className:`space-y-2 ${m}`,children:[(a||n||o)&&(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,t.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:a}),(0,t.jsxs)("div",{className:"flex gap-2 items-center text-gray-600 dark:text-gray-400",children:[n&&!l&&(0,t.jsxs)("span",{className:"font-medium",children:[u,"%"]}),g>0&&(0,t.jsxs)("span",{className:"text-xs",children:["~",(e=>{if(e<60)return`${e}s`;let s=Math.floor(e/60);return`${s}m ${e%60}s`})(g)]})]})]}),(0,t.jsx)("div",{className:`
          w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden
          ${"sm"===d?"h-1":"lg"===d?"h-3":"h-2"}
        `,children:(0,t.jsx)("div",{className:`
            h-full rounded-full transition-all duration-300 ease-out
            ${l?"bg-blue-500 animate-progress-indeterminate":"bg-blue-600 dark:bg-blue-500"}
          `,style:{width:l?"30%":`${u}%`}})})]})}function c({label:e,size:s,className:r}){return(0,t.jsxs)("div",{className:`flex items-center gap-2 ${r}`,children:[(0,t.jsx)(o.Loader2,{className:"animate-spin text-blue-600",size:"sm"===s?16:"lg"===s?32:24}),e&&(0,t.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e})]})}function x({percentage:e,indeterminate:s,label:r,size:a,className:l}){let i="sm"===a?40:"lg"===a?80:60,n="sm"===a?4:"lg"===a?8:6,o=(i-n)/2,d=2*Math.PI*o;return(0,t.jsxs)("div",{className:`flex flex-col items-center gap-2 ${l}`,children:[(0,t.jsxs)("div",{className:"relative",style:{width:i,height:i},children:[(0,t.jsxs)("svg",{className:"transform -rotate-90",width:i,height:i,children:[(0,t.jsx)("circle",{cx:i/2,cy:i/2,r:o,stroke:"currentColor",strokeWidth:n,fill:"none",className:"text-gray-200 dark:text-gray-700"}),(0,t.jsx)("circle",{cx:i/2,cy:i/2,r:o,stroke:"currentColor",strokeWidth:n,fill:"none",strokeDasharray:d,strokeDashoffset:s?0:d-e/100*d,className:`
              text-blue-600 dark:text-blue-500 transition-all duration-300
              ${s?"animate-spin":""}
            `,strokeLinecap:"round"})]}),!s&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsxs)("span",{className:`
                font-semibold text-gray-700 dark:text-gray-300
                ${"sm"===a?"text-xs":"lg"===a?"text-xl":"text-sm"}
              `,children:[e,"%"]})})]}),r&&(0,t.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300 text-center",children:r})]})}function m({workspace:e,onStartAnalysis:s,loading:r,onRefresh:a}){let c=e.sourceMetadata?JSON.parse(e.sourceMetadata):{},x=r?.extraction||r?.mutation,m=(0,l.useToast)(),u=async()=>{try{let s=await fetch(`/api/workspace-reasoning/${e.id}/extract`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({autoTransition:!0})});if(!s.ok)throw await n(s);let t=await s.json(),r=t.extractedFactsCount||0,l=Math.round(100*(t.averageConfidence||0));m.showToast(` ${r} fait(s) extrait(s) avec ${l}% de confiance`,"success","Extraction IA reussie"),a&&a()}catch(s){let e=i(s);m.showToast(e.userMessage,"error","echec de l'extraction")}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"[emoji] Nouveau dossier recu"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"etat initial - Aucune interpretation effectuee"})]}),(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 space-y-4",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:"Source"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Type:"}),(0,t.jsx)("span",{className:"ml-2 font-medium",children:e.sourceType})]}),e.sourceId&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Reference:"}),(0,t.jsx)("span",{className:"ml-2 font-mono text-xs",children:e.sourceId})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Recu le:"}),(0,t.jsx)("span",{className:"ml-2",children:new Date(e.createdAt).toLocaleString("fr-FR")})]}),c.from&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500",children:"De:"}),(0,t.jsx)("span",{className:"ml-2",children:c.from})]})]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Contenu brut recu (non modifie)"}),(0,t.jsx)("div",{className:"bg-white border border-gray-300 rounded p-4",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-gray-800 font-mono",children:e.sourceRaw})})]}),Object.keys(c).length>0&&(0,t.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"font-semibold text-blue-900 mb-2",children:"Metadonnees"}),(0,t.jsx)("div",{className:"space-y-1 text-sm",children:Object.entries(c).map(([e,s])=>(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsxs)("span",{className:"text-blue-600 font-medium w-32",children:[e,":"]}),(0,t.jsx)("span",{className:"text-blue-900",children:String(s)})]},e))})]}),x&&(0,t.jsx)("div",{className:"my-4",children:(0,t.jsx)(d,{indeterminate:!0,label:"Extraction IA en cours...",estimatedSeconds:117,variant:"bar",size:"md"})}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Ô∏è Aucune modification manuelle autorisee a ce stade"}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:u,disabled:x,className:"px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors flex items-center gap-2",children:x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Loader2,{className:"animate-spin h-4 w-4"}),"Extraction IA en cours..."]}):(0,t.jsx)(t.Fragment,{children:"[emoji] Extraire avec IA"})}),(0,t.jsx)("button",{onClick:s,disabled:x,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-medium rounded-lg transition-colors",children:"Analyse manuelle"})]})]})]})}function u({workspace:e,onContinue:s,onAddFact:a,loading:l}){let[i,n]=(0,r.useState)(!1),d=e.facts||[];return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"[emoji] Faits extraits"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Uniquement des faits certains et sources"})]}),(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsx)("div",{className:"bg-gray-50 px-6 py-3 border-b border-gray-200",children:(0,t.jsxs)("h3",{className:"font-semibold text-gray-900",children:[d.length," fait",d.length>1?"s":""," extrait",d.length>1?"s":""]})}),0===d.length?(0,t.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Aucun fait extrait automatiquement"}):(0,t.jsx)("div",{className:"divide-y divide-gray-200",children:d.map(e=>{let s={EXPLICIT_MESSAGE:{label:"Message",color:"bg-blue-100 text-blue-800"},METADATA:{label:"Metadonnees",color:"bg-gray-100 text-gray-800"},DOCUMENT:{label:"Document",color:"bg-green-100 text-green-800"},USER_PROVIDED:{label:"Utilisateur",color:"bg-purple-100 text-purple-800"}}[e.source];return(0,t.jsx)("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("span",{className:"font-medium text-gray-900",children:e.label}),(0,t.jsx)("span",{className:`px-2 py-1 text-xs font-medium rounded ${s.color}`,children:s.label})]}),(0,t.jsx)("div",{className:"text-lg text-blue-600 font-semibold mb-2",children:e.value}),e.sourceRef&&(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["Source: ",e.sourceRef]}),(0,t.jsxs)("div",{className:"text-xs text-gray-400 mt-2",children:["Extrait par ",e.extractedBy," - ",new Date(e.createdAt).toLocaleString("fr-FR")]})]}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-2xl",children:"[Check]"})}),(0,t.jsxs)("div",{className:"text-xs text-center text-gray-500 mt-1",children:[(100*e.confidence).toFixed(0),"%"]})]})]})},e.id)})})]}),a&&(0,t.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h3",{className:"font-semibold text-purple-900",children:"Ajouter un fait manuel"}),(0,t.jsxs)("button",{onClick:()=>n(!i),disabled:!!l?.mutation,className:`text-sm ${l?.mutation?"text-purple-400 cursor-not-allowed":"text-purple-600 hover:text-purple-800"}`,children:[l?.mutation&&(0,t.jsx)(o.Loader2,{className:"inline h-3 w-3 mr-1 animate-spin"}),i?"Annuler":" Ajouter"]})]}),i&&(0,t.jsx)("div",{className:"space-y-3 mt-4",children:(0,t.jsx)("div",{className:"bg-white p-4 rounded border border-purple-200",children:(0,t.jsx)("p",{className:"text-sm text-purple-700",children:"Ô∏è Toute modification manuelle sera tracee et necessitera une justification"})})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[(0,t.jsx)("div",{className:"text-sm text-gray-500",children:d.length>0?" Faits extraits et verifies":"Ô∏è Aucun fait extrait - Verifiez la source"}),(0,t.jsxs)("button",{onClick:s,disabled:0===d.length||!!l?.mutation,className:`px-6 py-3 font-medium rounded-lg transition-colors flex items-center gap-2 ${0===d.length||l?.mutation?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[l?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),"Continuer [Next] Identifier le contexte"]})]})]})}function g({workspace:e,onConfirmContext:s,onRejectContext:r,onContinue:a,loading:l}){let i=e.contextHypotheses||[],n=i.filter(e=>"CONFIRMED"===e.certaintyLevel),d=i.filter(e=>"PROBABLE"===e.certaintyLevel),c=i.filter(e=>"POSSIBLE"===e.certaintyLevel),x=e=>{let a={LEGAL:{label:"Juridique",color:"bg-blue-100 text-blue-800"},ADMINISTRATIVE:{label:"Administratif",color:"bg-purple-100 text-purple-800"},PROCEDURAL:{label:"Procedural",color:"bg-green-100 text-green-800"},TEMPORAL:{label:"Temporel",color:"bg-orange-100 text-orange-800"},RELATIONAL:{label:"Relationnel",color:"bg-pink-100 text-pink-800"}}[e.type],i={POSSIBLE:{label:"Possible",color:"bg-yellow-100 text-yellow-800 border-yellow-300",icon:"[emoji]"},PROBABLE:{label:"Probable",color:"bg-orange-100 text-orange-800 border-orange-300",icon:"[emoji]"},CONFIRMED:{label:"Confirme",color:"bg-green-100 text-green-800 border-green-300",icon:""}}[e.certaintyLevel],n={LEGAL:"Ô∏è",ADMINISTRATIVE:"üèõÔ∏è",PROCEDURAL:"[emoji]",TEMPORAL:"",RELATIONAL:"[emoji]"}[e.type];return(0,t.jsx)("div",{className:`p-6 border-2 rounded-lg ${i.color}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:"text-4xl",children:n}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,t.jsxs)("span",{className:`px-3 py-1 text-sm font-semibold rounded border-2 ${i.color}`,children:[i.icon," ",i.label]}),(0,t.jsx)("span",{className:`px-2 py-1 text-xs font-medium rounded ${a.color}`,children:a.label})]}),(0,t.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-3",children:e.description}),(0,t.jsx)("div",{className:"bg-white border border-gray-300 rounded-lg p-4 mb-4",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("div",{className:"font-semibold text-gray-700 mb-2",children:"[emoji] Raisonnement qui a conduit a cette hypothese:"}),(0,t.jsx)("p",{className:"text-gray-600 whitespace-pre-wrap",children:e.reasoning})]})}),"CONFIRMED"!==e.certaintyLevel&&(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("button",{onClick:()=>s(e.id),disabled:!!l?.mutation,className:`px-4 py-2 text-sm font-medium rounded transition-colors flex items-center gap-2 ${l?.mutation?"bg-green-600/70 cursor-not-allowed text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:[l?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),"Confirmer ce contexte"]}),(0,t.jsxs)("button",{onClick:()=>r(e.id),disabled:!!l?.mutation,className:`px-4 py-2 text-sm font-medium rounded transition-colors flex items-center gap-2 ${l?.mutation?"bg-red-600/70 cursor-not-allowed text-white":"bg-red-600 hover:bg-red-700 text-white"}`,children:[l?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),"Rejeter ce contexte"]})]}),"CONFIRMED"===e.certaintyLevel&&(0,t.jsx)("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded font-medium",children:"Contexte confirme"}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-3",children:["Identifie par ",e.identifiedBy," - ",new Date(e.createdAt).toLocaleString("fr-FR")]})]})]})},e.id)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"[emoji] Contextes identifies"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Cadres d'interpretation possibles - Aucune verite absolue"})]}),(0,t.jsx)("div",{className:"p-4 bg-blue-50 border-2 border-blue-200 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"text-2xl",children:"[emoji]"}),(0,t.jsxs)("div",{className:"text-sm text-blue-900",children:[(0,t.jsx)("div",{className:"font-semibold mb-1",children:"Principe methodologique:"}),(0,t.jsxs)("p",{children:["Ces contextes sont des ",(0,t.jsx)("strong",{children:"hypotheses de travail"}),", pas des verites. Un contexte \"Confirme\" signifie seulement qu'il est coherent avec les faits connus, pas qu'il est absolument vrai."]})]})]})}),n.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold text-green-700",children:["Contextes confirmes (",n.length,")"]}),(0,t.jsx)("div",{className:"space-y-4",children:n.map(x)})]}),d.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold text-orange-700",children:["[emoji] Contextes probables (",d.length,")"]}),(0,t.jsx)("div",{className:"space-y-4",children:d.map(x)})]}),c.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold text-yellow-700",children:["[emoji] Contextes possibles (",c.length,")"]}),(0,t.jsx)("div",{className:"space-y-4",children:c.map(x)})]}),0===i.length&&(0,t.jsxs)("div",{className:"p-8 bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg text-center",children:[(0,t.jsx)("div",{className:"text-4xl mb-3",children:"[emoji]"}),(0,t.jsx)("div",{className:"text-gray-600",children:"Aucun contexte identifie pour le moment"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t-2 border-gray-200",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:[i.length," contexte",i.length>1?"s":""," identifie",i.length>1?"s":"",n.length>0&&(0,t.jsxs)("span",{className:"ml-2 text-green-600 font-medium",children:["- ",n.length," confirme",n.length>1?"s":""]})]}),(0,t.jsxs)("button",{onClick:a,disabled:0===n.length||!!l?.mutation,className:`px-6 py-3 font-medium rounded-lg transition-colors flex items-center gap-2 ${0===n.length||l?.mutation?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[l?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),0===n.length?"Confirmez au moins un contexte pour continuer":"Continuer [Next] Deduire les obligations"]})]})]})}function h({workspace:e,onMarkCritical:s,onContinue:r,loading:a}){let l=e.obligations||[],i=e.contextHypotheses||[],n=l.reduce((e,s)=>{let t=s.contextId;return e[t]||(e[t]=[]),e[t].push(s),e},{}),d=l.filter(e=>e.critical),c=l.filter(e=>e.deadline),x=e=>{let s=new Date;return Math.ceil((new Date(e).getTime()-s.getTime())/864e5)},m=e=>{let r,l=i.find(s=>s.id===e.contextId),n=e.deadline?x(e.deadline):null;return(0,t.jsx)("div",{className:`p-5 border-2 rounded-lg ${e.critical?"border-red-400 bg-red-50":"border-blue-300 bg-blue-50"}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:"text-3xl",children:e.critical?"Ô∏è":"[emoji]"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[e.critical&&(0,t.jsx)("span",{className:"px-2 py-1 text-xs font-bold bg-red-600 text-white rounded",children:"CRITIQUE"}),e.deadline&&(0,t.jsx)("span",{className:`px-2 py-1 text-xs font-semibold rounded ${(r=x(e.deadline))<0?"text-red-700 bg-red-100":r<=7?"text-red-600 bg-red-50":r<=30?"text-orange-600 bg-orange-50":"text-green-600 bg-green-50"}`,children:null!==n&&(n<0?`DePASSe de ${Math.abs(n)} jour${Math.abs(n)>1?"s":""}`:`${n} jour${n>1?"s":""} restant${n>1?"s":""}`)})]}),(0,t.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.description}),(0,t.jsx)("div",{className:"mb-3 p-3 bg-white border border-blue-200 rounded",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-semibold text-blue-700",children:"SI:"}),(0,t.jsx)("span",{className:"text-gray-700 ml-2",children:l?.description||"Contexte inconnu"})]})}),e.legalRef&&(0,t.jsx)("div",{className:"mb-3 p-3 bg-gray-50 border border-gray-300 rounded",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-semibold text-gray-700",children:"[emoji] Base legale:"}),(0,t.jsx)("span",{className:"text-gray-600 ml-2",children:e.legalRef})]})}),e.deadline&&(0,t.jsx)("div",{className:"mb-3 p-3 bg-yellow-50 border border-yellow-300 rounded",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-semibold text-yellow-800",children:" echeance:"}),(0,t.jsx)("span",{className:"text-yellow-700 ml-2",children:new Date(e.deadline).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})}),(0,t.jsx)("div",{className:"flex items-center gap-3 mt-4",children:!e.critical&&(0,t.jsxs)("button",{onClick:()=>s(e.id),disabled:!!a?.mutation,className:`px-4 py-2 text-sm font-medium rounded transition-colors flex items-center gap-2 ${a?.mutation?"bg-red-600/70 cursor-not-allowed text-white":"bg-red-600 hover:bg-red-700 text-white"}`,children:[a?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),"Ô∏è Marquer comme critique"]})}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-3",children:["Deduit par ",e.deducedBy," - ",new Date(e.createdAt).toLocaleString("fr-FR")]})]})]})},e.id)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"[emoji] Obligations deduites"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Obligations conditionnelles selon les contextes identifies"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-blue-50 border-2 border-blue-200 rounded-lg",children:[(0,t.jsx)("div",{className:"text-3xl text-blue-600 mb-2",children:"[emoji]"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:l.length}),(0,t.jsxs)("div",{className:"text-sm text-blue-700",children:["Obligation",l.length>1?"s":""," totale",l.length>1?"s":""]})]}),(0,t.jsxs)("div",{className:"p-4 bg-red-50 border-2 border-red-200 rounded-lg",children:[(0,t.jsx)("div",{className:"text-3xl text-red-600 mb-2",children:"Ô∏è"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-red-900",children:d.length}),(0,t.jsxs)("div",{className:"text-sm text-red-700",children:["Critique",d.length>1?"s":""]})]}),(0,t.jsxs)("div",{className:"p-4 bg-orange-50 border-2 border-orange-200 rounded-lg",children:[(0,t.jsx)("div",{className:"text-3xl text-orange-600 mb-2"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-orange-900",children:c.length}),(0,t.jsx)("div",{className:"text-sm text-orange-700",children:"Avec echeance"})]})]}),d.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold text-red-700",children:["Ô∏è Obligations critiques (",d.length,")"]}),(0,t.jsx)("div",{className:"space-y-4",children:d.map(m)})]}),Object.entries(n).map(([e,s])=>{let r=i.find(s=>s.id===e),a=s.filter(e=>!e.critical);return 0===a.length?null:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold text-blue-700",children:["[emoji] SI: ",r?.description||"Contexte inconnu"]}),(0,t.jsx)("div",{className:"space-y-4",children:a.map(m)})]},e)}),0===l.length&&(0,t.jsxs)("div",{className:"p-8 bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg text-center",children:[(0,t.jsx)("div",{className:"text-4xl mb-3",children:"[emoji]"}),(0,t.jsx)("div",{className:"text-gray-600",children:"Aucune obligation deduite pour le moment"})]}),(0,t.jsx)("div",{className:"p-4 bg-yellow-50 border-2 border-yellow-200 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"text-2xl",children:"Ô∏è"}),(0,t.jsxs)("div",{className:"text-sm text-yellow-900",children:[(0,t.jsx)("div",{className:"font-semibold mb-1",children:"Attention:"}),(0,t.jsxs)("p",{children:["Ces obligations sont ",(0,t.jsx)("strong",{children:"conditionnelles"})," aux contextes identifies. Si un contexte s'avere incorrect, les obligations associees ne s'appliquent pas."]})]})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t-2 border-gray-200",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:[l.length," obligation",l.length>1?"s":""," deduite",l.length>1?"s":"",d.length>0&&(0,t.jsxs)("span",{className:"ml-2 text-red-600 font-medium",children:["- ",d.length," critique",d.length>1?"s":""]})]}),(0,t.jsxs)("button",{onClick:r,disabled:!!a?.mutation,className:`px-6 py-3 font-medium rounded-lg transition-colors flex items-center gap-2 ${a?.mutation?"bg-blue-600/70 text-white cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[a?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),"Continuer [Next] Identifier les manques"]})]})]})}function b({workspace:e,onGenerateAction:s,onResolve:r,loading:a}){let l=e.missingElements||[],i=l.filter(e=>e.blocking&&!e.resolved),n=l.filter(e=>!e.blocking&&!e.resolved),d=l.filter(e=>e.resolved),c=(e,l)=>{let i={INFORMATION:{label:"Information",color:"bg-blue-100 text-blue-800"},DOCUMENT:{label:"Document",color:"bg-green-100 text-green-800"},DECISION:{label:"Decision",color:"bg-purple-100 text-purple-800"},VALIDATION:{label:"Validation",color:"bg-orange-100 text-orange-800"},HUMAN_EXPERTISE:{label:"Expertise humaine",color:"bg-red-100 text-red-800"}}[e.type],n={INFORMATION:"",DOCUMENT:"[emoji]",DECISION:"[emoji]",VALIDATION:"",HUMAN_EXPERTISE:"[emoji]"}[e.type];return(0,t.jsx)("div",{className:`p-6 border rounded-lg ${l?"border-red-300 bg-red-50":"border-yellow-300 bg-yellow-50"}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:"text-4xl",children:n}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[l&&(0,t.jsx)("span",{className:"px-2 py-1 text-xs font-bold bg-red-600 text-white rounded",children:"[emoji] BLOQUANT"}),(0,t.jsx)("span",{className:`px-2 py-1 text-xs font-medium rounded ${i.color}`,children:i.label})]}),(0,t.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.description}),(0,t.jsx)("div",{className:"bg-white border border-gray-300 rounded p-3 mb-3",children:(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Pourquoi c'est manquant:"}),(0,t.jsx)("p",{className:"mt-1",children:e.why})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("button",{onClick:()=>s(e.id),disabled:!!a?.mutation,className:`px-4 py-2 text-sm font-medium rounded transition-colors flex items-center gap-2 ${a?.mutation?`${l?"bg-red-600/70":"bg-yellow-600/70"} cursor-not-allowed text-white`:`${l?"bg-red-600 hover:bg-red-700":"bg-yellow-600 hover:bg-yellow-700"} text-white`}`,children:[a?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),"[emoji] Generer action de resolution"]}),(0,t.jsxs)("button",{onClick:()=>{let s=prompt("Comment avez-vous resolu ce manque ?");s&&r(e.id,s)},disabled:!!a?.mutation,className:`px-4 py-2 text-sm font-medium rounded transition-colors flex items-center gap-2 ${a?.mutation?"bg-green-600/70 cursor-not-allowed text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:[a?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),"Marquer comme resolu"]})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-3",children:["Identifie par ",e.identifiedBy," - ",new Date(e.createdAt).toLocaleString("fr-FR")]})]})]})},e.id)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:" elements manquants identifies"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Raisons pour lesquelles nous ne pouvons pas agir"})]}),(0,t.jsx)("div",{className:`p-4 rounded-lg border-2 ${e.uncertaintyLevel>=.8?"border-red-500 bg-red-50":e.uncertaintyLevel>=.5?"border-orange-500 bg-orange-50":"border-yellow-500 bg-yellow-50"}`,children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"text-3xl",children:(e.uncertaintyLevel>=.8||e.uncertaintyLevel,"[emoji]")}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-semibold text-gray-900",children:["Niveau d'incertitude: ",(100*e.uncertaintyLevel).toFixed(0),"%"]}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:e.uncertaintyLevel>=.8?"Action impossible - Trop de manques critiques":e.uncertaintyLevel>=.5?"Action risquee - Manques significatifs":"Action possible sous conditions"})]})]})}),i.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold text-red-700",children:["[emoji] Manques bloquants (",i.length,")"]}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"[Next] Empechent le passage a l'action"})]}),(0,t.jsx)("div",{className:"space-y-4",children:i.map(e=>c(e,!0))})]}),n.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold text-yellow-700",children:["[emoji] Manques non bloquants (",n.length,")"]}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"[Next] Recommandes de resoudre"})]}),(0,t.jsx)("div",{className:"space-y-4",children:n.map(e=>c(e,!1))})]}),d.length>0&&(0,t.jsxs)("details",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,t.jsxs)("summary",{className:"font-semibold text-green-900 cursor-pointer",children:["Manques resolus (",d.length,")"]}),(0,t.jsx)("div",{className:"mt-4 space-y-2",children:d.map(e=>(0,t.jsx)("div",{className:"p-3 bg-white border border-green-200 rounded",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-gray-900",children:e.description}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 mt-1",children:["Resolution: ",e.resolution]})]}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:e.resolvedAt&&new Date(e.resolvedAt).toLocaleString("fr-FR")})]})},e.id))})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t-2 border-gray-200",children:[(0,t.jsx)("div",{children:i.length>0?(0,t.jsxs)("div",{className:"text-red-600 font-semibold",children:["Impossible de continuer - ",i.length," manque",i.length>1?"s":""," bloquant",i.length>1?"s":""]}):(0,t.jsx)("div",{className:"text-green-600 font-semibold",children:"Tous les manques bloquants resolus - Progression possible"})}),(0,t.jsx)("button",{disabled:i.length>0,className:`px-6 py-3 font-medium rounded-lg transition-colors ${i.length>0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:i.length>0?"Resoudre les manques bloquants":"Continuer [Next] evaluer les risques"})]})]})}function p({workspace:e,onContinue:s,loading:r}){let a=e.risks||[],l=[...a].sort((e,s)=>s.riskScore-e.riskScore),i=a.filter(e=>e.riskScore>=6),n=a.filter(e=>e.riskScore>=3&&e.riskScore<6),d=a.filter(e=>e.riskScore<3),c=a.filter(e=>e.irreversible),x=e=>{var s,r;let a={LOW:{label:"Impact faible",color:"bg-green-100 text-green-800"},MEDIUM:{label:"Impact moyen",color:"bg-orange-100 text-orange-800"},HIGH:{label:"Impact eleve",color:"bg-red-100 text-red-800"}}[e.impact],l={LOW:{label:"Peu probable",color:"bg-green-100 text-green-800"},MEDIUM:{label:"Probable",color:"bg-orange-100 text-orange-800"},HIGH:{label:"Tres probable",color:"bg-red-100 text-red-800"}}[e.probability],i=(s=e.riskScore)>=6?"bg-red-600 text-white":s>=3?"bg-orange-500 text-white":"bg-green-500 text-white",n=(r=e.riskScore)>=6?"CRITIQUE":r>=3?"MODeRe":"FAIBLE";return(0,t.jsx)("div",{className:`p-6 border-2 rounded-lg ${e.riskScore>=6?"border-red-400 bg-red-50":e.riskScore>=3?"border-orange-400 bg-orange-50":"border-yellow-400 bg-yellow-50"}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:"text-4xl",children:(e.riskScore>=6||e.riskScore,"[emoji]")}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,t.jsxs)("span",{className:`px-3 py-1 text-sm font-bold rounded ${i}`,children:["Score: ",e.riskScore,"/9 - ",n]}),e.irreversible&&(0,t.jsx)("span",{className:"px-3 py-1 text-sm font-bold bg-purple-600 text-white rounded",children:"Ô∏è IRReVERSIBLE"})]}),(0,t.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-3",children:e.description}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:[(0,t.jsx)("div",{className:"p-3 bg-white border border-gray-300 rounded",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-semibold text-gray-700",children:"[emoji] Impact:"}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)("span",{className:`px-2 py-1 text-xs font-medium rounded ${a.color}`,children:a.label})})]})}),(0,t.jsx)("div",{className:"p-3 bg-white border border-gray-300 rounded",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-semibold text-gray-700",children:"üé≤ Probabilite:"}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)("span",{className:`px-2 py-1 text-xs font-medium rounded ${l.color}`,children:l.label})})]})})]}),(0,t.jsx)("div",{className:"mb-4 p-4 bg-white border-2 border-gray-300 rounded-lg",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("div",{className:"font-semibold text-gray-700 mb-2",children:"Consequences si ce risque se realise:"}),(0,t.jsx)("p",{className:"text-gray-600 whitespace-pre-wrap",children:e.consequence})]})}),e.irreversible&&(0,t.jsx)("div",{className:"p-3 bg-purple-50 border-2 border-purple-300 rounded-lg mb-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("div",{className:"text-xl",children:"Ô∏è"}),(0,t.jsxs)("div",{className:"text-sm text-purple-900",children:[(0,t.jsx)("div",{className:"font-bold mb-1",children:"Risque IRReVERSIBLE"}),(0,t.jsx)("p",{children:"Une fois materialise, ce risque ne peut pas etre annule. Exige une validation humaine renforcee."})]})]})}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-3",children:["evalue par ",e.evaluatedBy," - ",new Date(e.createdAt).toLocaleString("fr-FR")]})]})]})},e.id)},m=Math.max(...a.map(e=>e.riskScore),0),u=a.length>0?(a.reduce((e,s)=>e+s.riskScore,0)/a.length).toFixed(1):0;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Ô∏è Risques evalues"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Consequences possibles d'une action prematuree ou basee sur une hypothese erronee"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-blue-50 border-2 border-blue-200 rounded-lg",children:[(0,t.jsx)("div",{className:"text-3xl text-blue-600 mb-2",children:"[emoji]"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:a.length}),(0,t.jsxs)("div",{className:"text-sm text-blue-700",children:["Risque",a.length>1?"s":""," identifie",a.length>1?"s":""]})]}),(0,t.jsxs)("div",{className:"p-4 bg-red-50 border-2 border-red-200 rounded-lg",children:[(0,t.jsx)("div",{className:"text-3xl text-red-600 mb-2",children:"[emoji]"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-red-900",children:i.length}),(0,t.jsxs)("div",{className:"text-sm text-red-700",children:["Critique",i.length>1?"s":""]})]}),(0,t.jsxs)("div",{className:"p-4 bg-purple-50 border-2 border-purple-200 rounded-lg",children:[(0,t.jsx)("div",{className:"text-3xl text-purple-600 mb-2",children:"Ô∏è"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-purple-900",children:c.length}),(0,t.jsxs)("div",{className:"text-sm text-purple-700",children:["Irreversible",c.length>1?"s":""]})]}),(0,t.jsxs)("div",{className:"p-4 bg-orange-50 border-2 border-orange-200 rounded-lg",children:[(0,t.jsx)("div",{className:"text-3xl text-orange-600 mb-2",children:"[emoji]"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-orange-900",children:m>0?`${m}/9`:"N/A"}),(0,t.jsxs)("div",{className:"text-sm text-orange-700",children:["Score max - Moy: ",u]})]})]}),i.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold text-red-700",children:["[emoji] Risques critiques (",i.length,")"]}),(0,t.jsx)("div",{className:"space-y-4",children:l.filter(e=>e.riskScore>=6).map(x)})]}),n.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold text-orange-700",children:["[emoji] Risques moderes (",n.length,")"]}),(0,t.jsx)("div",{className:"space-y-4",children:l.filter(e=>e.riskScore>=3&&e.riskScore<6).map(x)})]}),d.length>0&&(0,t.jsxs)("details",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,t.jsxs)("summary",{className:"font-semibold text-yellow-900 cursor-pointer",children:["[emoji] Risques faibles (",d.length,")"]}),(0,t.jsx)("div",{className:"mt-4 space-y-4",children:l.filter(e=>e.riskScore<3).map(x)})]}),0===a.length&&(0,t.jsxs)("div",{className:"p-8 bg-green-50 border-2 border-green-300 rounded-lg text-center",children:[(0,t.jsx)("div",{className:"text-4xl mb-3"}),(0,t.jsx)("div",{className:"text-green-700 font-semibold",children:"Aucun risque identifie"})]}),(0,t.jsx)("div",{className:"p-4 bg-blue-50 border-2 border-blue-200 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"text-2xl",children:"[emoji]"}),(0,t.jsxs)("div",{className:"text-sm text-blue-900",children:[(0,t.jsx)("div",{className:"font-semibold mb-1",children:"Calcul du score de risque:"}),(0,t.jsxs)("p",{children:["Score = Impact x Probabilite (echelle 1-9) ",(0,t.jsx)("br",{}),"- Impact/Probabilite FAIBLE = 1 ",(0,t.jsx)("br",{}),"- Impact/Probabilite MOYEN = 2 ",(0,t.jsx)("br",{}),"- Impact/Probabilite eLEVe = 3 ",(0,t.jsx)("br",{}),(0,t.jsx)("br",{}),"Score ‚â• 6 = CRITIQUE - Score 3-5 = MODeRe - Score < 3 = FAIBLE"]})]})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t-2 border-gray-200",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:[a.length," risque",a.length>1?"s":""," evalue",a.length>1?"s":"",i.length>0&&(0,t.jsxs)("span",{className:"ml-2 text-red-600 font-medium",children:["- ",i.length," critique",i.length>1?"s":""]}),c.length>0&&(0,t.jsxs)("span",{className:"ml-2 text-purple-600 font-medium",children:["- ",c.length," irreversible",c.length>1?"s":""]})]}),(0,t.jsxs)("button",{onClick:s,disabled:!!r?.mutation,className:`px-6 py-3 font-medium rounded-lg transition-colors flex items-center gap-2 ${r?.mutation?"bg-blue-600/70 text-white cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[r?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),"Continuer [Next] Proposer une action"]})]})]})}function j({workspace:e,onExecute:s,onMarkExecuted:r,onContinue:a,loading:l}){let i=e.proposedActions||[],n=i.filter(e=>!e.executed),d=i.filter(e=>e.executed),c=(e,a)=>{let i={QUESTION:"",DOCUMENT_REQUEST:"[emoji]",ALERT:"[emoji]",ESCALATION:"Ô∏è",FORM_SEND:"[emoji]"}[e.type],n={QUESTION:{label:"Question",color:"bg-blue-100 text-blue-800"},DOCUMENT_REQUEST:{label:"Demande de document",color:"bg-green-100 text-green-800"},ALERT:{label:"Alerte",color:"bg-red-100 text-red-800"},ESCALATION:{label:"Escalade",color:"bg-purple-100 text-purple-800"},FORM_SEND:{label:"Envoi formulaire",color:"bg-orange-100 text-orange-800"}}[e.type];return(0,t.jsx)("div",{className:`p-6 border-2 rounded-lg ${a?"border-blue-400 bg-blue-50":"border-green-400 bg-green-50"}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:"text-4xl",children:i}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,t.jsx)("span",{className:`px-3 py-1 text-sm font-medium rounded ${n.color}`,children:n.label}),e.executed&&(0,t.jsx)("span",{className:"px-3 py-1 text-sm font-bold bg-green-600 text-white rounded",children:"EXeCUTeE"})]}),(0,t.jsx)("h4",{className:"text-lg font-semibold text-gray-900 mb-3",children:e.description}),e.target&&(0,t.jsx)("div",{className:"mb-3 p-3 bg-white border border-gray-300 rounded",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-semibold text-gray-700",children:"üéØ Destinataire:"}),(0,t.jsx)("span",{className:"text-gray-600 ml-2",children:e.target})]})}),(0,t.jsx)("div",{className:"mb-4 p-4 bg-white border-2 border-blue-300 rounded-lg",children:(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("div",{className:"font-semibold text-blue-700 mb-2",children:"[emoji] Pourquoi cette action est necessaire:"}),(0,t.jsx)("p",{className:"text-gray-600 whitespace-pre-wrap",children:e.reasoning})]})}),a&&(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsxs)("button",{onClick:()=>s(e.id),disabled:!!l?.mutation,className:`px-6 py-3 text-sm font-bold rounded-lg transition-colors flex items-center gap-2 ${l?.mutation?"bg-blue-600/70 text-white cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[l?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),"Ô∏è Executer cette action"]}),(0,t.jsxs)("button",{onClick:()=>r(e.id),disabled:!!l?.mutation,className:`px-4 py-2 text-sm font-medium rounded transition-colors flex items-center gap-2 ${l?.mutation?"bg-green-600/70 text-white cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"}`,children:[l?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),"Marquer comme executee"]})]}),e.executed&&e.executedAt&&(0,t.jsx)("div",{className:"p-3 bg-green-50 border border-green-300 rounded mb-3",children:(0,t.jsxs)("div",{className:"text-sm text-green-800",children:["Executee le ",new Date(e.executedAt).toLocaleString("fr-FR"),e.executedBy&&` par ${e.executedBy}`]})}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-3",children:["Proposee par ",e.proposedBy," - ",new Date(e.createdAt).toLocaleString("fr-FR")]})]})]})},e.id)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"[emoji] Actions proposees"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Actions concretes pour reduire l'incertitude et progresser"})]}),(0,t.jsx)("div",{className:"p-4 bg-blue-50 border-2 border-blue-200 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"text-2xl",children:"üéØ"}),(0,t.jsxs)("div",{className:"text-sm text-blue-900",children:[(0,t.jsx)("div",{className:"font-semibold mb-1",children:"Principe:"}),(0,t.jsxs)("p",{children:["Chaque action proposee doit avoir un ",(0,t.jsx)("strong",{children:"objectif clair"}),': obtenir une information manquante, valider une hypothese, ou alerter sur un risque. Pas d\'action "au cas ou".']})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-blue-50 border-2 border-blue-200 rounded-lg",children:[(0,t.jsx)("div",{className:"text-3xl text-blue-600 mb-2",children:"[emoji]"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:i.length}),(0,t.jsxs)("div",{className:"text-sm text-blue-700",children:["Action",i.length>1?"s":""," totale",i.length>1?"s":""]})]}),(0,t.jsxs)("div",{className:"p-4 bg-orange-50 border-2 border-orange-200 rounded-lg",children:[(0,t.jsx)("div",{className:"text-3xl text-orange-600 mb-2"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-orange-900",children:n.length}),(0,t.jsx)("div",{className:"text-sm text-orange-700",children:"En attente"})]}),(0,t.jsxs)("div",{className:"p-4 bg-green-50 border-2 border-green-200 rounded-lg",children:[(0,t.jsx)("div",{className:"text-3xl text-green-600 mb-2"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-green-900",children:d.length}),(0,t.jsxs)("div",{className:"text-sm text-green-700",children:["Executee",d.length>1?"s":""]})]})]}),n.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold text-blue-700",children:["Actions en attente (",n.length,")"]}),(0,t.jsx)("div",{className:"space-y-4",children:n.map(e=>c(e,!0))})]}),d.length>0&&(0,t.jsxs)("details",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,t.jsxs)("summary",{className:"font-semibold text-green-900 cursor-pointer",children:["Actions executees (",d.length,")"]}),(0,t.jsx)("div",{className:"mt-4 space-y-4",children:d.map(e=>c(e,!1))})]}),0===i.length&&(0,t.jsxs)("div",{className:"p-8 bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg text-center",children:[(0,t.jsx)("div",{className:"text-4xl mb-3",children:"[emoji]"}),(0,t.jsx)("div",{className:"text-gray-600",children:"Aucune action proposee pour le moment"})]}),n.length>0&&(0,t.jsx)("div",{className:"p-4 bg-yellow-50 border-2 border-yellow-200 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"text-2xl",children:"Ô∏è"}),(0,t.jsxs)("div",{className:"text-sm text-yellow-900",children:[(0,t.jsx)("div",{className:"font-semibold mb-1",children:"Attention:"}),(0,t.jsx)("p",{children:"Executer une action ne garantit pas sa reussite. Apres execution, reevaluez l'etat du workspace pour voir si l'incertitude a diminue."})]})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t-2 border-gray-200",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:[i.length," action",i.length>1?"s":""," proposee",i.length>1?"s":"",n.length>0&&(0,t.jsxs)("span",{className:"ml-2 text-orange-600 font-medium",children:["- ",n.length," en attente"]})]}),(0,t.jsxs)("button",{onClick:a,disabled:!!l?.mutation,className:`px-6 py-3 font-medium rounded-lg transition-colors flex items-center gap-2 ${l?.mutation?"bg-blue-600/70 text-white cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[l?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),"Continuer [Next] Preparer pour humain"]})]})]})}function N({workspace:e,onTakeDecision:s,onReject:r,loading:a}){let l=e.facts||[],i=e.contextHypotheses?.filter(e=>"CONFIRMED"===e.certaintyLevel)||[],n=e.obligations||[],d=n.filter(e=>e.critical),c=(e.missingElements||[]).filter(e=>e.blocking&&!e.resolved),x=e.risks||[],m=x.filter(e=>e.riskScore>=6),u=(e.proposedActions||[]).filter(e=>!e.executed),g=e.uncertaintyLevel,h=e.reasoningQuality,b=c.length>0?{icon:"[emoji]",title:"ACTION IMPOSSIBLE",message:`${c.length} element${c.length>1?"s":""} bloquant${c.length>1?"s":""} non resolu${c.length>1?"s":""}. Toute action serait prematuree et dangereuse.`,color:"border-red-500 bg-red-50",canAct:!1}:g>=.8?{icon:"[emoji]",title:"ACTION DeCONSEILLeE",message:`Niveau d'incertitude tres eleve (${(100*g).toFixed(0)}%). Risques majeurs non maitrises.`,color:"border-red-500 bg-red-50",canAct:!1}:g>=.5?{icon:"[emoji]",title:"ACTION RISQUeE",message:`Niveau d'incertitude modere (${(100*g).toFixed(0)}%). Validation humaine renforcee requise.`,color:"border-orange-500 bg-orange-50",canAct:!0}:{icon:"[emoji]",title:"ACTION POSSIBLE",message:`Niveau d'incertitude acceptable (${(100*g).toFixed(0)}%). Situation suffisamment claire pour agir.`,color:"border-green-500 bg-green-50",canAct:!0};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"üéØ Pret pour decision humaine"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Synthese du raisonnement et recommandation"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"p-6 border-2 border-gray-300 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Niveau d'incertitude"}),(0,t.jsxs)("span",{className:`px-3 py-1 text-sm font-bold rounded ${g>=.8?"bg-red-600 text-white":g>=.5?"bg-orange-500 text-white":g>=.3?"bg-yellow-500 text-white":"bg-green-500 text-white"}`,children:[(100*g).toFixed(0),"%"]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,t.jsx)("div",{className:`h-3 rounded-full transition-all ${g>=.8?"bg-red-600":g>=.5?"bg-orange-500":g>=.3?"bg-yellow-500":"bg-green-500"}`,style:{width:`${100*g}%`}})}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:"Plus bas = meilleur"})]}),(0,t.jsxs)("div",{className:"p-6 border-2 border-gray-300 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Qualite du raisonnement"}),(0,t.jsxs)("span",{className:`px-3 py-1 text-sm font-bold rounded ${h>=.8?"bg-green-600 text-white":h>=.5?"bg-orange-500 text-white":"bg-red-600 text-white"}`,children:[(100*h).toFixed(0),"%"]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,t.jsx)("div",{className:`h-3 rounded-full transition-all ${h>=.8?"bg-green-600":h>=.5?"bg-orange-500":"bg-red-600"}`,style:{width:`${100*h}%`}})}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-2",children:"Plus haut = meilleur"})]})]}),(0,t.jsx)("div",{className:`p-6 border-4 rounded-lg ${b.color}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:"text-5xl",children:b.icon}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:b.title}),(0,t.jsx)("p",{className:"text-lg text-gray-700",children:b.message})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-blue-50 border-2 border-blue-200 rounded-lg text-center",children:[(0,t.jsx)("div",{className:"text-3xl mb-2"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:l.length}),(0,t.jsxs)("div",{className:"text-sm text-blue-700",children:["Fait",l.length>1?"s":""," certain",l.length>1?"s":""]})]}),(0,t.jsxs)("div",{className:"p-4 bg-purple-50 border-2 border-purple-200 rounded-lg text-center",children:[(0,t.jsx)("div",{className:"text-3xl mb-2",children:"[emoji]"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-purple-900",children:i.length}),(0,t.jsxs)("div",{className:"text-sm text-purple-700",children:["Contexte",i.length>1?"s":""," confirme",i.length>1?"s":""]})]}),(0,t.jsxs)("div",{className:"p-4 bg-orange-50 border-2 border-orange-200 rounded-lg text-center",children:[(0,t.jsx)("div",{className:"text-3xl mb-2",children:"[emoji]"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-orange-900",children:n.length}),(0,t.jsxs)("div",{className:"text-sm text-orange-700",children:["Obligation",n.length>1?"s":""]})]}),(0,t.jsxs)("div",{className:"p-4 bg-red-50 border-2 border-red-200 rounded-lg text-center",children:[(0,t.jsx)("div",{className:"text-3xl mb-2",children:"Ô∏è"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-red-900",children:x.length}),(0,t.jsxs)("div",{className:"text-sm text-red-700",children:["Risque",x.length>1?"s":""]})]})]}),(c.length>0||m.length>0||d.length>0)&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-red-700",children:"[emoji] Points d'alerte critiques"}),c.length>0&&(0,t.jsxs)("div",{className:"p-4 bg-red-50 border-2 border-red-300 rounded-lg",children:[(0,t.jsxs)("div",{className:"font-semibold text-red-900 mb-2",children:[c.length," element",c.length>1?"s":""," bloquant",c.length>1?"s":"",":"]}),(0,t.jsx)("ul",{className:"list-disc list-inside text-sm text-red-800 space-y-1",children:c.map(e=>(0,t.jsx)("li",{children:e.description},e.id))})]}),m.length>0&&(0,t.jsxs)("div",{className:"p-4 bg-red-50 border-2 border-red-300 rounded-lg",children:[(0,t.jsxs)("div",{className:"font-semibold text-red-900 mb-2",children:["[emoji] ",m.length," risque",m.length>1?"s":""," critique",m.length>1?"s":"",":"]}),(0,t.jsx)("ul",{className:"list-disc list-inside text-sm text-red-800 space-y-1",children:m.map(e=>(0,t.jsxs)("li",{children:[e.description," (Score: ",e.riskScore,"/9)"]},e.id))})]}),d.length>0&&(0,t.jsxs)("div",{className:"p-4 bg-orange-50 border-2 border-orange-300 rounded-lg",children:[(0,t.jsxs)("div",{className:"font-semibold text-orange-900 mb-2",children:["Ô∏è ",d.length," obligation",d.length>1?"s":""," critique",d.length>1?"s":"",":"]}),(0,t.jsx)("ul",{className:"list-disc list-inside text-sm text-orange-800 space-y-1",children:d.map(e=>(0,t.jsxs)("li",{children:[e.description,e.deadline&&` (echeance: ${new Date(e.deadline).toLocaleDateString("fr-FR")})`]},e.id))})]})]}),u.length>0&&(0,t.jsxs)("div",{className:"p-4 bg-blue-50 border-2 border-blue-200 rounded-lg",children:[(0,t.jsxs)("div",{className:"font-semibold text-blue-900 mb-2",children:["[emoji] ",u.length," action",u.length>1?"s":""," recommandee",u.length>1?"s":"",":"]}),(0,t.jsx)("ul",{className:"list-disc list-inside text-sm text-blue-800 space-y-1",children:u.map(e=>(0,t.jsx)("li",{children:e.description},e.id))})]}),(0,t.jsx)("div",{className:"p-4 bg-purple-50 border-2 border-purple-200 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"text-2xl",children:"Ô∏è"}),(0,t.jsxs)("div",{className:"text-sm text-purple-900",children:[(0,t.jsx)("div",{className:"font-semibold mb-1",children:"Rappel important:"}),(0,t.jsxs)("p",{children:["Cette synthese est une ",(0,t.jsx)("strong",{children:"aide a la decision"}),", pas une decision. L'IA a structure le raisonnement, identifie les incertitudes et les risques.",(0,t.jsx)("strong",{children:" C'est a l'humain de decider"})," en fonction de son expertise juridique et du contexte complet."]})]})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-4 pt-4 border-t-2 border-gray-200",children:[(0,t.jsxs)("button",{onClick:()=>{let e=prompt("Pourquoi rejetez-vous ce raisonnement ?");e&&r(e)},disabled:!!a?.mutation,className:`px-6 py-3 font-medium rounded-lg transition-colors flex items-center gap-2 ${a?.mutation?"bg-red-600/70 text-white cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white"}`,children:[a?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),"Rejeter le raisonnement"]}),(0,t.jsxs)("button",{onClick:s,disabled:!b.canAct||!!a?.mutation,className:`px-8 py-3 font-bold rounded-lg transition-colors flex items-center gap-2 ${!b.canAct||a?.mutation?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"}`,children:[a?.mutation&&(0,t.jsx)(o.Loader2,{className:"h-4 w-4 animate-spin"}),b.canAct?" Valider et prendre decision":"[emoji] Action bloquee - Resoudre les alertes"]}),(0,t.jsxs)("div",{className:"ml-auto text-xs text-gray-500",children:["Workspace: ",e.id]})]})]})}function v({workspace:e,onStateChange:s,onUpdate:l,loading:i,onRefresh:n}){let o,d,c,x,v,f,y,w,E,[I,T]=(0,r.useState)(!1),C=Object.keys(a.WORKSPACE_STATES).indexOf(e.currentState),A=e.transitions||[];return(0,t.jsxs)("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"[emoji] Workspace Reasoning Engine"}),(0,t.jsxs)("p",{className:"text-gray-600 mt-1",children:["Raisonnement structure - etat actuel: ",(0,t.jsx)("strong",{children:a.WORKSPACE_STATES[e.currentState].label})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("button",{onClick:()=>T(!I),className:"px-4 py-2 text-sm font-medium bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors",children:["[emoji] ",I?"Masquer":"Voir"," historique"]}),e.locked&&(0,t.jsx)("span",{className:"px-4 py-2 text-sm font-bold bg-purple-600 text-white rounded",children:"[emoji] Verrouille"})]})]}),(0,t.jsx)("div",{className:"bg-white border-2 border-gray-300 rounded-lg p-6",children:(o=Object.entries(a.WORKSPACE_STATES),(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("div",{className:"flex items-center justify-between mb-8",children:o.map(([e,s],r)=>{let a=r<C,l=r===C;return(0,t.jsxs)("div",{className:"flex flex-col items-center flex-1",children:[r<o.length-1&&(0,t.jsx)("div",{className:`absolute top-6 h-1 ${r<C?"bg-green-500":r===C?"bg-blue-500":"bg-gray-300"}`,style:{left:`${r/(o.length-1)*100}%`,width:`${100/(o.length-1)}%`,marginLeft:0===r?"50%":"0",marginRight:r===o.length-2?"50%":"0"}}),(0,t.jsx)("div",{className:`relative z-10 w-12 h-12 rounded-full flex items-center justify-center border-4 ${a?"bg-green-500 border-green-600 text-white":l?"bg-blue-500 border-blue-600 text-white animate-pulse":"bg-gray-200 border-gray-300 text-gray-500"}`,children:a?"[Check]":s.icon}),(0,t.jsx)("div",{className:`mt-2 text-xs font-medium text-center ${l?"text-blue-700 font-bold":"text-gray-600"}`,children:s.label})]},e)})})}))}),(d=e.uncertaintyLevel,c=e.reasoningQuality,(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,t.jsxs)("div",{className:"p-4 bg-gradient-to-r from-orange-50 to-red-50 border-2 border-orange-300 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Incertitude"}),(0,t.jsxs)("span",{className:`px-3 py-1 text-sm font-bold rounded ${d>=.8?"bg-red-600 text-white":d>=.5?"bg-orange-500 text-white":d>=.3?"bg-yellow-500 text-white":"bg-green-500 text-white"}`,children:[(100*d).toFixed(0),"%"]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:`h-2 rounded-full ${d>=.8?"bg-red-600":d>=.5?"bg-orange-500":d>=.3?"bg-yellow-500":"bg-green-500"}`,style:{width:`${100*d}%`}})})]}),(0,t.jsxs)("div",{className:"p-4 bg-gradient-to-r from-green-50 to-blue-50 border-2 border-green-300 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Qualite raisonnement"}),(0,t.jsxs)("span",{className:`px-3 py-1 text-sm font-bold rounded ${c>=.8?"bg-green-600 text-white":c>=.5?"bg-orange-500 text-white":"bg-red-600 text-white"}`,children:[(100*c).toFixed(0),"%"]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:`h-2 rounded-full ${c>=.8?"bg-green-600":c>=.5?"bg-orange-500":"bg-red-600"}`,style:{width:`${100*c}%`}})})]})]})),(x=e.facts?.length||0,v=e.contextHypotheses?.filter(e=>"CONFIRMED"===e.certaintyLevel).length||0,f=e.obligations?.length||0,y=e.missingElements?.filter(e=>e.blocking&&!e.resolved).length||0,w=e.risks?.length||0,E=e.proposedActions?.filter(e=>!e.executed).length||0,(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-3 mb-6",children:[(0,t.jsxs)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-700",children:x}),(0,t.jsx)("div",{className:"text-xs text-blue-600",children:"Faits"})]}),(0,t.jsxs)("div",{className:"p-3 bg-purple-50 border border-purple-200 rounded text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-purple-700",children:v}),(0,t.jsx)("div",{className:"text-xs text-purple-600",children:"Contextes"})]}),(0,t.jsxs)("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-orange-700",children:f}),(0,t.jsx)("div",{className:"text-xs text-orange-600",children:"Obligations"})]}),(0,t.jsxs)("div",{className:"p-3 bg-red-50 border border-red-200 rounded text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-red-700",children:y}),(0,t.jsx)("div",{className:"text-xs text-red-600",children:"Bloquants"})]}),(0,t.jsxs)("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-yellow-700",children:w}),(0,t.jsx)("div",{className:"text-xs text-yellow-600",children:"Risques"})]}),(0,t.jsxs)("div",{className:"p-3 bg-green-50 border border-green-200 rounded text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-700",children:E}),(0,t.jsx)("div",{className:"text-xs text-green-600",children:"Actions"})]})]})),I&&A.length>0&&(0,t.jsxs)("details",{open:!0,className:"bg-gray-50 border-2 border-gray-300 rounded-lg p-4",children:[(0,t.jsxs)("summary",{className:"font-semibold text-gray-900 cursor-pointer mb-3",children:["[emoji] Historique des transitions (",A.length,")"]}),(0,t.jsx)("div",{className:"space-y-2",children:A.map((e,s)=>(0,t.jsxs)("div",{className:"p-3 bg-white border border-gray-200 rounded",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:e.fromState}),(0,t.jsx)("span",{className:"mx-2",children:"[Next]"}),(0,t.jsx)("span",{className:"font-medium text-blue-600",children:e.toState})]}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.triggeredAt).toLocaleString("fr-FR")})]}),e.reason&&(0,t.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:["Raison: ",e.reason]})]},s))})]}),(0,t.jsx)("div",{className:"bg-white border-2 border-gray-300 rounded-lg p-6",children:(()=>{let r={workspace:e,loading:i};switch(e.currentState){case"RECEIVED":return(0,t.jsx)(m,{...r,onStartAnalysis:()=>s("FACTS_EXTRACTED"),onRefresh:n});case"FACTS_EXTRACTED":return(0,t.jsx)(u,{...r,onContinue:()=>s("CONTEXT_IDENTIFIED"),onAddFact:s=>{l({facts:[...e.facts||[],s]})}});case"CONTEXT_IDENTIFIED":return(0,t.jsx)(g,{...r,onConfirmContext:s=>{l({contextHypotheses:e.contextHypotheses?.map(e=>e.id===s?{...e,certaintyLevel:"CONFIRMED"}:e)})},onRejectContext:s=>{l({contextHypotheses:e.contextHypotheses?.filter(e=>e.id!==s)})},onContinue:()=>s("OBLIGATIONS_DEDUCED")});case"OBLIGATIONS_DEDUCED":return(0,t.jsx)(h,{...r,onMarkCritical:s=>{l({obligations:e.obligations?.map(e=>e.id===s?{...e,critical:!0}:e)})},onContinue:()=>s("MISSING_IDENTIFIED")});case"MISSING_IDENTIFIED":return(0,t.jsx)(b,{...r,onGenerateAction:e=>{console.log("Generate action for missing:",e)},onResolve:(s,t)=>{l({missingElements:e.missingElements?.map(e=>e.id===s?{...e,resolved:!0,resolution:t,resolvedAt:new Date,resolvedBy:"USER"}:e)})}});case"RISK_EVALUATED":return(0,t.jsx)(p,{...r,onContinue:()=>s("ACTION_PROPOSED")});case"ACTION_PROPOSED":return(0,t.jsx)(j,{...r,onExecute:e=>{console.log("Execute action:",e)},onMarkExecuted:s=>{l({proposedActions:e.proposedActions?.map(e=>e.id===s?{...e,executed:!0,executedAt:new Date,executedBy:"USER"}:e)})},onContinue:()=>s("READY_FOR_HUMAN")});case"READY_FOR_HUMAN":return(0,t.jsx)(N,{...r,onTakeDecision:()=>{l({locked:!0}),console.log("Decision taken by human")},onReject:e=>{console.log("Reasoning rejected:",e)}});default:return(0,t.jsxs)("div",{className:"p-8 bg-gray-50 border-2 border-gray-300 rounded-lg text-center",children:[(0,t.jsx)("div",{className:"text-4xl mb-3"}),(0,t.jsxs)("div",{className:"text-gray-700 font-semibold",children:["etat inconnu: ",e.currentState]})]})}})()})]})}var f=e.i(283599);async function y(e){let s=await fetch(e);if(!s.ok)throw Error((await s.json().catch(()=>({error:"Network error"}))).error||`API error: ${s.status}`);return s.json()}async function w(e){let s=await fetch("/api/workspace-reasoning/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw Error((await s.json()).error||"Failed to create workspace");return(await s.json()).workspace}var E=r;class I extends E.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("ErrorBoundary caught an error:",e,s),this.setState({error:e,errorInfo:s}),this.props.onError&&this.props.onError(e,s)}componentDidUpdate(e){var s,t;this.state.hasError&&this.props.resetKeys&&e.resetKeys&&(s=this.props.resetKeys,t=e.resetKeys,!(s.length===t.length&&s.every((e,s)=>e===t[s])))&&this.resetErrorBoundary()}resetErrorBoundary=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:(0,t.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-center w-12 h-12 bg-red-100 rounded-full mb-4 mx-auto",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 text-center mb-2",children:"Oups ! Une erreur est survenue"}),(0,t.jsx)("p",{className:"text-gray-600 text-center mb-6",children:"L'application a rencontre un probleme inattendu. Veuillez reessayer."}),!1,(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)("button",{onClick:this.resetErrorBoundary,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"[emoji] Reessayer"}),(0,t.jsx)("button",{onClick:()=>window.location.href="/",className:"w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-200 transition-colors",children:"üè† Retour a l'accueil"}),!1]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 text-center mt-6",children:"Si le probleme persiste, contactez le support technique."})]})}):this.props.children}}function T(){let[e,s]=(0,r.useState)(null),[a,o]=(0,r.useState)(!1),[d,c]=(0,r.useState)(null),{workspace:x,loading:m,error:u,transitionState:g,refetch:h}=function(e){let[s,t]=(0,r.useState)({workspace:!1,mutation:!1,extraction:!1}),a=(0,l.useToast)(),{data:o,error:d,isLoading:c,mutate:x}=(0,f.default)(e?`/api/workspace-reasoning/${e}`:null,y,{revalidateOnFocus:!1,revalidateOnReconnect:!0,dedupingInterval:2e3,onSuccess:()=>{t(e=>({...e,workspace:!1}))}});(0,r.useState)(()=>{t(e=>({...e,workspace:c}))});let m=(0,r.useCallback)(async(s,r)=>{if(!e)throw Error("No workspace ID");let l="CONTEXT_IDENTIFIED"===s;t(e=>({...e,mutation:!0,extraction:l}));try{let t=await fetch(`/api/workspace-reasoning/${e}/transition`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetState:s,reason:r})});if(!t.ok)throw await n(t);let l=await t.json();return await x(),a.showToast(`Transition vers ${s} reussie`,"success"),l}catch(s){let e=i(s);throw a.showToast(e.userMessage,"error",e.canRetry?"echec de la transition":void 0),e}finally{t(e=>({...e,mutation:!1,extraction:!1}))}},[e,x,a]),u=(0,r.useCallback)(async s=>{if(!e)throw Error("No workspace ID");t(e=>({...e,mutation:!0}));try{let t=await fetch(`/api/workspace-reasoning/${e}/facts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok)throw await n(t);let r=await t.json();return await x(),a.showToast("Fait ajoute avec succes","success"),r.fact}catch(s){let e=i(s);throw a.showToast(e.userMessage,"error"),e}finally{t(e=>({...e,mutation:!1}))}},[e,x,a]),g=(0,r.useCallback)(async s=>{if(!e)throw Error("No workspace ID");t(e=>({...e,mutation:!0}));try{let t=await fetch(`/api/workspace-reasoning/${e}/contexts/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"confirm"})});if(!t.ok)throw await n(t);await x(),a.showToast("Contexte confirme avec succes","success")}catch(s){let e=i(s);throw a.showToast(e.userMessage,"error"),e}finally{t(e=>({...e,mutation:!1}))}},[e,x,a]),h=(0,r.useCallback)(async s=>{if(!e)throw Error("No workspace ID");t(e=>({...e,mutation:!0}));try{let t=await fetch(`/api/workspace-reasoning/${e}/contexts/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reject"})});if(!t.ok)throw await n(t);await x(),a.showToast("Contexte rejete","success")}catch(s){let e=i(s);throw a.showToast(e.userMessage,"error"),e}finally{t(e=>({...e,mutation:!1}))}},[e,x,a]),b=(0,r.useCallback)(async(s,r)=>{if(!e)throw Error("No workspace ID");t(e=>({...e,mutation:!0}));try{let t=await fetch(`/api/workspace-reasoning/${e}/missing/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({resolution:r})});if(!t.ok)throw await n(t);await x(),a.showToast("element manquant resolu","success")}catch(s){let e=i(s);throw a.showToast(e.userMessage,"error"),e}finally{t(e=>({...e,mutation:!1}))}},[e,x,a]),p=(0,r.useCallback)(async(s,r)=>{if(!e)throw Error("No workspace ID");t(e=>({...e,mutation:!0}));try{let t=await fetch(`/api/workspace-reasoning/${e}/actions/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({result:r})});if(!t.ok)throw await n(t);await x(),a.showToast("Action executee avec succes","success")}catch(s){let e=i(s);throw a.showToast(e.userMessage,"error"),e}finally{t(e=>({...e,mutation:!1}))}},[e,x,a]),j=(0,r.useCallback)(async s=>{if(!e)throw Error("No workspace ID");t(e=>({...e,mutation:!0}));try{let t=await fetch(`/api/workspace-reasoning/${e}/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({validationNote:s})});if(!t.ok)throw await n(t);await x(),a.showToast(" Workspace valide et verrouille","success")}catch(s){let e=i(s);throw a.showToast(e.userMessage,"error"),e}finally{t(e=>({...e,mutation:!1}))}},[e,x,a]),N=(0,r.useCallback)(async()=>{await x()},[x]);return{workspace:o?.workspace||null,loading:s,error:d||null,transitionState:m,addFact:u,confirmContext:g,rejectContext:h,resolveMissing:b,executeAction:p,validateWorkspace:j,refetch:N}}(e||"");(0,r.useEffect)(()=>{(async()=>{if(!e){o(!0),c(null);try{let e=await w({sourceType:"EMAIL",sourceId:"demo-email-123",sourceRaw:`Objet: OQTF - Madame DUBOIS Sophie

Madame, Monsieur,

Je viens de recevoir une Obligation de Quitter le Territoire Francais (OQTF) datee du 15 janvier 2026. 

La notification indique que je dois quitter le territoire sous 30 jours. Je suis en France depuis 5 ans avec mes deux enfants scolarises.

Mon titre de sejour a expire il y a 3 mois et je n'ai pas pu le renouveler a temps pour des raisons medicales.

Pouvez-vous m'aider ?

Cordialement,
Sophie DUBOIS
06 12 34 56 78`,sourceMetadata:{from:"sophie.dubois@email.com",subject:"OQTF - Madame DUBOIS Sophie",receivedAt:"2026-01-20T10:30:00Z",channel:"email"},procedureType:"OQTF"});s(e.id)}catch(e){c(e instanceof Error?e.message:"Erreur de creation"),console.error("Failed to create demo workspace:",e)}finally{o(!1)}}})()},[e]);let b={id:"loading",tenantId:"demo-tenant",currentState:"RECEIVED",stateChangedAt:new Date,stateChangedBy:"SYSTEM",sourceType:"EMAIL",sourceId:"loading",sourceRaw:"Loading...",sourceMetadata:"{}",procedureType:void 0,ownerUserId:"demo-user",clientId:void 0,dossierId:void 0,emailId:void 0,reasoningQuality:0,uncertaintyLevel:1,confidenceScore:0,locked:!1,validatedBy:void 0,validatedAt:void 0,validationNote:void 0,createdAt:new Date,updatedAt:new Date,completedAt:void 0,facts:[],contextHypotheses:[],obligations:[],missingElements:[],risks:[],proposedActions:[],reasoningTraces:[],transitions:[]},p=async s=>{if(e)try{await g(s,`Transition vers ${s}`)}catch(e){alert(`Erreur de transition: ${e instanceof Error?e.message:"Erreur inconnue"}`)}},j=async()=>{e&&await h()};return a?(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full",children:(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Creation du workspace..."}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Initialisation de la demonstration OQTF"})]})]})})}):d?(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:(0,t.jsx)("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Erreur de creation"}),(0,t.jsx)("p",{className:"text-red-600 mb-4",children:d}),(0,t.jsx)("button",{onClick:()=>{c(null),s(null)},className:"bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors",children:"Reessayer"})]})})}):u&&!m?(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:(0,t.jsx)("svg",{className:"h-6 w-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Erreur de chargement"}),(0,t.jsx)("p",{className:"text-red-600 mb-4",children:u.message}),(0,t.jsx)("button",{onClick:()=>h(),className:"bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors",children:"Recharger"})]})})}):(0,t.jsx)(l.ToastProvider,{children:(0,t.jsx)(I,{resetKeys:[e],onError:(e,s)=>{console.error("Workspace reasoning error:",e,s)},children:(0,t.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[m&&!x&&(0,t.jsx)("div",{className:"absolute inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"}),(0,t.jsx)("span",{className:"text-gray-700 font-medium",children:"Chargement..."})]})}),(0,t.jsx)(v,{workspace:x||b,onStateChange:p,onUpdate:j,loading:"object"==typeof m?m:{workspace:!!m},onRefresh:h})]})})})}e.s(["default",()=>T,"dynamic",0,"force-dynamic"],429928)}]);