(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,802999,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(217255),l=e.i(618566);function r(){var e;let r,{data:n,status:i}=(0,t.useSession)(),c=(0,l.useRouter)(),[d,o]=(0,a.useState)([]),[m,x]=(0,a.useState)(null),[g,h]=(0,a.useState)([]),[b,u]=(0,a.useState)(!0);(0,a.useEffect)(()=>{"unauthenticated"===i?c.push("/auth/login"):"authenticated"===i&&p()},[i,c]);let p=async()=>{try{let e=await fetch("/api/billing/plans");if(e.ok){let s=await e.json();o(s.plans||[])}let s=await fetch("/api/billing/subscription");if(s.ok){let e=await s.json();x(e.subscription||null)}let a=await fetch("/api/billing/quotas");if(a.ok){let e=await a.json();h(e.quotas||[])}}catch(e){console.error("Erreur chargement billing:",e)}finally{u(!1)}};return b?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Chargement..."})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Facturation & Abonnement"}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:"Gerez votre abonnement, quotas et factures"})]}),m&&(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Abonnement actuel"}),(r=({active:{label:"Actif",color:"bg-green-100 text-green-800"},trialing:{label:"Essai",color:"bg-blue-100 text-blue-800"},past_due:{label:"Impaye",color:"bg-red-100 text-red-800"},canceled:{label:"Annule",color:"bg-gray-100 text-gray-800"}})[e=m.status]||{label:e,color:"bg-gray-100 text-gray-800"},(0,s.jsx)("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${r.color}`,children:r.label}))]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Plan"}),(0,s.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:m.plan.displayName})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Tarif"}),(0,s.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:[m.pricePerMonth,"€/mois"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Periode actuelle"}),(0,s.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:[new Date(m.currentPeriodStart).toLocaleDateString("fr-FR")," - "," ",new Date(m.currentPeriodEnd).toLocaleDateString("fr-FR")]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Utilisation des quotas"}),0===g.length?(0,s.jsx)("p",{className:"text-gray-500 text-center py-8",children:"Aucun quota configure"}):(0,s.jsx)("div",{className:"space-y-4",children:g.map(e=>{var a,t;return(0,s.jsxs)("div",{className:`border rounded-lg p-4 ${(a=e.percentage)>=100?"text-red-600 bg-red-50 border-red-200":a>=80?"text-orange-600 bg-orange-50 border-orange-200":a>=60?"text-yellow-600 bg-yellow-50 border-yellow-200":"text-green-600 bg-green-50 border-green-200"}`,children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold capitalize",children:e.type}),(0,s.jsxs)("p",{className:"text-sm",children:[e.current," / ",-1===e.limit?"∞":e.limit]})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[Math.round(e.percentage),"%"]})})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:`h-2 rounded-full transition-all ${(t=e.percentage)>=100?"bg-red-500":t>=80?"bg-orange-500":t>=60?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(e.percentage,100)}%`}})}),e.percentage>=80&&(0,s.jsx)("p",{className:"text-xs mt-2",children:e.percentage>=100?"️ Quota depasse - Veuillez mettre a niveau votre plan":"️ Approche de la limite - Envisagez une mise a niveau"})]},e.type)})})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Plans disponibles"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:d.map(e=>(0,s.jsxs)("div",{className:`border-2 rounded-lg p-6 ${m?.plan.name===e.name?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[(0,s.jsxs)("div",{className:"text-center mb-4",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:e.displayName}),m?.plan.name===e.name&&(0,s.jsx)("span",{className:"inline-block mt-2 px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:"Plan actuel"})]}),(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsxs)("p",{className:"text-4xl font-bold text-gray-900",children:[e.priceMonthly,"€"]}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"par mois"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[e.priceYearly,"€/an (economie de ",Math.round((1-e.priceYearly/(12*e.priceMonthly))*100),"%)"]})]}),(0,s.jsxs)("div",{className:"space-y-2 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Workspaces"}),(0,s.jsx)("span",{className:"font-semibold",children:-1===e.maxWorkspaces?"∞":e.maxWorkspaces})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Dossiers/mois"}),(0,s.jsx)("span",{className:"font-semibold",children:-1===e.maxDossiers?"∞":e.maxDossiers})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Clients"}),(0,s.jsx)("span",{className:"font-semibold",children:-1===e.maxClients?"∞":e.maxClients})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Utilisateurs"}),(0,s.jsx)("span",{className:"font-semibold",children:-1===e.maxUsers?"∞":e.maxUsers})]})]}),(0,s.jsx)("button",{className:`w-full py-2 px-4 rounded-lg font-medium transition-colors ${m?.plan.name===e.name?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,disabled:m?.plan.name===e.name,children:m?.plan.name===e.name?"Plan actuel":"Choisir ce plan"})]},e.id))})]})]})})}e.s(["default",()=>r,"dynamic",0,"force-dynamic"])}]);