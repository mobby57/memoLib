(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,482488,e=>{"use strict";var t=e.i(843476),s=e.i(271645);function a(){let[e,a]=(0,s.useState)([]),[n,i]=(0,s.useState)([]),[c,d]=(0,s.useState)(!0),[x,o]=(0,s.useState)(!1),[h,m]=(0,s.useState)(null),[u,p]=(0,s.useState)("all"),j="demo-tenant-001",g=(0,s.useCallback)(async()=>{try{let e=await fetch(`/api/factures?tenantId=${j}`),t=await e.json();a(t.factures||[])}catch(e){console.error("Erreur chargement factures:",e)}finally{d(!1)}},[j]),b=(0,s.useCallback)(async()=>{try{let e=await fetch(`/api/clients?tenantId=${j}`),t=await e.json();i(t.clients||[])}catch(e){console.error("Erreur chargement clients:",e)}},[j]);(0,s.useEffect)(()=>{g(),b()},[g,b]);let y=e.filter(e=>"all"===u||e.statut===u),f={total:e.reduce((e,t)=>e+t.montantTTC,0),payees:e.filter(e=>"payee"===e.statut).reduce((e,t)=>e+t.montantTTC,0),enAttente:e.filter(e=>"envoyee"===e.statut).reduce((e,t)=>e+t.montantTTC,0),enRetard:e.filter(e=>"en_retard"===e.statut).reduce((e,t)=>e+t.montantTTC,0)};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"[emoji] Facturation"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Gerez vos factures et paiements"})]}),(0,t.jsxs)("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[(0,t.jsx)("span",{}),"Nouvelle Facture"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Total Facture"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:[f.total.toFixed(2),"€"]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Payees"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:[f.payees.toFixed(2),"€"]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"En attente"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-blue-600",children:[f.enAttente.toFixed(2),"€"]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"En retard"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-red-600",children:[f.enRetard.toFixed(2),"€"]})]})]}),(0,t.jsx)("div",{className:"flex gap-2 mb-4",children:["all","brouillon","envoyee","payee","en_retard"].map(e=>(0,t.jsx)("button",{onClick:()=>p(e),className:`px-3 py-1 rounded-lg text-sm ${u===e?"bg-blue-600 text-white":"bg-white text-gray-700 border"}`,children:"all"===e?"Toutes":e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")},e))}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:c?(0,t.jsx)("div",{className:"p-8 text-center",children:"Chargement..."}):0===y.length?(0,t.jsxs)("div",{className:"p-8 text-center text-gray-500",children:[(0,t.jsx)("p",{className:"text-4xl mb-2",children:"[emoji]"}),(0,t.jsx)("p",{children:"Aucune facture trouvee"}),(0,t.jsx)("button",{onClick:()=>o(!0),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Creer une facture"})]}):(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Numero"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Client"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Montant TTC"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Statut"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"echeance"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map(e=>{var s;return(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap font-medium",children:e.numero}),(0,t.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.client.firstName," ",e.client.lastName]}),(0,t.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap font-medium",children:[e.montantTTC.toFixed(2),"€"]}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(s=e.statut,(0,t.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${{brouillon:"bg-gray-100 text-gray-800",envoyee:"bg-blue-100 text-blue-800",payee:"bg-green-100 text-green-800",en_retard:"bg-red-100 text-red-800",annulee:"bg-gray-400 text-white"}[s]||"bg-gray-100"}`,children:{brouillon:"Brouillon",envoyee:"Envoyee",payee:"Payee",en_retard:"En retard",annulee:"Annulee"}[s]||s}))}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.dateEmission).toLocaleDateString("fr-FR")}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.dateEcheance).toLocaleDateString("fr-FR")}),(0,t.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,t.jsx)("button",{onClick:()=>m(e),className:"text-blue-600 hover:text-blue-800 mr-3",children:"[emoji]️ Voir"}),(0,t.jsx)("button",{className:"text-gray-600 hover:text-gray-800",children:"[emoji] PDF"})]})]},e.id)})})]})}),x&&(0,t.jsx)(l,{clients:n,tenantId:j,onClose:()=>o(!1),onCreated:()=>{o(!1),g()}}),h&&(0,t.jsx)(r,{facture:h,onClose:()=>m(null),onUpdate:()=>{m(null),g()}})]})}function l({clients:e,tenantId:a,onClose:l,onCreated:r}){let[n,i]=(0,s.useState)(""),[c,d]=(0,s.useState)([{description:"",quantite:1,prixUnitaire:0}]),[x,o]=(0,s.useState)(!1),h=(e,t,s)=>{let a=[...c];a[e][t]=s,d(a)},m=c.reduce((e,t)=>e+t.quantite*t.prixUnitaire,0),u=.2*m,p=m+u,j=async()=>{if(!n||0===c.length)return void alert("Veuillez selectionner un client et ajouter au moins une ligne");o(!0);try{let e=await fetch("/api/factures",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tenantId:a,clientId:n,lignes:c.filter(e=>e.description&&e.prixUnitaire>0)})});if(e.ok)r();else{let t=await e.json();alert(t.error||"Erreur creation facture")}}catch(e){console.error("Erreur:",e),alert("Erreur creation facture")}finally{o(!1)}};return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)("div",{className:"p-6 border-b",children:(0,t.jsx)("h2",{className:"text-xl font-bold",children:" Nouvelle Facture"})}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Client"}),(0,t.jsxs)("select",{value:n,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border rounded-lg",children:[(0,t.jsx)("option",{value:"",children:"Selectionner un client"}),e.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName," - ",e.email]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lignes de facture"}),c.map((e,s)=>(0,t.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,t.jsx)("input",{type:"text",placeholder:"Description",value:e.description,onChange:e=>h(s,"description",e.target.value),className:"flex-1 px-3 py-2 border rounded-lg"}),(0,t.jsx)("input",{type:"number",placeholder:"Qte",value:e.quantite,onChange:e=>h(s,"quantite",parseFloat(e.target.value)),className:"w-20 px-3 py-2 border rounded-lg"}),(0,t.jsx)("input",{type:"number",placeholder:"Prix",value:e.prixUnitaire,onChange:e=>h(s,"prixUnitaire",parseFloat(e.target.value)),className:"w-24 px-3 py-2 border rounded-lg"}),(0,t.jsx)("button",{onClick:()=>{d(c.filter((e,t)=>t!==s))},className:"px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg",children:"[emoji]️"})]},s)),(0,t.jsx)("button",{onClick:()=>{d([...c,{description:"",quantite:1,prixUnitaire:0}])},className:"text-blue-600 text-sm hover:underline",children:"+ Ajouter une ligne"})]}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,t.jsx)("span",{children:"Total HT:"}),(0,t.jsxs)("span",{children:[m.toFixed(2),"€"]})]}),(0,t.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,t.jsx)("span",{children:"TVA (20%):"}),(0,t.jsxs)("span",{children:[u.toFixed(2),"€"]})]}),(0,t.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,t.jsx)("span",{children:"Total TTC:"}),(0,t.jsxs)("span",{children:[p.toFixed(2),"€"]})]})]})]}),(0,t.jsxs)("div",{className:"p-6 border-t flex justify-end gap-3",children:[(0,t.jsx)("button",{onClick:l,className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Annuler"}),(0,t.jsx)("button",{onClick:j,disabled:x,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:x?"Creation...":"Creer la facture"})]})]})})}function r({facture:e,onClose:a,onUpdate:l}){let[r,n]=(0,s.useState)(!1),i=async t=>{n(!0);try{(await fetch("/api/factures",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({factureId:e.id,statut:t,datePaiement:"payee"===t?new Date().toISOString():void 0})})).ok&&l()}catch(e){console.error("Erreur:",e)}finally{n(!1)}};return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"p-6 border-b flex justify-between items-center",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold",children:["[emoji] Facture ",e.numero]}),(0,t.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 text-2xl",children:"x"})]}),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"font-medium mb-2",children:"Client"}),(0,t.jsxs)("p",{children:[e.client.firstName," ",e.client.lastName]}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:e.client.email})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-medium mb-2",children:"Prestations"}),(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"text-left text-sm text-gray-500",children:[(0,t.jsx)("th",{className:"pb-2",children:"Description"}),(0,t.jsx)("th",{className:"pb-2 text-right",children:"Qte"}),(0,t.jsx)("th",{className:"pb-2 text-right",children:"Prix"}),(0,t.jsx)("th",{className:"pb-2 text-right",children:"Total"})]})}),(0,t.jsx)("tbody",{children:e.lignes.map((e,s)=>(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsx)("td",{className:"py-2",children:e.description}),(0,t.jsx)("td",{className:"py-2 text-right",children:e.quantite}),(0,t.jsxs)("td",{className:"py-2 text-right",children:[e.prixUnitaire.toFixed(2),"€"]}),(0,t.jsxs)("td",{className:"py-2 text-right",children:[e.montantHT.toFixed(2),"€"]})]},s))})]})]}),(0,t.jsxs)("div",{className:"border-t pt-4",children:[(0,t.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,t.jsx)("span",{children:"Total HT:"}),(0,t.jsxs)("span",{children:[e.montantHT.toFixed(2),"€"]})]}),(0,t.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,t.jsxs)("span",{children:["TVA (",e.montantTVA>0?"20":"0","%):"]}),(0,t.jsxs)("span",{children:[e.montantTVA.toFixed(2),"€"]})]}),(0,t.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,t.jsx)("span",{children:"Total TTC:"}),(0,t.jsxs)("span",{children:[e.montantTTC.toFixed(2),"€"]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:["brouillon"===e.statut&&(0,t.jsx)("button",{onClick:()=>i("envoyee"),disabled:r,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"[emoji] Envoyer"}),"envoyee"===e.statut&&(0,t.jsx)("button",{onClick:()=>i("payee"),disabled:r,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:"Marquer payee"}),(0,t.jsx)("button",{className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"[emoji] Telecharger PDF"})]})]})]})})}e.s(["default",()=>a,"dynamic",0,"force-dynamic"])}]);