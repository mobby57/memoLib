(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,16715,e=>{"use strict";let s=(0,e.i(475254).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>s],16715)},82735,e=>{"use strict";let s=(0,e.i(475254).default)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);e.s(["Paperclip",()=>s],82735)},431343,e=>{"use strict";let s=(0,e.i(475254).default)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);e.s(["Play",()=>s],431343)},12005,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(263488);let r=(0,e.i(475254).default)("workflow",[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]]);var l=e.i(16715),i=e.i(269638),d=e.i(503116),c=e.i(878894),n=e.i(373884),x=e.i(25652),m=e.i(342920),o=e.i(82735),g=e.i(431343);let h={critical:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",high:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",low:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"},y={pending:(0,s.jsx)(d.Clock,{className:"w-4 h-4 text-gray-500"}),running:(0,s.jsx)(g.Play,{className:"w-4 h-4 text-blue-500 animate-pulse"}),completed:(0,s.jsx)(i.CheckCircle,{className:"w-4 h-4 text-green-500"}),failed:(0,s.jsx)(n.XCircle,{className:"w-4 h-4 text-red-500"}),cancelled:(0,s.jsx)(n.XCircle,{className:"w-4 h-4 text-gray-500"})},u={"client-urgent":"[emoji] Urgent Client","new-case":"[emoji] Nouveau Dossier","deadline-reminder":" echeance",invoice:"[emoji] Facture","legal-question":"ï¸ Question Juridique","court-document":"ðŸ›ï¸ Document Judiciaire","client-complaint":"[emoji] Reclamation","document-request":"[emoji] Demande Document","appointment-request":"[emoji] Rendez-vous","general-inquiry":"[emoji] Demande Generale"};function p(){let[e,i]=(0,a.useState)([]),[d,n]=(0,a.useState)([]),[p,j]=(0,a.useState)(null),[b,N]=(0,a.useState)(null),[f,w]=(0,a.useState)(!0),[k,v]=(0,a.useState)("emails"),[C,S]=(0,a.useState)(!0),[M,P]=(0,a.useState)(null),[A,T]=(0,a.useState)(null),D=(0,a.useCallback)(async()=>{try{let[e,s]=await Promise.all([fetch("/api/super-admin/emails?limit=20"),fetch("/api/super-admin/workflows?limit=20")]);if(e.ok){let s=await e.json();i(s.emails),j(s.stats)}if(s.ok){let e=await s.json();n(e.workflows),N(e.stats)}}catch(e){console.error("Erreur chargement donnees:",e)}finally{w(!1)}},[]);(0,a.useEffect)(()=>{let e;return D(),C&&(e=setInterval(D,5e3)),()=>{e&&clearInterval(e)}},[C,D]);let E=e=>new Date(e).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"});return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-6",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[(0,s.jsx)(r,{className:"w-8 h-8 text-blue-600"}),"Monitoring Email & Workflows"]}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Suivi en temps reel des emails et workflows de la plateforme"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:C,onChange:e=>S(e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,s.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Auto-refresh (5s)"})]}),(0,s.jsxs)("button",{onClick:D,disabled:f,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition disabled:opacity-50",children:[(0,s.jsx)(l.RefreshCw,{className:`w-4 h-4 ${f?"animate-spin":""}`}),"Actualiser"]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Emails Total"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:p?.total||0})]}),(0,s.jsx)(t.Mail,{className:"w-10 h-10 text-blue-500 opacity-80"})]})}),(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Non traites"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-orange-600",children:p?.unprocessed||0})]}),(0,s.jsx)(c.AlertTriangle,{className:"w-10 h-10 text-orange-500 opacity-80"})]})}),(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Workflows actifs"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:b?.byStatus?.running||0})]}),(0,s.jsx)(g.Play,{className:"w-10 h-10 text-blue-500 opacity-80"})]})}),(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Temps moyen"}),(0,s.jsx)("p",{className:"text-3xl font-bold text-green-600",children:b?.avgExecutionTimeMs?`${Math.round(b.avgExecutionTimeMs/1e3)}s`:"-"})]}),(0,s.jsx)(x.TrendingUp,{className:"w-10 h-10 text-green-500 opacity-80"})]})})]}),(0,s.jsxs)("div",{className:"flex gap-4 mb-6 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsxs)("button",{onClick:()=>v("emails"),className:`pb-4 px-2 font-medium transition ${"emails"===k?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:[(0,s.jsx)(t.Mail,{className:"w-4 h-4 inline mr-2"}),"Emails (",p?.total||0,")"]}),(0,s.jsxs)("button",{onClick:()=>v("workflows"),className:`pb-4 px-2 font-medium transition ${"workflows"===k?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:[(0,s.jsx)(r,{className:"w-4 h-4 inline mr-2"}),"Workflows (",b?.total||0,")"]})]}),"emails"===k?(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-2 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:(0,s.jsx)("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:0===e.length?(0,s.jsxs)("div",{className:"p-12 text-center",children:[(0,s.jsx)(t.Mail,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Aucun email"})]}):e.map(e=>(0,s.jsx)("div",{onClick:()=>P(e),className:`p-4 cursor-pointer transition hover:bg-gray-50 dark:hover:bg-gray-700 ${M?.id===e.id?"bg-blue-50 dark:bg-blue-900/20":""} ${!e.isProcessed?"border-l-4 border-orange-500":""}`,children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.from}),(0,s.jsx)("span",{className:`px-2 py-0.5 text-xs rounded-full ${h[e.urgency]}`,children:e.urgency}),e.attachmentCount>0&&(0,s.jsx)(o.Paperclip,{className:"w-3 h-3 text-gray-400"})]}),(0,s.jsx)("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-200 truncate",children:e.subject}),(0,s.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mt-1",children:e.preview}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,s.jsx)("span",{className:"text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded",children:u[e.category]||e.category}),(0,s.jsxs)("span",{className:"text-xs text-gray-400",children:[(0,s.jsx)(m.Building,{className:"w-3 h-3 inline mr-1"}),e.tenant.name]})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500",children:E(e.receivedAt)}),e.workflow&&(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-1",children:[y[e.workflow.status],(0,s.jsxs)("span",{className:"text-xs text-gray-500",children:[e.workflow.progress,"%"]})]})]})]})},e.id))})}),(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:M?(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-lg text-gray-900 dark:text-white mb-4",children:"Details Email"}),(0,s.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"De:"}),(0,s.jsx)("p",{className:"font-medium",children:M.from})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"a:"}),(0,s.jsx)("p",{className:"font-medium",children:M.to})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Sujet:"}),(0,s.jsx)("p",{className:"font-medium",children:M.subject})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Categorie:"}),(0,s.jsx)("p",{children:u[M.category]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Cabinet:"}),(0,s.jsx)("p",{children:M.tenant.name})]}),M.client&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Client:"}),(0,s.jsxs)("p",{children:[M.client.firstName," ",M.client.lastName]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Statut:"}),(0,s.jsx)("p",{className:M.isProcessed?"text-green-600":"text-orange-600",children:M.isProcessed?"Traite":"En attente"})]}),M.workflow&&(0,s.jsxs)("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"Workflow:"}),(0,s.jsx)("p",{className:"font-medium",children:M.workflow.workflowName}),(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${M.workflow.progress}%`}})}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[M.workflow.status," - ",M.workflow.progress,"%"]})]})]})]})]}):(0,s.jsxs)("div",{className:"text-center text-gray-500 py-12",children:[(0,s.jsx)(t.Mail,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,s.jsx)("p",{children:"Selectionnez un email pour voir les details"})]})})]}):(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Workflow"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Cabinet"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Email Declencheur"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Statut"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Progression"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Demarre"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:0===d.length?(0,s.jsx)("tr",{children:(0,s.jsxs)("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:[(0,s.jsx)(r,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),"Aucun workflow execute"]})}):d.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",onClick:()=>T(e),children:[(0,s.jsxs)("td",{className:"px-6 py-4",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.workflowName}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.currentStep})]}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:e.tenant.name}),(0,s.jsx)("td",{className:"px-6 py-4",children:e.email?(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("p",{className:"truncate max-w-[200px]",children:e.email.subject}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:e.email.from})]}):(0,s.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[y[e.status],(0,s.jsx)("span",{className:"text-sm capitalize",children:e.status})]})}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsxs)("div",{className:"w-24",children:[(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:`h-2 rounded-full transition-all ${"completed"===e.status?"bg-green-500":"failed"===e.status?"bg-red-500":"bg-blue-500"}`,style:{width:`${e.progress}%`}})}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[e.progress,"%"]})]})}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",children:e.startedAt?E(e.startedAt):"-"})]},e.id))})]})})})]})})}e.s(["default",()=>p,"dynamic",0,"force-dynamic"],12005)}]);