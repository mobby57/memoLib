(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,727612,e=>{"use strict";let t=(0,e.i(475254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>t],727612)},431343,e=>{"use strict";let t=(0,e.i(475254).default)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);e.s(["Play",()=>t],431343)},595468,e=>{"use strict";let t=(0,e.i(475254).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],595468)},833884,e=>{"use strict";var t=e.i(843476),a=e.i(271645);let s=(0,a.memo)(({size:e="md",color:a="blue",className:s=""})=>(0,t.jsxs)("div",{className:`inline-block ${s}`,role:"status","aria-label":"Chargement",children:[(0,t.jsxs)("svg",{className:`animate-spin ${{sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"}[e]} ${{blue:"text-blue-600",gray:"text-gray-600",white:"text-white"}[a]} gpu-accelerated`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,t.jsx)("span",{className:"sr-only",children:"Chargement..."})]}));s.displayName="LoadingSpinner";var r=e.i(165918);let i=(0,a.memo)(a.default.forwardRef(({variant:e="primary",size:a="md",isLoading:i=!1,className:n="",children:l,disabled:o,...c},d)=>{let u="primary"===e?{backgroundColor:r.colors.button,color:"white"}:{};return(0,t.jsx)("button",{ref:d,className:`
          inline-flex items-center justify-center font-medium rounded-lg transition-all duration-150 ease-out focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed will-change-transform
          ${{primary:"text-white hover:scale-105",secondary:"bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500 hover:scale-105",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500 hover:scale-105",outline:"border-2 border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-gray-500 hover:scale-105"}[e]}
          ${{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[a]}
          ${n}
        `,style:u,disabled:o||i,...c,children:i?(0,t.jsxs)("span",{className:"flex items-center justify-center",children:[(0,t.jsx)(s,{size:"sm",color:"outline"===e?"gray":"white",className:"mr-2"}),"Chargement..."]}):l})}));i.displayName="Button",e.s(["Button",0,i],833884)},164485,e=>{"use strict";e.i(754338),e.i(232768),e.i(888840),e.s([],164485)},564486,e=>{"use strict";e.s(["safeLocalStorage",0,{getItem:e=>localStorage.getItem(e),setItem:(e,t)=>{localStorage.setItem(e,t)},removeItem:e=>{localStorage.removeItem(e)},clear:()=>{localStorage.clear()}}])},227516,e=>{"use strict";let t=(0,e.i(475254).default)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);e.s(["History",()=>t],227516)},36989,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(339964),r=e.i(964753),i=e.i(833884),n=e.i(159354);e.i(164485);var l=e.i(888840),o=e.i(564486),c=e.i(778497);let d=[{name:"Relance facture impayee",description:"Envoie automatiquement un email de relance 7 jours apres l'echeance d'une facture",enabled:!0,trigger:{type:"facture_overdue",conditions:[{field:"daysOverdue",operator:"equals",value:7}]},actions:[{type:"send_email",params:{template:"facture_relance",to:"{{client.email}}",subject:"Relance facture {{facture.numero}}"}},{type:"create_task",params:{title:"Suivre relance facture {{facture.numero}}",assignedTo:"{{facture.responsable}}",dueDate:"+3 days"}}]},{name:"Notification echeance proche",description:"Cree une alerte 3 jours avant une echeance importante",enabled:!0,trigger:{type:"echeance_approaching",conditions:[{field:"daysRemaining",operator:"equals",value:3},{field:"urgency",operator:"in",value:["ELEVE","CRITIQUE"]}]},actions:[{type:"create_notification",params:{type:"warning",title:"echeance dans 3 jours",message:"{{dossier.titre}} - {{echeance.description}}",recipients:["{{dossier.responsable}}"]}},{type:"send_email",params:{template:"echeance_reminder",to:"{{dossier.responsable}}"}}]},{name:"Nouveau dossier - Attribution automatique",description:"Assigne automatiquement un nouveau dossier selon le type",enabled:!0,trigger:{type:"dossier_created",conditions:[]},actions:[{type:"assign_to_user",params:{strategy:"least_busy"}},{type:"create_task",params:{title:"Preparer dossier {{dossier.titre}}",description:"Verifier les pieces, creer le planning",dueDate:"+2 days"}},{type:"send_email",params:{template:"dossier_assigned",to:"{{assignee.email}}"}}]},{name:"Document uploade - Extraction automatique",description:"Extrait les metadonnees et lance l'OCR sur les documents uploades",enabled:!1,trigger:{type:"document_uploaded",conditions:[{field:"mimeType",operator:"in",value:["application/pdf","image/jpeg","image/png"]}]},actions:[{type:"run_script",params:{script:"extract_metadata",args:{documentId:"{{document.id}}"}}},{type:"create_notification",params:{type:"info",title:"Document traite",message:"Le document {{document.name}} a ete analyse"}}]},{name:"Rapport hebdomadaire automatique",description:"Genere et envoie un rapport d'activite chaque lundi a 9h",enabled:!0,trigger:{type:"scheduled",conditions:[{field:"cron",operator:"equals",value:"0 9 * * 1"}]},actions:[{type:"generate_document",params:{template:"rapport_hebdomadaire",format:"pdf"}},{type:"send_email",params:{template:"weekly_report",to:"direction@cabinet.fr",attachments:["{{generated_document}}"]}}]}];function u(){let e=o.safeLocalStorage.getItem("workflows");if(!e){let e=d.map((e,t)=>({...e,id:`workflow_${t+1}`,createdAt:new Date,updatedAt:new Date,executionCount:0}));return o.safeLocalStorage.setItem("workflows",JSON.stringify(e)),e}return JSON.parse(e).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),lastExecuted:e.lastExecuted?new Date(e.lastExecuted):void 0}))}async function m(e,t){let a=u(),s=a.find(t=>t.id===e);if(!s)throw Error("Workflow introuvable");let r={id:`exec_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,workflowId:e,triggeredAt:new Date,status:"running",context:t,results:[]};c.logger.info("Debut execution workflow",{workflowId:s.id,workflowName:s.name,context:t});try{for(let e of s.actions){if(c.logger.debug("Execution action workflow",{actionType:e.type,params:e.params}),e.delay&&e.delay>0){let t=60*e.delay*1e3;await new Promise(e=>setTimeout(e,t))}let a=await x(e,t);r.results.push({action:e,status:"success",result:a}),c.logger.debug("Action workflow reussie",{actionType:e.type,result:a})}r.status="completed",r.completedAt=new Date,s.executionCount++,s.lastExecuted=new Date,o.safeLocalStorage.setItem("workflows",JSON.stringify(a)),c.logger.info("Workflow termine avec succes",{workflowName:s.name,resultsCount:r.results.length})}catch(e){r.status="failed",r.error=e.message,r.completedAt=new Date,c.logger.error("Erreur lors de l'execution du workflow",e,{workflowName:s.name})}let i=p();return i.push(r),o.safeLocalStorage.setItem("workflow_executions",JSON.stringify(i)),r}async function x(e,t){var a,s,r,i;let n=function e(t,a){if("string"==typeof t)return t.replace(/\{\{([^}]+)\}\}/g,(e,t)=>{var s;let r=(s=a,t.trim().split(".").reduce((e,t)=>e?.[t],s));return void 0!==r?r:e});if(Array.isArray(t))return t.map(t=>e(t,a));if("object"==typeof t&&null!==t){let s={};for(let r in t)s[r]=e(t[r],a);return s}return t}(e.params,t);switch(e.type){case"send_email":return{sent:!0,to:(a=n).to,subject:a.subject};case"create_task":return s=n,{taskId:`task_${Date.now()}`,title:s.title};case"update_status":return{updated:!0,newStatus:n.status};case"create_notification":return r=n,{notificationId:`notif_${Date.now()}`,title:r.title};case"generate_document":return i=n,{documentId:`doc_${Date.now()}`,template:i.template};case"assign_to_user":return{assigned:!0,userId:`user_${Math.floor(5*Math.random())+1}`};case"webhook":return{webhookCalled:!0,url:n.url};case"run_script":return{executed:!0,script:n.script};default:throw Error(`Type d'action inconnu: ${e.type}`)}}function p(e){let t=o.safeLocalStorage.getItem("workflow_executions");if(!t)return[];let a=JSON.parse(t);return a=a.map(e=>({...e,triggeredAt:new Date(e.triggeredAt),completedAt:e.completedAt?new Date(e.completedAt):void 0})),e&&(a=a.filter(t=>t.workflowId===e)),a.sort((e,t)=>t.triggeredAt.getTime()-e.triggeredAt.getTime())}var g=e.i(431343);let h=(0,e.i(475254).default)("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]]);var f=e.i(727612),y=e.i(107233),w=e.i(227516),j=e.i(595468),k=e.i(373884),b=e.i(503116);function v(){let[e,c]=(0,a.useState)(u()),[d,x]=(0,a.useState)(null),[v,N]=(0,a.useState)(!1),[_,C]=(0,a.useState)(!1),{showToast:A}=(0,l.useToast)(),S=()=>{c(u())},D=async e=>{try{A("Execution du workflow...","info"),await m(e.id,{test:!0,triggeredBy:"manual"}),S(),A("Workflow execute avec succes","success")}catch(e){A("Erreur lors de l'execution","error")}},E={total:e.length,enabled:e.filter(e=>e.enabled).length,disabled:e.filter(e=>!e.enabled).length,totalExecutions:e.reduce((e,t)=>e+t.executionCount,0)},I={dossier_created:"Dossier cree",dossier_status_changed:"Statut dossier modifie",facture_created:"Facture creee",facture_overdue:"Facture en retard",echeance_approaching:"echeance proche",document_uploaded:"Document uploade",client_created:"Client cree",scheduled:"Planifie"},T={send_email:"[emoji] Email",create_task:" Tache",update_status:"[emoji] Statut",assign_to_user:"[emoji] Attribution",generate_document:"[emoji] Document",create_notification:"[emoji] Notification",webhook:"[emoji] Webhook",run_script:"ï¸ Script"};return(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsx)(r.Breadcrumb,{items:[{label:"Accueil",href:"/"},{label:"Workflows",href:"/workflows"}]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Automatisation des Workflows"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Automatisez vos processus metier avec des regles personnalisees"})]}),(0,t.jsxs)(i.Button,{onClick:()=>N(!0),children:[(0,t.jsx)(y.Plus,{className:"w-4 h-4 mr-2"}),"Nouveau workflow"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)(s.Card,{className:"p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total workflows"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:E.total})]}),(0,t.jsxs)(s.Card,{className:"p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Actifs"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-green-600 mt-1",children:E.enabled})]}),(0,t.jsxs)(s.Card,{className:"p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Desactives"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-400 mt-1",children:E.disabled})]}),(0,t.jsxs)(s.Card,{className:"p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Executions totales"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:E.totalExecutions})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[e.map(e=>(0,t.jsx)(s.Card,{className:"p-6",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.name}),(0,t.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${e.enabled?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}`,children:e.enabled?"Actif":"Desactive"})]}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-3",children:e.description}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Declencheur:"}),(0,t.jsx)("span",{className:"ml-2 font-medium text-gray-900 dark:text-white",children:I[e.trigger.type]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Actions:"}),(0,t.jsx)("span",{className:"ml-2 font-medium text-gray-900 dark:text-white",children:e.actions.map(e=>T[e.type]).join(", ")})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Executions:"}),(0,t.jsx)("span",{className:"ml-2 font-medium text-gray-900 dark:text-white",children:e.executionCount})]}),e.lastExecuted&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-500 dark:text-gray-400",children:"Derniere:"}),(0,t.jsx)("span",{className:"ml-2 font-medium text-gray-900 dark:text-white",children:new Date(e.lastExecuted).toLocaleString("fr-FR")})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>D(e),children:(0,t.jsx)(g.Play,{className:"w-4 h-4"})}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>{x(e),C(!0)},children:(0,t.jsx)(w.History,{className:"w-4 h-4"})}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>{var t;let a,s;t=e.id,(s=(a=u()).find(e=>e.id===t))&&(s.enabled=!s.enabled,s.updatedAt=new Date,o.safeLocalStorage.setItem("workflows",JSON.stringify(a))),S(),A("Workflow mis a jour","success")},children:e.enabled?(0,t.jsx)(h,{className:"w-4 h-4"}):(0,t.jsx)(g.Play,{className:"w-4 h-4"})}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>(e=>{if(confirm("Supprimer ce workflow ?")){let t;t=u().filter(t=>t.id!==e),o.safeLocalStorage.setItem("workflows",JSON.stringify(t)),S(),A("Workflow supprime","success")}})(e.id),children:(0,t.jsx)(f.Trash2,{className:"w-4 h-4 text-red-600"})})]})]})},e.id)),0===e.length&&(0,t.jsxs)(s.Card,{className:"p-12 text-center",children:[(0,t.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Aucun workflow configure"}),(0,t.jsx)(i.Button,{onClick:()=>N(!0),className:"mt-4",children:"Creer votre premier workflow"})]})]}),_&&d&&(0,t.jsx)(n.Modal,{isOpen:_,onClose:()=>C(!1),title:`Historique - ${d.name}`,children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("h3",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:["Historique - ",d.name]}),(0,t.jsxs)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[p(d.id).map(e=>(0,t.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["completed"===e.status&&(0,t.jsx)(j.CheckCircle2,{className:"w-5 h-5 text-green-600"}),"failed"===e.status&&(0,t.jsx)(k.XCircle,{className:"w-5 h-5 text-red-600"}),"running"===e.status&&(0,t.jsx)(b.Clock,{className:"w-5 h-5 text-blue-600 animate-spin"}),(0,t.jsxs)("span",{className:"font-medium text-gray-900 dark:text-white",children:["completed"===e.status&&"Reussi","failed"===e.status&&"echoue","running"===e.status&&"En cours","pending"===e.status&&"En attente"]})]}),(0,t.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(e.triggeredAt).toLocaleString("fr-FR")})]}),e.error&&(0,t.jsxs)("div",{className:"text-sm text-red-600 dark:text-red-400 mb-2",children:["Erreur: ",e.error]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.results.length," action(s) executee(s)"]})]},e.id)),0===p(d.id).length&&(0,t.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Aucune execution enregistree"})]})]})})]})}e.s(["default",()=>v,"dynamic",0,"force-dynamic"],36989)}]);