(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,440160,e=>{"use strict";let t=(0,e.i(475254).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);e.s(["Download",()=>t],440160)},727612,e=>{"use strict";let t=(0,e.i(475254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>t],727612)},569074,e=>{"use strict";let t=(0,e.i(475254).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>t],569074)},751975,e=>{"use strict";let t=(0,e.i(475254).default)("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);e.s(["Tag",()=>t],751975)},833884,e=>{"use strict";var t=e.i(843476),a=e.i(271645);let r=(0,a.memo)(({size:e="md",color:a="blue",className:r=""})=>(0,t.jsxs)("div",{className:`inline-block ${r}`,role:"status","aria-label":"Chargement",children:[(0,t.jsxs)("svg",{className:`animate-spin ${{sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"}[e]} ${{blue:"text-blue-600",gray:"text-gray-600",white:"text-white"}[a]} gpu-accelerated`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,t.jsx)("span",{className:"sr-only",children:"Chargement..."})]}));r.displayName="LoadingSpinner";var s=e.i(165918);let l=(0,a.memo)(a.default.forwardRef(({variant:e="primary",size:a="md",isLoading:l=!1,className:i="",children:n,disabled:c,...o},d)=>{let m="primary"===e?{backgroundColor:s.colors.button,color:"white"}:{};return(0,t.jsx)("button",{ref:d,className:`
          inline-flex items-center justify-center font-medium rounded-lg transition-all duration-150 ease-out focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed will-change-transform
          ${{primary:"text-white hover:scale-105",secondary:"bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500 hover:scale-105",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500 hover:scale-105",outline:"border-2 border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-gray-500 hover:scale-105"}[e]}
          ${{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[a]}
          ${i}
        `,style:m,disabled:c||l,...o,children:l?(0,t.jsxs)("span",{className:"flex items-center justify-center",children:[(0,t.jsx)(r,{size:"sm",color:"outline"===e?"gray":"white",className:"mr-2"}),"Chargement..."]}):n})}));l.displayName="Button",e.s(["Button",0,l],833884)},164485,e=>{"use strict";e.i(754338),e.i(232768),e.i(888840),e.s([],164485)},564486,e=>{"use strict";e.s(["safeLocalStorage",0,{getItem:e=>localStorage.getItem(e),setItem:(e,t)=>{localStorage.setItem(e,t)},removeItem:e=>{localStorage.removeItem(e)},clear:()=>{localStorage.clear()}}])},227516,e=>{"use strict";let t=(0,e.i(475254).default)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);e.s(["History",()=>t],227516)},85503,e=>{"use strict";var t=e.i(843476),a=e.i(271645),r=e.i(339964),s=e.i(964753),l=e.i(569074),i=e.i(37727),n=e.i(643531),c=e.i(564486),o=e.i(778497);async function d(e,t){try{var a,r;let s,l,i,n,d;if(e.size>0x3200000)throw Error("Le fichier est trop volumineux (max 50MB)");if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/jpeg","image/png","image/gif","text/plain"].includes(e.type))throw Error("Type de fichier non autorise");let h=new FormData;h.append("file",e),h.append("options",JSON.stringify(t));let u=t.parentId?await (a=t.parentId,s=x(a),0===s.length?0:Math.max(...s.map(e=>e.version)))+1:1,g={id:`file_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:(r=e.name,l=Date.now(),i=Math.random().toString(36).substr(2,9),n=r.split(".").pop(),d=r.replace(/\.[^/.]+$/,"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/gi,"_").toLowerCase(),`${d}_${l}_${i}.${n}`),originalName:e.name,size:e.size,mimeType:e.type,url:URL.createObjectURL(e),uploadedAt:new Date,uploadedBy:"current_user",version:u,parentId:t.parentId,tags:t.tags||[],metadata:{dossierId:t.dossierId,clientId:t.clientId,category:t.category,description:t.description}},p=m();return p.push(g),c.safeLocalStorage.setItem("stored_files",JSON.stringify(p)),o.logger.info("Fichier uploade avec succes",{fileId:g.id,filename:g.name,size:g.size}),g}catch(t){throw o.logger.error("Erreur lors de l'upload du fichier",t,{filename:e.name,size:e.size}),t}}function m(e){let t=c.safeLocalStorage.getItem("stored_files"),a=t?JSON.parse(t):[];return a=a.map(e=>({...e,uploadedAt:new Date(e.uploadedAt)})),e&&(e.dossierId&&(a=a.filter(t=>t.metadata.dossierId===e.dossierId)),e.clientId&&(a=a.filter(t=>t.metadata.clientId===e.clientId)),e.category&&(a=a.filter(t=>t.metadata.category===e.category)),e.tags&&e.tags.length>0&&(a=a.filter(t=>e.tags.some(e=>t.tags.includes(e))))),a}function x(e){let t=m(),a=t.find(t=>t.id===e);if(!a)return[];let r=a.parentId||e;return t.filter(e=>e.id===r||e.parentId===r).sort((e,t)=>e.version-t.version)}async function h(e){try{let t=m().filter(t=>t.id!==e);c.safeLocalStorage.setItem("stored_files",JSON.stringify(t)),o.logger.info("Fichier supprime",{fileId:e})}catch(t){throw o.logger.error("Erreur lors de la suppression du fichier",t,{fileId:e}),t}}function u(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]}function g(e){return e.startsWith("image/")?"[emoji]ï¸":("application/pdf"===e||e.includes("word")||e.includes("excel")||e.includes("spreadsheet")||e.includes("text"),"[emoji]")}var p=e.i(833884);e.i(164485);var y=e.i(888840);function f({options:e,onUploadComplete:r,maxFiles:s=5,accept:c=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.gif,.txt"}){let[o,m]=(0,a.useState)([]),[x,h]=(0,a.useState)(!1),[f,j]=(0,a.useState)({}),v=(0,a.useRef)(null),{showToast:b}=(0,y.useToast)(),N=async()=>{if(0===o.length)return;h(!0);let t=[];try{for(let a=0;a<o.length;a++){let r=o[a];j(e=>({...e,[r.name]:0}));let s=setInterval(()=>{j(e=>{let t=e[r.name]||0;return t>=90?(clearInterval(s),e):{...e,[r.name]:t+10}})},100),l=await d(r,e);clearInterval(s),j(e=>({...e,[r.name]:100})),t.push(l.id)}b(`${o.length} fichier(s) uploade(s) avec succes`,"success"),r&&t.length>0&&t.forEach(e=>r(e)),m([]),j({}),v.current&&(v.current.value="")}catch(e){console.error("Erreur upload:",e),b("Erreur lors de l'upload","error")}finally{h(!1)}};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center hover:border-blue-500 dark:hover:border-blue-400 transition-colors cursor-pointer",onDrop:e=>{e.preventDefault();let t=Array.from(e.dataTransfer.files);o.length+t.length>s?b(`Maximum ${s} fichiers autorises`,"error"):m(e=>[...e,...t])},onDragOver:e=>e.preventDefault(),onClick:()=>v.current?.click(),children:[(0,t.jsx)(l.Upload,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),(0,t.jsx)("p",{className:"text-gray-700 dark:text-gray-300 mb-2",children:"Glissez-deposez vos fichiers ici ou cliquez pour parcourir"}),(0,t.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Maximum ",s," fichiers - Types acceptes: ",c]}),(0,t.jsx)("input",{ref:v,type:"file",multiple:!0,accept:c,onChange:e=>{let t=Array.from(e.target.files||[]);o.length+t.length>s?b(`Maximum ${s} fichiers autorises`,"error"):m(e=>[...e,...t])},className:"hidden"})]}),o.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:["Fichiers selectionnes (",o.length,"/",s,")"]}),o.map((e,a)=>(0,t.jsx)("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,t.jsx)("span",{className:"text-2xl",children:g(e.type)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:u(e.size)}),void 0!==f[e.name]&&(0,t.jsx)("div",{className:"mt-1 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5",children:(0,t.jsx)("div",{className:"bg-blue-600 h-1.5 rounded-full transition-all",style:{width:`${f[e.name]}%`}})})]}),100===f[e.name]?(0,t.jsx)(n.Check,{className:"w-5 h-5 text-green-600"}):x&&void 0!==f[e.name]?(0,t.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}):(0,t.jsx)("button",{onClick:()=>{m(e=>e.filter((e,t)=>t!==a))},className:"text-gray-400 hover:text-red-600 transition-colors",disabled:x,children:(0,t.jsx)(i.X,{className:"w-5 h-5"})})]})},a))]}),o.length>0&&(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(p.Button,{onClick:N,disabled:x,className:"flex-1",children:x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Upload en cours..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Upload,{className:"w-4 h-4 mr-2"}),"Uploader ",o.length," fichier(s)"]})}),(0,t.jsx)(p.Button,{onClick:()=>{m([]),j({}),v.current&&(v.current.value="")},variant:"outline",disabled:x,children:"Annuler"})]})]})}var j=e.i(440160),v=e.i(727612),b=e.i(227516),N=e.i(751975),w=e.i(159354);function k(){let e,l,[i,n]=(0,a.useState)(m()),[c,o]=(0,a.useState)("all"),[d,k]=(0,a.useState)(null),[C,I]=(0,a.useState)(!1),{showToast:M}=(0,y.useToast)(),S=()=>{n(m())},z=async e=>{if(confirm("etes-vous sur de vouloir supprimer ce fichier ?"))try{await h(e),S(),M("Fichier supprime avec succes","success")}catch(e){M("Erreur lors de la suppression","error")}},T=e=>{let t;(t=document.createElement("a")).href=e.url,t.download=e.originalName,document.body.appendChild(t),t.click(),document.body.removeChild(t),M("Telechargement demarre","info")},D=(l={totalFiles:(e=m()).length,totalSize:e.reduce((e,t)=>e+t.size,0),byCategory:{},byType:{}},e.forEach(e=>{let t=e.metadata.category;l.byCategory[t]=(l.byCategory[t]||0)+1;let a=e.mimeType.split("/")[0];l.byType[a]=(l.byType[a]||0)+1}),l),B="all"===c?i:i.filter(e=>e.metadata.category===c),$=[{value:"all",label:"Tous",count:i.length},{value:"piece_jointe",label:"Pieces jointes",count:D.byCategory.piece_jointe||0},{value:"document_genere",label:"Documents generes",count:D.byCategory.document_genere||0},{value:"template",label:"Templates",count:D.byCategory.template||0},{value:"autre",label:"Autres",count:D.byCategory.autre||0}];return(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsx)(s.Breadcrumb,{items:[{label:"Accueil",href:"/"},{label:"Documents",href:"/documents"}]}),(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Gestion des Documents"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Stockage cloud avec versioning"})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)(r.Card,{className:"p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total fichiers"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:D.totalFiles})]}),(0,t.jsxs)(r.Card,{className:"p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Espace utilise"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:u(D.totalSize)})]}),(0,t.jsxs)(r.Card,{className:"p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Images"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:D.byType.image||0})]}),(0,t.jsxs)(r.Card,{className:"p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Documents"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:D.byType.application||0})]})]}),(0,t.jsxs)(r.Card,{className:"p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:"Uploader des fichiers"}),(0,t.jsx)(f,{options:{category:"piece_jointe",description:"Document uploade via l'interface"},onUploadComplete:()=>S()})]}),(0,t.jsx)("div",{className:"flex gap-2 flex-wrap",children:$.map(e=>(0,t.jsxs)("button",{onClick:()=>o(e.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${c===e.value?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:[e.label," (",e.count,")"]},e.value))}),(0,t.jsxs)(r.Card,{className:"p-6",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:["Fichiers (",B.length,")"]}),0===B.length?(0,t.jsx)("div",{className:"text-center py-12",children:(0,t.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"Aucun fichier trouve"})}):(0,t.jsx)("div",{className:"space-y-3",children:B.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[(0,t.jsx)("span",{className:"text-3xl",children:g(e.mimeType)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.originalName}),(0,t.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(0,t.jsx)("span",{children:u(e.size)}),(0,t.jsx)("span",{children:"-"}),(0,t.jsxs)("span",{children:["v",e.version]}),(0,t.jsx)("span",{children:"-"}),(0,t.jsx)("span",{children:new Date(e.uploadedAt).toLocaleDateString("fr-FR")}),e.tags.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"-"}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(N.Tag,{className:"w-3 h-3"}),e.tags.join(", ")]})]})]}),e.metadata.description&&(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.metadata.description})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(p.Button,{variant:"outline",size:"sm",onClick:()=>T(e),children:(0,t.jsx)(j.Download,{className:"w-4 h-4"})}),(0,t.jsx)(p.Button,{variant:"outline",size:"sm",onClick:()=>{k(e),I(!0)},children:(0,t.jsx)(b.History,{className:"w-4 h-4"})}),(0,t.jsx)(p.Button,{variant:"outline",size:"sm",onClick:()=>z(e.id),children:(0,t.jsx)(v.Trash2,{className:"w-4 h-4 text-red-600"})})]})]},e.id))})]}),C&&d&&(0,t.jsx)(w.Modal,{isOpen:C,onClose:()=>I(!1),title:`Historique des versions - ${d.originalName}`,children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("h3",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:["Historique des versions - ",d.originalName]}),(0,t.jsx)("div",{className:"space-y-3",children:x(d.id).map(e=>(0,t.jsx)("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium text-gray-900 dark:text-white",children:["Version ",e.version]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:new Date(e.uploadedAt).toLocaleString("fr-FR")}),(0,t.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Par ",e.uploadedBy]})]}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsx)(p.Button,{variant:"outline",size:"sm",onClick:()=>T(e),children:(0,t.jsx)(j.Download,{className:"w-4 h-4"})})})]})},e.id))})]})})]})}e.s(["default",()=>k,"dynamic",0,"force-dynamic"],85503)}]);