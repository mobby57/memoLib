<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Templates - IAPosteManager</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-6">üìù Templates d'Emails</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Liste des templates -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4">Templates disponibles</h2>
                <div id="templatesList" class="space-y-3">
                    <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-50" onclick="loadTemplate('professionnel')">
                        <div class="font-semibold">Email Professionnel</div>
                        <div class="text-sm text-gray-600">Pour les communications formelles</div>
                    </div>
                    <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-50" onclick="loadTemplate('demande')">
                        <div class="font-semibold">Demande d'Information</div>
                        <div class="text-sm text-gray-600">Pour demander des renseignements</div>
                    </div>
                    <div class="p-3 border rounded-lg cursor-pointer hover:bg-gray-50" onclick="loadTemplate('remerciement')">
                        <div class="font-semibold">Remerciement</div>
                        <div class="text-sm text-gray-600">Pour remercier quelqu'un</div>
                    </div>
                </div>
            </div>
            
            <!-- Cr√©er/Modifier template -->
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4">Cr√©er un template</h2>
                <form onsubmit="saveTemplate(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Nom</label>
                        <input type="text" id="templateName" class="w-full p-3 border rounded-lg" required>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Sujet</label>
                        <input type="text" id="templateSubject" class="w-full p-3 border rounded-lg" required>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Corps</label>
                        <textarea id="templateBody" class="w-full p-3 border rounded-lg" rows="8" required></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Cat√©gorie</label>
                        <select id="templateCategory" class="w-full p-3 border rounded-lg">
                            <option value="general">G√©n√©ral</option>
                            <option value="business">Business</option>
                            <option value="personal">Personnel</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600">
                        Sauvegarder Template
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const templates = {
            professionnel: {
                name: "Email Professionnel",
                subject: "Demande concernant {sujet}",
                body: "Bonjour,\n\nJ'esp√®re que vous allez bien.\n\nJe me permets de vous contacter concernant {contexte}.\n\nPourriez-vous m'indiquer {demande} ?\n\nJe vous remercie par avance pour votre r√©ponse.\n\nCordialement,\n{nom}"
            },
            demande: {
                name: "Demande d'Information",
                subject: "Demande d'information - {sujet}",
                body: "Bonjour,\n\nJe souhaiterais obtenir des informations concernant {sujet}.\n\nPourriez-vous me renseigner sur :\n- {point1}\n- {point2}\n- {point3}\n\nJe vous remercie pour votre aide.\n\nCordialement,\n{nom}"
            },
            remerciement: {
                name: "Remerciement",
                subject: "Remerciements - {occasion}",
                body: "Bonjour,\n\nJe tenais √† vous remercier pour {raison}.\n\nVotre aide a √©t√© tr√®s pr√©cieuse et m'a permis de {r√©sultat}.\n\nEncore merci pour votre disponibilit√©.\n\nCordialement,\n{nom}"
            }
        };
        
        function loadTemplate(templateId) {
            const template = templates[templateId];
            if (template) {
                document.getElementById('templateName').value = template.name;
                document.getElementById('templateSubject').value = template.subject;
                document.getElementById('templateBody').value = template.body;
            }
        }
        
        async function saveTemplate(event) {
            event.preventDefault();
            
            const templateData = {
                name: document.getElementById('templateName').value,
                subject: document.getElementById('templateSubject').value,
                body: document.getElementById('templateBody').value,
                category: document.getElementById('templateCategory').value
            };
            
            try {
                const response = await fetch('/api/templates', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(templateData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Template sauvegard√© avec succ√®s !');
                    // Reset form
                    event.target.reset();
                } else {
                    alert('Erreur: ' + data.error);
                }
            } catch (error) {
                alert('Erreur de connexion');
            }
        }
        
        // Charger les templates existants au d√©marrage
        async function loadExistingTemplates() {
            try {
                const response = await fetch('/api/templates');
                const data = await response.json();
                
                if (data.success && data.templates.length > 0) {
                    // Ajouter les templates personnalis√©s √† la liste
                    const list = document.getElementById('templatesList');
                    data.templates.forEach(template => {
                        const div = document.createElement('div');
                        div.className = 'p-3 border rounded-lg cursor-pointer hover:bg-gray-50';
                        div.onclick = () => loadCustomTemplate(template);
                        div.innerHTML = `
                            <div class="font-semibold">${template.name}</div>
                            <div class="text-sm text-gray-600">${template.category}</div>
                        `;
                        list.appendChild(div);
                    });
                }
            } catch (error) {
                console.error('Erreur chargement templates:', error);
            }
        }
        
        function loadCustomTemplate(template) {
            document.getElementById('templateName').value = template.name;
            document.getElementById('templateSubject').value = template.subject;
            document.getElementById('templateBody').value = template.body;
            document.getElementById('templateCategory').value = template.category;
        }
        
        // Charger au d√©marrage
        loadExistingTemplates();
    </script>
</body>
</html>