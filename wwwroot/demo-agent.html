<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MemoLib - D√©mo AGENT (Collaborateur)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header .role-badge { background: #16a085; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; display: inline-block; margin-top: 10px; }
        .card { background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .card h2 { color: #27ae60; margin-bottom: 15px; }
        .btn { background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-size: 16px; margin: 5px; transition: all 0.3s ease; }
        .btn:hover { transform: translateY(-2px); }
        .btn.disabled { background: #bdc3c7; cursor: not-allowed; }
        .btn.info { background: linear-gradient(45deg, #3498db, #2980b9); }
        .btn.warning { background: linear-gradient(45deg, #f39c12, #e67e22); }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin: 20px 0; }
        .stat-box { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-box .number { font-size: 2em; font-weight: bold; }
        .stat-box .label { font-size: 0.9em; opacity: 0.9; margin-top: 5px; }
        .result { background: #f8f9fa; border-left: 4px solid #27ae60; padding: 15px; margin-top: 15px; border-radius: 5px; }
        .success { border-left-color: #27ae60; background: #d4edda; }
        .error { border-left-color: #e74c3c; background: #f8d7da; }
        .warning { border-left-color: #f39c12; background: #fff3cd; }
        .info { border-left-color: #3498db; background: #d1ecf1; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #333; }
        .input-group input, .input-group select, .input-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { padding: 10px 20px; background: #ecf0f1; border: none; border-radius: 5px; cursor: pointer; }
        .tab.active { background: #27ae60; color: white; }
        .hidden { display: none; }
        .task-item { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #27ae60; }
        .task-item.pending { border-left-color: #f39c12; }
        .task-item.completed { border-left-color: #27ae60; opacity: 0.7; }
        .permission-note { background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 5px; margin: 10px 0; font-size: 0.9em; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã MemoLib - Espace Collaborateur</h1>
            <div class="role-badge">AGENT - Collaborateur</div>
            <p>Traitement des emails, suivi des t√¢ches et communication</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('tasks')">üìã Mes T√¢ches</button>
            <button class="tab" onclick="showTab('emails')">üìß Emails √† Traiter</button>
            <button class="tab" onclick="showTab('documents')">üìÑ Documents</button>
            <button class="tab" onclick="showTab('communication')">üí¨ Communication</button>
        </div>

        <!-- Tasks Tab -->
        <div id="tasks-tab" class="tab-content">
            <div class="card">
                <h2>Mes T√¢ches Assign√©es</h2>
                <button class="btn" onclick="loadMyTasks()">Charger Mes T√¢ches</button>
                <button class="btn info" onclick="loadPendingTasks()">T√¢ches en Attente</button>
                <div id="tasks-result"></div>
            </div>
        </div>

        <!-- Emails Tab -->
        <div id="emails-tab" class="tab-content hidden">
            <div class="card">
                <h2>Emails √† Traiter</h2>
                <div class="permission-note">
                    ‚ÑπÔ∏è <strong>Permissions :</strong> Vous pouvez traiter les emails assign√©s, ajouter des √©v√©nements et classer les documents. La cr√©ation de dossiers n√©cessite une validation d'un avocat.
                </div>
                <button class="btn" onclick="loadAssignedEmails()">Emails Assign√©s</button>
                <button class="btn warning" onclick="loadUnprocessedEmails()">Emails Non Trait√©s</button>
                <div class="input-group">
                    <label>Ajouter un √©v√©nement</label>
                    <textarea id="event-description" rows="3" placeholder="Description de l'√©v√©nement ou r√©sum√© de l'email trait√©..."></textarea>
                </div>
                <button class="btn" onclick="addEvent()">Ajouter √âv√©nement</button>
                <div id="emails-result"></div>
            </div>
        </div>

        <!-- Documents Tab -->
        <div id="documents-tab" class="tab-content hidden">
            <div class="card">
                <h2>Gestion Documents</h2>
                <div class="input-group">
                    <label>S√©lectionner un fichier</label>
                    <input type="file" id="document-file" accept=".pdf,.doc,.docx,.jpg,.png">
                </div>
                <div class="input-group">
                    <label>Type de document</label>
                    <select id="document-type">
                        <option value="piece_identite">Pi√®ce d'identit√©</option>
                        <option value="contrat">Contrat</option>
                        <option value="courrier">Courrier</option>
                        <option value="facture">Facture</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Dossier associ√© (ID)</label>
                    <input type="text" id="document-case" placeholder="ID du dossier">
                </div>
                <button class="btn" onclick="uploadDocument()">T√©l√©charger Document</button>
                <button class="btn info" onclick="loadMyDocuments()">Mes Documents</button>
                <div id="documents-result"></div>
            </div>
        </div>

        <!-- Communication Tab -->
        <div id="communication-tab" class="tab-content hidden">
            <div class="card">
                <h2>Communication</h2>
                <div class="permission-note">
                    ‚ÑπÔ∏è <strong>Templates approuv√©s :</strong> Utilisez uniquement les templates pr√©-approuv√©s pour la communication client. Pour des situations particuli√®res, demandez validation √† votre superviseur.
                </div>
                <div class="input-group">
                    <label>Destinataire</label>
                    <input type="email" id="comm-to" placeholder="client@example.com">
                </div>
                <div class="input-group">
                    <label>Template</label>
                    <select id="comm-template">
                        <option value="confirmation_rdv">Confirmation de rendez-vous</option>
                        <option value="demande_documents">Demande de documents</option>
                        <option value="accuse_reception">Accus√© de r√©ception</option>
                        <option value="relance_douce">Relance douce</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Message personnalis√© (optionnel)</label>
                    <textarea id="comm-message" rows="4" placeholder="Ajout personnel au template..."></textarea>
                </div>
                <button class="btn" onclick="sendTemplateEmail()">Envoyer Email Template</button>
                <button class="btn info" onclick="loadCommunicationHistory()">Historique</button>
                <div id="communication-result"></div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5078';
        let token = localStorage.getItem('authToken');

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            event.target.classList.add('active');
        }

        function showResult(elementId, message, isSuccess = true) {
            const element = document.getElementById(elementId);
            if (element) {
                const className = isSuccess ? 'success' : 'error';
                element.innerHTML = `<div class="result ${className}">${message}</div>`;
            }
        }

        async function loadMyTasks() {
            if (!token) return showResult('tasks-result', '‚ùå Connectez-vous d\'abord', false);

            // Simulation des t√¢ches assign√©es
            let html = '<div class="result success">üìã Mes T√¢ches du Jour</div>';
            html += '<div class="stats">';
            html += '<div class="stat-box"><div class="number">8</div><div class="label">T√¢ches Total</div></div>';
            html += '<div class="stat-box"><div class="number">3</div><div class="label">En Cours</div></div>';
            html += '<div class="stat-box"><div class="number">5</div><div class="label">Termin√©es</div></div>';
            html += '</div>';

            html += '<div class="task-item pending">üìß <strong>Traiter emails Mme Martin</strong><br>Assign√© par: Me Dupont | Priorit√©: Normale<br><button class="btn" onclick="completeTask(1)">Marquer Termin√©</button></div>';
            html += '<div class="task-item pending">üìÑ <strong>Classer documents dossier #123</strong><br>Assign√© par: Me Dupont | Priorit√©: Normale<br><button class="btn" onclick="completeTask(2)">Marquer Termin√©</button></div>';
            html += '<div class="task-item completed">‚úÖ <strong>Saisie √©v√©nements matin√©e</strong><br>Termin√© √† 14:30</div>';
            html += '<div class="task-item completed">‚úÖ <strong>Pr√©paration dossier audience</strong><br>Termin√© √† 11:15</div>';

            document.getElementById('tasks-result').innerHTML = html;
        }

        async function loadPendingTasks() {
            if (!token) return showResult('tasks-result', '‚ùå Connectez-vous d\'abord', false);

            let html = '<div class="result warning">‚è≥ T√¢ches en Attente de Validation</div>';
            html += '<div class="task-item pending">üìã <strong>Cr√©ation dossier M. Dubois</strong><br>En attente validation Me Dupont<br>Soumis il y a 2h</div>';
            html += '<div class="task-item pending">üìß <strong>R√©ponse email complexe Mme Lefebvre</strong><br>En attente validation Me Martin<br>Soumis il y a 30min</div>';

            document.getElementById('tasks-result').innerHTML = html;
        }

        async function loadAssignedEmails() {
            if (!token) return showResult('emails-result', '‚ùå Connectez-vous d\'abord', false);

            let html = '<div class="result success">üìß Emails Assign√©s √† Traiter</div>';
            html += '<div class="result">üìß <strong>De: sophie.martin@example.com</strong><br>Sujet: Demande de documents compl√©mentaires<br>Re√ßu: Il y a 1h | Assign√© par: Me Dupont<br><button class="btn" onclick="processEmail(1)">Traiter</button></div>';
            html += '<div class="result">üìß <strong>De: pierre.dubois@example.com</strong><br>Sujet: Question sur proc√©dure<br>Re√ßu: Il y a 3h | Assign√© par: Me Martin<br><button class="btn" onclick="processEmail(2)">Traiter</button></div>';

            document.getElementById('emails-result').innerHTML = html;
        }

        async function loadUnprocessedEmails() {
            if (!token) return showResult('emails-result', '‚ùå Connectez-vous d\'abord', false);

            let html = '<div class="result warning">‚ö†Ô∏è Emails Non Trait√©s (N√©cessitent Classification)</div>';
            html += '<div class="result">üìß <strong>De: nouveau.client@example.com</strong><br>Sujet: Premi√®re consultation<br>Re√ßu: Il y a 30min<br><button class="btn warning" onclick="classifyEmail(1)">Classer</button></div>';
            html += '<div class="result">üìß <strong>De: marie.lefebvre@example.com</strong><br>Sujet: Suivi dossier<br>Re√ßu: Il y a 1h<br><button class="btn warning" onclick="classifyEmail(2)">Classer</button></div>';

            document.getElementById('emails-result').innerHTML = html;
        }

        async function addEvent() {
            if (!token) return showResult('emails-result', '‚ùå Connectez-vous d\'abord', false);

            const description = document.getElementById('event-description').value;
            if (!description) return showResult('emails-result', '‚ùå Veuillez saisir une description', false);

            try {
                // Simulation d'ajout d'√©v√©nement
                showResult('emails-result', `‚úÖ √âv√©nement ajout√© avec succ√®s<br>üìù Description: ${description}<br>üïí Horodatage: ${new Date().toLocaleString('fr-FR')}<br>üë§ Cr√©√© par: Collaborateur`);
                document.getElementById('event-description').value = '';
            } catch (err) {
                showResult('emails-result', `‚ùå Erreur: ${err.message}`, false);
            }
        }

        async function uploadDocument() {
            if (!token) return showResult('documents-result', '‚ùå Connectez-vous d\'abord', false);

            const file = document.getElementById('document-file').files[0];
            const type = document.getElementById('document-type').value;
            const caseId = document.getElementById('document-case').value;

            if (!file) return showResult('documents-result', '‚ùå Veuillez s√©lectionner un fichier', false);

            try {
                // Simulation d'upload
                showResult('documents-result', `‚úÖ Document t√©l√©charg√© avec succ√®s<br>üìÑ Fichier: ${file.name}<br>üìã Type: ${type}<br>üÜî Dossier: ${caseId || 'Non sp√©cifi√©'}<br>üîí Hash SHA-256: abc123...`);
                
                // Reset form
                document.getElementById('document-file').value = '';
                document.getElementById('document-case').value = '';
            } catch (err) {
                showResult('documents-result', `‚ùå Erreur: ${err.message}`, false);
            }
        }

        async function loadMyDocuments() {
            if (!token) return showResult('documents-result', '‚ùå Connectez-vous d\'abord', false);

            let html = '<div class="result success">üìÑ Documents Trait√©s Aujourd\'hui</div>';
            html += '<div class="result">üìÑ <strong>contrat_martin.pdf</strong><br>Type: Contrat | Dossier: #123 | T√©l√©charg√©: 14:30</div>';
            html += '<div class="result">üìÑ <strong>piece_identite_dubois.jpg</strong><br>Type: Pi√®ce d\'identit√© | Dossier: #124 | T√©l√©charg√©: 11:15</div>';
            html += '<div class="result">üìÑ <strong>courrier_prefecture.pdf</strong><br>Type: Courrier | Dossier: #125 | T√©l√©charg√©: 09:45</div>';

            document.getElementById('documents-result').innerHTML = html;
        }

        async function sendTemplateEmail() {
            if (!token) return showResult('communication-result', '‚ùå Connectez-vous d\'abord', false);

            const to = document.getElementById('comm-to').value;
            const template = document.getElementById('comm-template').value;
            const message = document.getElementById('comm-message').value;

            if (!to) return showResult('communication-result', '‚ùå Veuillez saisir un destinataire', false);

            try {
                // Simulation d'envoi d'email template
                const templateNames = {
                    'confirmation_rdv': 'Confirmation de rendez-vous',
                    'demande_documents': 'Demande de documents',
                    'accuse_reception': 'Accus√© de r√©ception',
                    'relance_douce': 'Relance douce'
                };

                showResult('communication-result', `‚úÖ Email envoy√© avec succ√®s<br>üìß √Ä: ${to}<br>üìù Template: ${templateNames[template]}<br>üí¨ Message personnalis√©: ${message || 'Aucun'}<br>üïí Envoy√©: ${new Date().toLocaleString('fr-FR')}`);
                
                // Reset form
                document.getElementById('comm-to').value = '';
                document.getElementById('comm-message').value = '';
            } catch (err) {
                showResult('communication-result', `‚ùå Erreur: ${err.message}`, false);
            }
        }

        async function loadCommunicationHistory() {
            if (!token) return showResult('communication-result', '‚ùå Connectez-vous d\'abord', false);

            let html = '<div class="result success">üí¨ Historique Communication (Aujourd\'hui)</div>';
            html += '<div class="result">üìß <strong>√Ä: sophie.martin@example.com</strong><br>Template: Confirmation RDV | Envoy√©: 15:30<br>‚úÖ Accus√© de r√©ception re√ßu</div>';
            html += '<div class="result">üìß <strong>√Ä: pierre.dubois@example.com</strong><br>Template: Demande documents | Envoy√©: 11:45<br>‚è≥ En attente de r√©ponse</div>';
            html += '<div class="result">üìß <strong>√Ä: marie.lefebvre@example.com</strong><br>Template: Accus√© r√©ception | Envoy√©: 09:15<br>‚úÖ Trait√©</div>';

            document.getElementById('communication-result').innerHTML = html;
        }

        function completeTask(taskId) {
            showResult('tasks-result', `‚úÖ T√¢che ${taskId} marqu√©e comme termin√©e<br>üïí Compl√©t√©e √†: ${new Date().toLocaleString('fr-FR')}<br>üìä Notification envoy√©e au superviseur`);
        }

        function processEmail(emailId) {
            alert(`üìß Traitement Email ${emailId}\n\nActions disponibles:\n‚Ä¢ Classer dans un dossier existant\n‚Ä¢ Ajouter un √©v√©nement\n‚Ä¢ Demander validation pour nouveau dossier\n‚Ä¢ Utiliser template de r√©ponse`);
        }

        function classifyEmail(emailId) {
            alert(`üìã Classification Email ${emailId}\n\n√âtapes:\n1. Identifier le type de demande\n2. Rechercher client existant\n3. Proposer rattachement dossier\n4. Escalader si n√©cessaire`);
        }

        // Auto-load tasks on page load
        document.addEventListener('DOMContentLoaded', () => {
            if (token) {
                loadMyTasks();
            } else {
                showResult('tasks-result', '‚ùå Connectez-vous d\'abord pour acc√©der √† vos t√¢ches', false);
            }
        });
    </script>
</body>
</html>